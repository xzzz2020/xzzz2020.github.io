<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://xzzz2020.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="æ¸©æ•…è€ŒçŸ¥æ–°"><meta charset="UTF-8"><title>ç§’æ€ç­–ç•¥ï¼ˆç¼“å­˜+æ¶ˆæ¯é˜Ÿåˆ—ï¼‰ | xzzz2020</title>
<link href="https://xzzz2020.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://xzzz2020.github.io/media/css/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://xzzz2020.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<link rel="canonical" href="https://xzzz2020.github.io/post/k_uLsJY6w/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://xzzz2020.github.io"><img alt="logo" style="display:inline-block;" src="https://xzzz2020.github.io/images/avatar.png"/></a><h1 title="xzzz2020" class="weaklink"><a  href="/">xzzz2020</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1593396038030" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>ç§’æ€ç­–ç•¥ï¼ˆç¼“å­˜+æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2020-06-27</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px">	<a href="https://xzzz2020.github.io/tag/Gqtigt-YP/" class="tag">é«˜å¹¶å‘é¡¹ç›®</a></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">3144å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">13 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<img class="featureImg" alt="featureimg" src="https://img-1302474103.cos.ap-nanjing.myqcloud.com/img/d802a941-e36d-41fd-8d43-ef45c2ef1758.jpg" referrerpolicy="no-referrer">

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<blockquote>
<p>è¯¥é¡¹ç›®ä¸ºä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼ï¼ï¼<br>
ä¸ªäººåšå®¢åœ°å€ï¼š<a href="https://blog.csdn.net/qq_43040688">https://blog.csdn.net/qq_43040688</a><br>
ä¸ªäººç½‘ç«™åœ°å€ï¼š<a href="http://www.xzzz2020.cn/">http://www.xzzz2020.cn/</a></p>
</blockquote>
<p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B">ä¸€ã€é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="#%E4%BA%8C-%E6%8A%80%E6%9C%AF%E6%A0%88">äºŒã€æŠ€æœ¯æ ˆ</a></li>
<li><a href="#%E4%B8%89-%E8%AF%A6%E7%BB%86%E5%AE%9E%E7%8E%B0">ä¸‰ã€è¯¦ç»†å®ç°</a>
<ul>
<li><a href="#31-%E5%88%86%E5%B8%83%E5%BC%8Fsession">3.1 åˆ†å¸ƒå¼Session</a></li>
<li><a href="#32-%E9%A1%B5%E9%9D%A2%E7%BC%93%E5%AD%98-url%E7%BC%93%E5%AD%98">3.2  é¡µé¢ç¼“å­˜ + URLç¼“å­˜</a></li>
<li><a href="#33-%E5%AF%B9%E8%B1%A1%E7%BA%A7%E7%BC%93%E5%AD%98">3.3 å¯¹è±¡çº§ç¼“å­˜</a></li>
<li><a href="#34-%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E4%BC%98%E5%8C%96">3.4 æ ¸å¿ƒæ¥å£ä¼˜åŒ–</a></li>
<li><a href="#35-%E6%8E%A5%E5%8F%A3%E5%AE%89%E5%85%A8%E4%BC%98%E5%8C%96">3.5 æ¥å£å®‰å…¨ä¼˜åŒ–</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98">å››ã€ é¡¹ç›®å®è·µä¸­é‡åˆ°çš„é—®é¢˜</a>
<ul>
<li><a href="#41-%E7%A7%92%E6%9D%80%E6%88%90%E5%8A%9F%E5%95%86%E5%93%81%E8%AE%A2%E5%8D%95%E6%95%B0%E8%B6%85%E8%BF%87%E9%A2%84%E8%AE%A2%E6%95%B0%E5%80%BC">4.1  ç§’æ€æˆåŠŸå•†å“è®¢å•æ•°è¶…è¿‡é¢„è®¢æ•°å€¼</a></li>
<li><a href="#42-%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E7%9A%84%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%AF%BC%E8%87%B4%E7%A7%92%E6%9D%80%E6%88%90%E5%8A%9F%E7%A7%92%E6%9D%80%E5%A4%9A%E6%AC%A1">4.2  ä¸€ä¸ªç”¨æˆ·çš„å¤šä¸ªè¯·æ±‚å¯¼è‡´ç§’æ€æˆåŠŸç§’æ€å¤šæ¬¡</a></li>
<li><a href="#43-%E4%BD%BF%E7%94%A8%E4%BA%86%E7%BC%93%E5%AD%98%E4%BE%9D%E7%84%B6%E4%BC%9A%E5%A4%A7%E9%87%8F%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93">4.3 ä½¿ç”¨äº†ç¼“å­˜ä¾ç„¶ä¼šå¤§é‡è®¿é—®æ•°æ®åº“</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF">äº”ã€ æ¥ä¸‹æ¥çš„ä¼˜åŒ–æ€è·¯</a></li>
</ul>
</li>
</ul>
</p>
<h2 id="ä¸€-é¡¹ç›®ç®€ä»‹">ä¸€ã€é¡¹ç›®ç®€ä»‹</h2>
<p>è¯¥é¡¹ç›®ä¸»è¦å­¦ä¹ å¸¸ç”¨çš„é«˜å¹¶å‘ä¼˜åŒ–æŠ€æœ¯ï¼Œå¹¶å‘çš„ç“¶é¢ˆå¾€å¾€åœ¨æ•°æ®åº“ï¼Œé‡‡ç”¨ç¼“å­˜å’Œæ¶ˆæ¯é˜Ÿåˆ—å¯¹æ¥å£è¿›è¡Œä¼˜åŒ–å‡å°‘å¯¹æ•°æ®ä¼˜åŒ–ï¼ŒæŒæ¡é¢å¯¹é«˜å¹¶å‘åœºæ™¯ä¸‹çš„è®¾è®¡æ€è·¯ï¼š</p>
<ul>
<li>ä»¥ <strong>Spring Boot</strong> ä¸ºä¸»çº¿çš„æŠ€æœ¯æ ˆï¼Œä½¿ç”¨äº† <strong>Mybatis+Druid</strong> ï¼Œé‡‡ç”¨<strong>å‰åç«¯åˆ†ç¦»</strong>æ¶æ„</li>
<li>æ•´ä¸ªé¡¹ç›®åŸºäºå•†å“çš„ <strong>ç§’æ€æ¥å£</strong>ï¼Œè®¾è®¡ç™»å½•ã€å•†å“å±•ç¤ºä»¥åŠè®¢å•å±•ç¤ºç­‰ä¸€ç³»åˆ—çš„åŠŸèƒ½</li>
<li>æ¥å£é«˜å¹¶å‘çš„ä¼˜åŒ–ä¸»è¦åˆ©ç”¨ <strong>Rediså®ç°é¡µé¢ç¼“å­˜ + URLç¼“å­˜ + å¯¹è±¡ç¼“å­˜</strong> ï¼Œåˆ©ç”¨ <strong>å‰åç«¯åˆ†ç¦»å®ç°é¡µé¢é™æ€åŒ–</strong> ä»¥åŠæ•´åˆ <strong>RabbitMQå®ç°å¼‚æ­¥ä¸‹å•</strong> çš„ä¼˜åŒ–ã€‚<code>QPSä¼˜åŒ–è‡³å°‘ä¸¤å€</code></li>
<li>ç”¨æˆ·ç™»å½•ä¿¡æ¯ä½¿ç”¨ <strong>Cookie+Rediså®ç°åˆ†å¸ƒå¼Session</strong> ï¼Œä½¿ç”¨ <strong>æ‹¦æˆªå™¨+è‡ªå®šä¹‰å‚æ•°è§£æå™¨</strong> ï¼Œè·å–ç”¨æˆ·ä¿¡æ¯ã€‚<code>è§£å†³äº†ä¸åŒæœåŠ¡å™¨ä¹‹é—´å‡ºç°çš„ç¼“å­˜ä¸ä¸€è‡´æˆ–è€…æœåŠ¡å™¨å®•æœºSessionæ¶ˆå¤±çš„é—®é¢˜</code></li>
<li>æ¥å£å®‰å…¨å®ç°äº† <strong>ç§’æ€æ¥å£åœ°å€éšè— + æ•°å­¦å…¬å¼éªŒè¯ç  + åˆ©ç”¨Rediså®ç°æ¥å£é˜²åˆ·</strong>ã€‚<code>é˜²æ­¢æœºå™¨äººå¯¹äºæ ¸å¿ƒä¸šåŠ¡çš„æ”»å‡»</code></li>
<li>åˆ©ç”¨<strong>Jmeteræ¨¡æ‹Ÿ5000ä¸ªç”¨æˆ·ï¼Œä½¿ç”¨1ä¸‡ä¸ªçº¿ç¨‹</strong>ï¼Œå¯¹å•†å“å±•ç¤ºæ¥å£å’Œç§’æ€æ¥å£è¿›è¡Œå‹æµ‹ã€‚<code>å•†å“å±•ç¤ºæ¥å£ä¼˜åŒ–å‰QPSï¼š584.8ï¼Œä¼˜åŒ–åQPSï¼š2085.9ï¼›ç§’æ€æ¥å£ä¼˜åŒ–å‰QPSï¼š351.8ï¼Œä¼˜åŒ–åQPSï¼š2242.7</code></li>
</ul>
<h2 id="äºŒ-æŠ€æœ¯æ ˆ">äºŒã€æŠ€æœ¯æ ˆ</h2>
<p><strong>å‰ç«¯</strong></p>
<ul>
<li><code>Bootstrap</code></li>
<li><code>Ajax</code></li>
<li><code>thymeleaf</code></li>
</ul>
<p><strong>åç«¯</strong></p>
<ul>
<li><code>SpringBoot</code></li>
<li><code>Mybatis</code></li>
<li><code>Druid</code></li>
<li><code>Jedis</code></li>
<li><code>fastjson</code></li>
</ul>
<p><strong>æ•°æ®åº“</strong></p>
<ul>
<li><code>MySQL</code></li>
<li><code>Redis</code></li>
</ul>
<p><strong>ä¸­é—´ä»¶</strong></p>
<ul>
<li><code>RabbitMQ</code></li>
</ul>
<p><strong>æµ‹è¯•</strong></p>
<ul>
<li><code>Jmeter</code></li>
</ul>
<h2 id="ä¸‰-è¯¦ç»†å®ç°">ä¸‰ã€è¯¦ç»†å®ç°</h2>
<h3 id="31-åˆ†å¸ƒå¼session">3.1 åˆ†å¸ƒå¼Session</h3>
<p>å¸¸ç”¨çš„æœ‰ä¸‰ç§åˆ†å¸ƒå¼Sessionè§£å†³æ–¹æ¡ˆï¼š<code>æœåŠ¡å™¨ä¹‹é—´Sessionå…±äº«</code>ã€<code>Sessionç»‘å®š</code>ã€<code>Cookie+ç¼“å­˜</code>ã€‚<strong>æœ¬é¡¹ç›®ä½¿ç”¨çš„å°±æ˜¯Cookie+ç¼“å­˜çš„æ–¹å¼</strong>ã€‚ä¸‹é¢å°†ä»‹ç»è¿™å‡ ç§æ–¹å¼ï¼š</p>
<blockquote>
<p><strong>æœåŠ¡å™¨ä¹‹é—´Sessionå…±äº«</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨ä¸€å°ä½œä¸ºç”¨æˆ·çš„ç™»å½•æœåŠ¡å™¨ï¼Œå½“ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œä¼šå°†sessionå†™åˆ°å½“å‰æœåŠ¡å™¨ä¸Šï¼Œæˆ‘ä»¬é€šè¿‡è„šæœ¬æˆ–è€…å®ˆæŠ¤è¿›ç¨‹å°†sessionåŒæ­¥åˆ°å…¶ä»–æœåŠ¡å™¨ä¸Šï¼Œè¿™æ—¶å½“ç”¨æˆ·è·³è½¬åˆ°å…¶ä»–æœåŠ¡å™¨ï¼Œsessionä¸€è‡´ï¼Œä¹Ÿå°±ä¸ç”¨å†æ¬¡ç™»å½•ã€‚</li>
<li><strong>ç¼ºé™·</strong>ï¼šé€Ÿåº¦æ…¢ï¼ŒåŒæ­¥sessionæœ‰å»¶è¿Ÿæ€§ï¼Œå¯èƒ½å¯¼è‡´è·³è½¬æœåŠ¡å™¨ä¹‹åï¼ŒsessionæœªåŒæ­¥ã€‚è€Œä¸”å•å‘åŒæ­¥æ—¶ï¼Œç™»å½•æœåŠ¡å™¨å®•æœºï¼Œæ•´ä¸ªç³»ç»Ÿéƒ½ä¸èƒ½æ­£å¸¸è¿è¡Œã€‚</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Sessionç»‘å®š</strong>ï¼š</p>
<ul>
<li>åŸºäºnginxçš„ip-hashç­–ç•¥ï¼Œå¯ä»¥å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨è¿›è¡Œç»‘å®šï¼ŒåŒä¸€ä¸ªå®¢æˆ·ç«¯å°±åªèƒ½è®¿é—®è¯¥æœåŠ¡å™¨ï¼Œæ— è®ºå®¢æˆ·ç«¯å‘é€å¤šå°‘æ¬¡è¯·æ±‚éƒ½è¢«åŒä¸€ä¸ªæœåŠ¡å™¨å¤„ç†</li>
<li><strong>ç¼ºé™·</strong>ï¼šå®¹æ˜“é€ æˆå•ç‚¹æ•…éšœï¼Œå¦‚æœæœ‰ä¸€å°æœåŠ¡å™¨å®•æœºï¼Œé‚£ä¹ˆè¯¥å°æœåŠ¡å™¨ä¸Šçš„sessionä¿¡æ¯å°†ä¼šä¸¢å¤±å‰ç«¯ä¸èƒ½æœ‰è´Ÿè½½å‡è¡¡ï¼Œå¦‚æœæœ‰ï¼Œsessionç»‘å®šå°†ä¼šå‡ºé—®é¢˜</li>
</ul>
</blockquote>
<blockquote>
<p><strong>Cookie+ç¼“å­˜</strong></p>
<ul>
<li>å°†ç”¨æˆ·ä¿¡æ¯ä¿å­˜åœ¨<code>Redis</code>ä¸Šï¼Œå°†é”®å€¼æ”¾åœ¨<code>Cookie</code>ä¸­ä¼ é€’ç»™æµè§ˆå™¨ï¼Œæµè§ˆå™¨å†ä¸‹ä¸€æ¬¡çš„è®¿é—®ä¸­å°±ä¼šæºå¸¦è¯¥Cookieã€‚æ­¤æ—¶åˆ©ç”¨<code>æ‹¦æˆªå™¨+è‡ªå®šä¹‰å‚æ•°è§£æå™¨</code> è§£æç”¨æˆ·çš„Cookieï¼Œä»ç¼“å­˜ä¸­è·å–æ•°æ®ä¼ é€’ç»™æ–¹æ³•ã€‚</li>
</ul>
</blockquote>
<p><strong>éƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š</strong></p>
<blockquote>
<p>åˆ©ç”¨Cookie + åŠ ç¼“å­˜ä¿å­˜ç”¨æˆ·ä¿¡æ¯</p>
</blockquote>
<pre><code class="language-java">/**
 * åˆ†å¸ƒå¼Sessionçš„æ€è·¯æ˜¯å°†æ•°æ®å­˜æ”¾åœ¨Redisä¸­
 * å°†æ•°æ®çš„keyæ”¾åœ¨cookieä¸­å‘é€ç»™ç”¨æˆ·
 * ç”¨æˆ·ä¼šæºå¸¦cookieè®¿é—®
 * è·å–æœŸä¸­çš„tokenï¼Œä»redisä¸­è·å–
 * æ¯æ¬¡è®¿é—®éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ï¼Œå»¶é•¿æœ‰æ•ˆæœŸ
 */
private void addCookie(HttpServletResponse response, String token, MiaoshaUser user) {
    //ç”ŸæˆCookie
    //ç”Ÿæˆä¸€ä¸ªéšæœºå­—ç¬¦ä¸²tokenï¼Œå»æ‰&quot;-&quot;
    //å°†token + åŠ ä¸ŠRedisé€šç”¨ç¼“å­˜Keyï¼Œä¿å­˜åœ¨redisä¸­
    redisService.set(MiaoshaUserKey.getByToken(), token, user);
    //ç”ŸæˆCookieï¼Œåªå°†tokenå­˜æ”¾åœ¨cookie,é˜²æ­¢ç”¨æˆ·è·å–å…¶ä»–ç”¨æˆ·ä¿¡æ¯
    Cookie cookie = new Cookie(COOKIE_NAME_TOKEN, token);
    //å°†Cookieçš„æ—¶é—´å’ŒRedisç¼“å­˜æ—¶é—´ä¸€ç›´
    cookie.setMaxAge(MiaoshaUserKey.getByToken().expireSeconds());
    //å°†Cookieå­˜æ”¾åœ¨æ ¹ç›®å½•
    cookie.setPath(&quot;/&quot;);
    ////å°†Cookieè¿”å›ç»™æµè§ˆå™¨
    response.addCookie(cookie);
}
</code></pre>
<h3 id="32-é¡µé¢ç¼“å­˜-urlç¼“å­˜">3.2  é¡µé¢ç¼“å­˜ + URLç¼“å­˜</h3>
<p>é¡µé¢ç¼“å­˜å’ŒURLç¼“å­˜ä¸»è¦å·®å¼‚åœ¨äºURLç¼“å­˜<strong>ä¼šæ ¹æ®URLçš„å˜åŒ–ï¼Œæ•°æ®ä¼šæœ‰æ‰€ä¸åŒ</strong>ï¼Œå¦‚æŸä¸ªå•†å“çš„è¯¦ç»†ä¿¡æ¯ã€è§†é¢‘çš„è¯¦ç»†ä¿¡æ¯ç­‰ã€‚</p>
<p>æ•…åªä»‹ç»å•†å“åˆ—è¡¨é¡µé¢ç¼“å­˜æŠ€æœ¯ï¼š</p>
<blockquote>
<p><strong>é¡µé¢ç¼“å­˜</strong></p>
<ul>
<li>å½“å®¢æˆ·çš„è¯·æ±‚åˆ°è¾¾åç«¯æ—¶ï¼Œ<code>å…ˆå»redisä¸­æŸ¥è¯¢ç¼“å­˜ï¼Œå¦‚æœç¼“å­˜ä¸­æ‰¾ä¸åˆ°ï¼Œåˆ™è¿›è¡Œæ•°æ®åº“é€»è¾‘æ“ä½œï¼Œç„¶åæ¸²æŸ“ï¼Œå­˜å…¥ç¼“å­˜å¹¶è¿”å›ç»™å‰ç«¯</code></li>
<li>å¦‚æœåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°äº†åˆ™ç›´æ¥è¿”å›ç»™å‰ç«¯ã€‚</li>
<li>å­˜å‚¨åœ¨Redisç¼“å­˜ä¸­çš„é¡µé¢éœ€è¦è®¾ç½®è¶…æ—¶æ—¶é—´ï¼Œç¼“å­˜çš„æ—¶é—´é•¿åº¦æ ¹æ®é¡µé¢æ•°æ®å˜åŒ–é¢‘ç¹ç¨‹åº¦é€‚å½“è°ƒæ•´ã€‚ç›®å‰å¤§å¤šæ•°é¡µé¢<code>ç¼“å­˜éƒ½æ˜¯åœ¨60~120ç§’</code>ï¼Œå°‘æ•°å‡ ä¹ä¸å˜åŒ–çš„å¯ä»¥è°ƒæ•´åˆ°5åˆ†é’Ÿ!</li>
</ul>
</blockquote>
<p><strong>éƒ¨åˆ†ä»£ç å®ç°</strong>ï¼š</p>
<blockquote>
<p>å•†å“åˆ—è¡¨çš„Controllerå±‚</p>
</blockquote>
<pre><code class="language-java">    @RequestMapping(value = &quot;/to_list&quot;, produces = &quot;text/html&quot;)
    @ResponseBody
    public String toGoods(Model model, MiaoshaUser user,
                          final HttpServletRequest request,
                          final HttpServletResponse response) {

        //å–ç¼“å­˜
        String html;
        html = redisService.get(GoodsKey.getGoodsList(), &quot;&quot;, String.class);
        if (html != null) {//å¦‚æœç¼“å­˜æœ‰è¿™ä¸ªé¡µé¢
            return html;
        } else {//å¦‚æœæ²¡æœ‰è¿™ä¸ªé¡µé¢
            //è®¿é—®æ•°æ®åº“è·å–å•†å“æ•°æ®
            List&lt;GoodsVo&gt; goodsList = goodsService.listGoodsVo();
            if (user != null) {
                //å¦‚æœæœ‰ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ™ä¿å­˜åœ¨Modelä¸­
                model.addAttribute(&quot;user&quot;, user);
            }
            //å°†å•†å“æ•°æ®ä¿å­˜åœ¨Modelä¸­
            model.addAttribute(&quot;goodsList&quot;, goodsList);

            //æ‰‹åŠ¨æ¸²æŸ“
            SpringWebContext springWebContext = new SpringWebContext(request, response, request.getServletContext(), request.getLocale(), model.asMap(), context);
            html = viewResolver.getTemplateEngine().process(&quot;goods_list&quot;, springWebContext);
            if (!StringUtils.isEmpty(html)) {
                //ä¿å­˜åˆ°ç¼“å­˜ï¼Œç¼“å­˜æ—¶é—´åªæœ‰60ç§’ï¼Œä¸å®œè¿‡é•¿
                redisService.set(GoodsKey.getGoodsList(), &quot;&quot;, html);
            }
            //è¿”å›åˆ°æµè§ˆå™¨
            return html;
        }

    }
</code></pre>
<p><strong>æ¥ä¸‹æ¥ä½¿ç”¨Jmeterå¯åŠ¨1ä¸‡ä¸ªçº¿ç¨‹è¿›è¡Œå‹æµ‹ï¼š</strong></p>
<blockquote>
<p>ä¼˜åŒ–å‰ï¼Œå¯ä»¥çœ‹çš„<code>ååé‡è¾¾åˆ°584.8</code><br>
<img src="en-resource://database/948:1" alt="55bc54085c699c92fc6a66b4986169c9.png" loading="lazy"></p>
</blockquote>
<blockquote>
<p>ä¼˜åŒ–åï¼Œå¯ä»¥çœ‹çš„<code>ååé‡è¾¾åˆ°2085.9</code><br>
<img src="en-resource://database/946:1" alt="87002fe601459eaaff41c543660a6592.png" loading="lazy"></p>
</blockquote>
<h3 id="33-å¯¹è±¡çº§ç¼“å­˜">3.3 å¯¹è±¡çº§ç¼“å­˜</h3>
<p>ç›¸æ¯”é¡µé¢ç¼“å­˜æ˜¯æ›´ç»†ç²’åº¦ç¼“å­˜ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œ ä¸ä¼šå¤§è§„æ¨¡ä½¿ç”¨é¡µé¢ç¼“å­˜ï¼Œå› ä¸ºæ¶‰åŠåˆ°åˆ†é¡µï¼Œä¸€èˆ¬åªç¼“å­˜å‰é¢1-2é¡µã€‚å¯¹è±¡ç¼“å­˜å°±æ˜¯ å½“ç”¨åˆ°ç”¨æˆ·æ•°æ®çš„æ—¶å€™ï¼Œå¯ä»¥ä»ç¼“å­˜ä¸­å–å‡ºã€‚</p>
<p><strong>éœ€è¦æ³¨æ„ä¸¤ä¸ªé—®é¢˜</strong>ï¼š</p>
<ul>
<li>ä¸€æ—¦æ•°æ®å‘ç”Ÿæ›´æ”¹ï¼Œä¸€å®šè¦å°†ç¼“å­˜å¤±æ•ˆ</li>
<li>Serviceä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œåˆ‡å¿Œä¸èƒ½ç›´æ¥è°ƒç”¨DAOï¼Œå› ä¸ºå¯èƒ½ä¸­é—´è°ƒç”¨äº†ç¼“å­˜</li>
</ul>
<p><strong>éƒ¨åˆ†ä»£ç å®ç°</strong>ï¼š</p>
<blockquote>
<p>ä¿å­˜ç”¨æˆ·ä¿¡æ¯</p>
</blockquote>
<pre><code class="language-java">/**
 * è¿™ä¸ªæ˜¯å¯¹è±¡çº§çš„ç¼“å­˜
 * ä»ç¼“å­˜ä¸­å–å‡ºç”¨æˆ·ä¿¡æ¯
 * &lt;p&gt;
 * å’Œé¡µé¢ç¼“å­˜æœ€å¤§çš„åŒºåˆ«æ˜¯ï¼š1.æ—¶é—´æ˜¯æ°¸ä¹…çš„ 2.å½“å¯¹è±¡å‘ç”Ÿæ›´æ–°æ—¶ï¼Œéœ€åˆ é™¤æˆ–è€…æ›´æ–°ç¼“å­˜
 * &lt;p&gt;
 * ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒServiceä¹‹é—´ç›¸äº’è°ƒç”¨ï¼Œåˆ‡å¿Œä¸èƒ½ç›´æ¥è°ƒç”¨DAOï¼Œå› ä¸ºå¯èƒ½ä¸­é—´è°ƒç”¨äº†ç¼“å­˜
 */
public MiaoshaUser getById(long id) {
    //å–ç¼“å­˜
    MiaoshaUser user;
    user = redisService.get(MiaoshaUserKey.getById(), &quot;:&quot; + id, MiaoshaUser.class);
    if (user != null) {
        return user;
    } else {
        //å–æ•°æ®åº“ï¼ŒåŠ å…¥åˆ°ç¼“å­˜ä¸­
        user = miaoshaUserDao.getById(id);
        redisService.set(MiaoshaUserKey.getById(), &quot;:&quot; + id, user);
        return user;
    }
}
</code></pre>
<h3 id="34-æ ¸å¿ƒæ¥å£ä¼˜åŒ–">3.4 æ ¸å¿ƒæ¥å£ä¼˜åŒ–</h3>
<blockquote>
<p><strong>æ ¸å¿ƒçš„ä¸šåŠ¡æ¥å£ä¼˜åŒ–ä¸»è¦æ€è·¯æ˜¯</strong>ï¼š</p>
<ul>
<li>ä½¿ç”¨åˆ©ç”¨Redisä¿å­˜<code>å•†å“åº“å­˜çš„æ•°é‡</code>ã€<code>ç”¨æˆ·çš„ç§’æ€æˆåŠŸçš„è®¢å•ä¿¡æ¯</code>å’Œ<code>å•†å“æ˜¯å¦ç§’æ€å®Œçš„æ ‡è®°</code>ï¼Œè¿™æ ·è¯·æ±‚æ›´å¤šçš„è®¿é—®ç¼“å­˜ï¼Œå‡å°‘å¯¹æ•°æ®åº“çš„å‹åŠ›</li>
<li>è‹¥ç”¨æˆ·ç§’æ€æˆåŠŸï¼Œåˆ©ç”¨<code>RabbitMQå®ç°å¼‚æ­¥ä¸‹å•ï¼ŒæœåŠ¡å™¨æ§åˆ¶è®¿é—®æ•°æ®åº“çš„å‹åŠ›ï¼Œè®©ç”¨æˆ·æš‚æ—¶ç­‰å¾…</code>ï¼Œè¿™æ ·å¯ä»¥ä¼˜åŒ–ç”¨æˆ·çš„ä½“éªŒï¼Œé˜²æ­¢å‡ºç°æœåŠ¡å™¨å®•æœºç­‰é—®é¢˜</li>
</ul>
</blockquote>
<p><strong>éƒ¨åˆ†ä»£ç å¦‚ä¸‹æ‰€ç¤º</strong>ï¼š</p>
<blockquote>
<p>ç§’æ€æ¥å£Controller</p>
</blockquote>
<pre><code class="language-java">@RequestMapping(value = &quot;/{path}/do_miaosha&quot;, method = RequestMethod.POST)
@ResponseBody
public Result&lt;Integer&gt; do_miaosha(MiaoshaUser user,
                                  @RequestParam(&quot;goodsId&quot;) long goodsId,
                                  @PathVariable(&quot;path&quot;) String path) {

    //åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•ï¼Œå¦‚æœæ²¡ç”¨ç™»å½•ï¼Œåˆ™ä¼ é€’æç¤ºä¿¡æ¯
    if (user == null) {
        return Result.error(CodeMsg.SESSION_ERROR);
    }

    //éšè—äº†è®¿é—®æ¥å£ï¼Œéœ€è¦éªŒè¯path
    if (StringUtils.isEmpty(path)) {
        return Result.error(CodeMsg.REQUEST_ILLEGAL);
    }
    boolean check = miaoshaService.checkPath(path, user.getId(), goodsId);
    if (!check) {
        return Result.error(CodeMsg.REQUEST_ILLEGAL);
    }
    
    //åˆ¤æ–­æ˜¯å¦ç§’æ€åˆ°äº†
    MiaoshaOrder order = orderService.getMiaoshaOrderByUserIdGoodsId(user.getId(), goodsId);
    //å¦‚æœèƒ½å¤Ÿè·å–è®¢å•ï¼Œè¯´æ˜è¯¥ç”¨æˆ·å·²ç»ç§’æ€åˆ°å•†å“
    if (order != null) {
        return Result.error(CodeMsg.REPEATE_MIAO_SHA);
    }
    //åˆ¤æ–­æ˜¯å¦ç§’æ€å·²ç»ç»“æŸ
    Boolean over = localOverMap.get(goodsId);
    if (over) {
        return Result.error(CodeMsg.MIAO_SHA_OVER);
    }

    //é¢„å‡åº“å­˜
    long stock = redisService.decr(GoodsKey.getMiaoGoodsStock(), &quot;:&quot; + goodsId);
    if (stock &lt; 0) {//å¦‚æœå‘ç°åº“å­˜ä¸è¶³ï¼Œåˆ™å°†ç§’æ€ç»“æŸçš„æ ‡è®°ç½®æˆtrue
        localOverMap.put(goodsId, true);
        return Result.error(CodeMsg.MIAO_SHA_OVER);
    }

    //ä¿å­˜ä¿¡æ¯
    MiaoshaMessage miaoshaMessage = new MiaoshaMessage();
    miaoshaMessage.setGoodsId(goodsId);
    miaoshaMessage.setUser(user);
    //å…¥é˜Ÿï¼Œå®ç°å¼‚æ­¥ä¸‹å•
    mqSender.sendMiaoshaMessage(miaoshaMessage);
    //è¿”å›å®¢æˆ·ç«¯è®¢å•å¤„ç†ä¸­
    return Result.success(0);//æ’é˜Ÿä¸­
}
</code></pre>
<blockquote>
<p>æ¶ˆæ¯çš„å‘é€è€…</p>
</blockquote>
<pre><code class="language-java">public void sendMiaoshaMessage(MiaoshaMessage miaoshaMessage) {
    //å°†æ•°æ®åºåˆ—åŒ–å­—ç¬¦ä¸²
    String str = SerializableUtil.beanToString(miaoshaMessage);
    //å‘é€æ¶ˆæ¯
    amqpTemplate.convertAndSend(MQConfig.MIAOSHA_QUEUE,str);
}
</code></pre>
<blockquote>
<p>æ¶ˆæ¯çš„æ¥æ”¶è€…</p>
</blockquote>
<pre><code class="language-java">@RabbitListener(queues = MQConfig.MIAOSHA_QUEUE)
public void miaoshaReceive(String message) {
    //å°†æ¶ˆæ¯ååºåˆ—åŒ–
    MiaoshaMessage miaoshaMessage = SerializableUtil.stringToBean(message, MiaoshaMessage.class);
    //è·å–ç”¨æˆ·
    MiaoshaUser user = miaoshaMessage.getUser();
    //è·å–ç”¨æˆ·id
    long goodsId = miaoshaMessage.getGoodsId();
    //å†æ¬¡åˆ¤æ–­åº“å­˜æ˜¯å¦è¶³å¤Ÿ
    GoodsVo goods = goodsService.getGoodsVoByGoodsId(goodsId);
    Integer stockCount = goods.getStockCount();
    //å¦‚æœåº“å­˜ä¸è¶³ï¼Œåˆ™ç›´æ¥è¿”å›
    if (stockCount &lt;= 0) {
        return;
    }
    //å‡åº“å­˜ ä¸‹è®¢å• å†™å…¥è®¢å• ä¸€ä¸ªäº‹åŠ¡ä¸­
    miaoshaService.miaosha(user, goods);
}
</code></pre>
<blockquote>
<p>è®¢å•çš„å¤„ç†</p>
</blockquote>
<pre><code class="language-java">@Transactional
public OrderInfo miaosha(MiaoshaUser user, GoodsVo goods) {
    //å‡åº“å­˜
    boolean success = goodsService.reduceStock(goods);
    if (success){
        //ä¸‹è®¢å•
        return orderService.creatOrder(user,goods);
    }else {
        //å¦‚æœåº“å­˜ä¸è¶³ï¼Œè®¾ç½®å•†å“å·²ç»å–å®Œ
        setGoodsOver(goods.getId());
    }
    return null;
}

/**
 * è®¾ç½®å•†å“å·²ç»å–å®Œ
 */
private void setGoodsOver(Long id) {
    redisService.set(MiaoshaKey.getMiaoshaOver(),&quot;:&quot;+id,true);
}
</code></pre>
<p><strong>æ¥ä¸‹æ¥ä½¿ç”¨Jmeterå¯åŠ¨1ä¸‡ä¸ªçº¿ç¨‹ï¼Œæ¨¡æ‹Ÿ5000ä¸ªç”¨æˆ·è¿›è¡Œå‹æµ‹</strong>ï¼š</p>
<blockquote>
<p>ä¼˜åŒ–å‰ï¼Œå¯ä»¥çœ‹çš„<code>ååé‡è¾¾åˆ°351.8</code><br>
<img src="en-resource://database/950:1" alt="d1c3599b1b848a55b7270ab5e2491162.png" loading="lazy"></p>
</blockquote>
<blockquote>
<p>ä¼˜åŒ–åï¼Œå¯ä»¥çœ‹çš„<code>ååé‡è¾¾åˆ°2242.7</code><br>
<img src="en-resource://database/952:1" alt="cfd03964c83a1181d88a19802e1d1f84.png" loading="lazy"></p>
</blockquote>
<h3 id="35-æ¥å£å®‰å…¨ä¼˜åŒ–">3.5 æ¥å£å®‰å…¨ä¼˜åŒ–</h3>
<p>æ¥å£çš„å®‰å…¨ä¼˜åŒ–ä¸»è¦çš„é˜²æ­¢æ¶æ„ç”¨æˆ·çš„è®¿é—®ï¼Œä»¥åŠå‡å°‘ç¬æ—¶ç”¨æˆ·çš„å¹¶å‘é‡</p>
<blockquote>
<p><strong>æ¥å£éšè—</strong></p>
</blockquote>
<ul>
<li>ç”±äºå‰ç«¯çš„ä»£ç åœ¨æµè§ˆå™¨ï¼Œæ‰€ä»¥å¯ä»¥è½»æ˜“çš„è·å–åˆ°æ ¸å¿ƒä¸šåŠ¡çš„æ¥å£</li>
<li><strong>è§£å†³</strong>ï¼šåœ°å€æ˜¯åœ¨å®¢æˆ·ç«¯åŠ¨æ€ç”Ÿæˆçš„ï¼Œå‰ç«¯éœ€è¦å…ˆè·å–åœ°å€ä¿¡æ¯ï¼Œç„¶ååœ¨å‘é€ç»™æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨ä¼šå¯¹æµè§ˆå™¨çš„åœ°å€è¿›è¡Œå¤„ç†å¹¶å’ŒçœŸå®çš„åœ°å€è¿›è¡Œæ¯”è¾ƒ</li>
</ul>
<blockquote>
<p><strong>æ•°å­¦é—®é¢˜éªŒè¯ç </strong></p>
<ul>
<li>éªŒè¯ç ä¸»è¦é˜²æ­¢æœºå™¨äººçš„å¤§é‡è®¿é—®ï¼Œä»¥åŠå°†ç”¨æˆ·çš„è¯·æ±‚åˆ†æ•£å¼€ï¼Œé¿å…é›†ä¸­çš„ä¸‹å•<br>
<strong>è§£å†³</strong>ï¼šæœåŠ¡å™¨ç”ŸæˆéªŒè¯ç ï¼Œé€šè¿‡å‰ç«¯è¾“å…¥è¿›è¡ŒéªŒè¯</li>
</ul>
</blockquote>
<blockquote>
<p><strong>æ¥å£é˜²åˆ·</strong></p>
<ul>
<li>æ¶æ„ç”¨æˆ·å¯èƒ½ä¼šå¤§é‡çš„è®¿é—®æœåŠ¡å™¨ï¼Œç»™æœåŠ¡å™¨é€ æˆå‹åŠ›<br>
<strong>è§£å†³</strong>ï¼šåˆ©ç”¨ç¼“å­˜ï¼Œä¿å­˜ä¸€å®šæ—¶é—´çš„è®¿é—®æ•°ï¼Œå¦‚æœè¶…è¿‡ä¸€å®šé™åˆ¶ï¼Œåˆ™ç›´æ¥æ‹’ç»è®¿é—®</li>
</ul>
</blockquote>
<h2 id="å››-é¡¹ç›®å®è·µä¸­é‡åˆ°çš„é—®é¢˜">å››ã€ é¡¹ç›®å®è·µä¸­é‡åˆ°çš„é—®é¢˜</h2>
<h3 id="41-ç§’æ€æˆåŠŸå•†å“è®¢å•æ•°è¶…è¿‡é¢„è®¢æ•°å€¼">4.1  ç§’æ€æˆåŠŸå•†å“è®¢å•æ•°è¶…è¿‡é¢„è®¢æ•°å€¼</h3>
<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>è¯¥é—®é¢˜ä¸»è¦å› ä¸ºåœ¨é«˜å¹¶å‘ä¸‹ï¼Œçº¿ç¨‹ä¸å®‰å…¨å¯¼è‡´çš„</li>
<li>åœ¨åˆ¤æ–­æ˜¯å¦ç§’æ€æˆåŠŸæ—¶ï¼Œå¤šä¸ªç”¨æˆ·é€šè¿‡äº†åˆ¤æ–­ï¼Œç„¶åæ‰å‡å°‘äº†åº“å­˜</li>
</ul>
<p><strong>é—®é¢˜è§£å†³</strong>ï¼š</p>
<ul>
<li>MySQLæ•°æ®åº“åœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œä¼šè‡ªåŠ¨åŠ é”</li>
<li>åœ¨SQLè¯­å¥ä¸­å‡å°‘åº“å­˜æ—¶ï¼Œåˆ¤æ–­åº“å­˜æ˜¯å¦å¤§äº0ï¼Œå¦‚æœä¸æ˜¯åˆ™æ‰§è¡Œå¤±è´¥ï¼Œè®¢å•å›æ»š</li>
</ul>
<h3 id="42-ä¸€ä¸ªç”¨æˆ·çš„å¤šä¸ªè¯·æ±‚å¯¼è‡´ç§’æ€æˆåŠŸç§’æ€å¤šæ¬¡">4.2  ä¸€ä¸ªç”¨æˆ·çš„å¤šä¸ªè¯·æ±‚å¯¼è‡´ç§’æ€æˆåŠŸç§’æ€å¤šæ¬¡</h3>
<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>ç”±äºé‡‡ç”¨çš„å¼‚æ­¥ä¸‹å•ï¼Œåœ¨è¯¥ç”¨æˆ·è®¢å•æ²¡æœ‰å®Œæˆæ—¶ï¼Œåˆ™å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªç”¨æˆ·åŒæ—¶ä¸‹å¤šä¸ªè®¢å•</li>
</ul>
<p><strong>é—®é¢˜è§£å†³</strong>ï¼š</p>
<ul>
<li>è®¾è®¡æ•°æ®åº“è¡¨æ—¶ï¼Œå¤šè®¾è®¡ä¸€ä¸ªç§’æ€çš„è®¢å•ï¼Œå’Œæ™®é€šçš„è®¢å•åˆ†ç¦»</li>
<li>åœ¨ç§’æ€è®¢å•ä¸Šï¼Œuser_idé‡‡ç”¨å”¯ä¸€ç´¢å¼•</li>
</ul>
<h3 id="43-ä½¿ç”¨äº†ç¼“å­˜ä¾ç„¶ä¼šå¤§é‡è®¿é—®æ•°æ®åº“">4.3 ä½¿ç”¨äº†ç¼“å­˜ä¾ç„¶ä¼šå¤§é‡è®¿é—®æ•°æ®åº“</h3>
<p><strong>é—®é¢˜åˆ†æ</strong>ï¼š</p>
<ul>
<li>ç”±äºä¸ºäº†ç®€ä¾¿ï¼Œåœ¨Serviceä¸Šé¢ç»Ÿç»ŸåŠ äº†@Transactionalæ³¨è§£ï¼Œä¼šå¯¼è‡´æ‰€æœ‰çš„æ–¹æ³•å¯ç”¨äº‹åŠ¡</li>
<li>æ­¤æ—¶å³ä½¿ä½¿ç”¨äº†ç¼“å­˜ï¼Œä¹Ÿä¾ç„¶ä¼šè®¿é—®æ•°æ®åº“ï¼Œæœ€ç»ˆé€ æˆæ•°æ®åº“å‹åŠ›è¿‡å¤§</li>
</ul>
<p><strong>é—®é¢˜è§£å†³</strong>ï¼š</p>
<ul>
<li>åªåœ¨éœ€è¦äº‹åŠ¡çš„æ–¹æ³•ä¸Šä½¿ç”¨@Transactionaæ³¨è§£ï¼Œæé«˜æ€§èƒ½</li>
</ul>
<h2 id="äº”-æ¥ä¸‹æ¥çš„ä¼˜åŒ–æ€è·¯">äº”ã€ æ¥ä¸‹æ¥çš„ä¼˜åŒ–æ€è·¯</h2>
<ul>
<li><code>é™æ€èµ„æºä¼˜åŒ–</code></li>
<li><code>CDNåŠ é€Ÿ</code></li>
<li><code>Nginxæ°´å¹³æ‰©å±•</code></li>
</ul>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E9%A1%B9%E7%9B%AE%E7%AE%80%E4%BB%8B">ä¸€ã€é¡¹ç›®ç®€ä»‹</a></li>
<li><a href="#%E4%BA%8C-%E6%8A%80%E6%9C%AF%E6%A0%88">äºŒã€æŠ€æœ¯æ ˆ</a></li>
<li><a href="#%E4%B8%89-%E8%AF%A6%E7%BB%86%E5%AE%9E%E7%8E%B0">ä¸‰ã€è¯¦ç»†å®ç°</a>
<ul>
<li><a href="#31-%E5%88%86%E5%B8%83%E5%BC%8Fsession">3.1 åˆ†å¸ƒå¼Session</a></li>
<li><a href="#32-%E9%A1%B5%E9%9D%A2%E7%BC%93%E5%AD%98-url%E7%BC%93%E5%AD%98">3.2  é¡µé¢ç¼“å­˜ + URLç¼“å­˜</a></li>
<li><a href="#33-%E5%AF%B9%E8%B1%A1%E7%BA%A7%E7%BC%93%E5%AD%98">3.3 å¯¹è±¡çº§ç¼“å­˜</a></li>
<li><a href="#34-%E6%A0%B8%E5%BF%83%E6%8E%A5%E5%8F%A3%E4%BC%98%E5%8C%96">3.4 æ ¸å¿ƒæ¥å£ä¼˜åŒ–</a></li>
<li><a href="#35-%E6%8E%A5%E5%8F%A3%E5%AE%89%E5%85%A8%E4%BC%98%E5%8C%96">3.5 æ¥å£å®‰å…¨ä¼˜åŒ–</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5%E4%B8%AD%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98">å››ã€ é¡¹ç›®å®è·µä¸­é‡åˆ°çš„é—®é¢˜</a>
<ul>
<li><a href="#41-%E7%A7%92%E6%9D%80%E6%88%90%E5%8A%9F%E5%95%86%E5%93%81%E8%AE%A2%E5%8D%95%E6%95%B0%E8%B6%85%E8%BF%87%E9%A2%84%E8%AE%A2%E6%95%B0%E5%80%BC">4.1  ç§’æ€æˆåŠŸå•†å“è®¢å•æ•°è¶…è¿‡é¢„è®¢æ•°å€¼</a></li>
<li><a href="#42-%E4%B8%80%E4%B8%AA%E7%94%A8%E6%88%B7%E7%9A%84%E5%A4%9A%E4%B8%AA%E8%AF%B7%E6%B1%82%E5%AF%BC%E8%87%B4%E7%A7%92%E6%9D%80%E6%88%90%E5%8A%9F%E7%A7%92%E6%9D%80%E5%A4%9A%E6%AC%A1">4.2  ä¸€ä¸ªç”¨æˆ·çš„å¤šä¸ªè¯·æ±‚å¯¼è‡´ç§’æ€æˆåŠŸç§’æ€å¤šæ¬¡</a></li>
<li><a href="#43-%E4%BD%BF%E7%94%A8%E4%BA%86%E7%BC%93%E5%AD%98%E4%BE%9D%E7%84%B6%E4%BC%9A%E5%A4%A7%E9%87%8F%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93">4.3 ä½¿ç”¨äº†ç¼“å­˜ä¾ç„¶ä¼šå¤§é‡è®¿é—®æ•°æ®åº“</a></li>
</ul>
</li>
<li><a href="#%E4%BA%94-%E6%8E%A5%E4%B8%8B%E6%9D%A5%E7%9A%84%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF">äº”ã€ æ¥ä¸‹æ¥çš„ä¼˜åŒ–æ€è·¯</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">

	  
		<div id="gitalk-container"></div>
		<!--è¯„è®ºæ˜¾ç¤ºåŒºï¼Œè¯·æ’å…¥åˆé€‚çš„ä½ç½®-->
<div id="comment"></div>
<!--Leancloud æ“ä½œåº“:-->
<script src="//cdn1.lncld.net/static/js/3.6.1/av-min.js"></script>
<!--Valine çš„æ ¸å¿ƒä»£ç åº“-->
<script src="//cdn.jsdelivr.net/npm/valine@1.4.4/dist/Valine.min.js"></script>
<script>
    new Valine({
        el:'#comment',
        appId: 'DysN4QrSvmmE6SpDXopbCLD6-gzGzoHsz',
        appKey: 'mjK643yLFa4WWXtobofr24Ap',
        placeholder: 'ãƒ¾ï¾‰â‰§âˆ€â‰¦)oå¿«æ¥è¯„è®ºä¸€ä¸‹å§!',
        avatar:''
    });
</script>
	  
		  
	  

</div></section>
</div></div></div><script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var list=document.querySelectorAll(".katex");for(var i=0;i<list.length;i++){list[i].style.display="unset"};
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
content="æœ¬æ–‡æœ€åæ›´æ–°äº2020-06-27ï¼Œå·²è¶…è¿‡ 1 å¹´æ²¡æœ‰æ›´æ–°ï¼Œæ¶‰åŠçš„å†…å®¹å¯èƒ½å·²ç»å¤±æ•ˆï¼";var date1="2020-06-27 12:07:10";date1=date1.replace("-","/");var date2=new Date();var date3=date2.getTime()-new Date(date1).getTime();var days=Math.floor(date3/(24*3600*1000));if(days>=365){document.getElementById("warn").innerHTML=content};
</script>
<style>#magnifyImg{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#magnifyImg img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Copyright Â© 2018-2020 <a href="https://xzzz2020.github.io" style="margin:0;">xzzz2020</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_pv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>15</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://xzzz2020.github.io/media/js/prism.js"></script>
</body>
</html>