<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://xzzz2020.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="温故而知新"><meta charset="UTF-8"><title>【总结】数据库基础 | xzzz2020</title>
<link href="https://xzzz2020.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://xzzz2020.github.io/media/css/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://xzzz2020.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<link rel="canonical" href="https://xzzz2020.github.io/post/74It5jkMz/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >本页面需要浏览器支持（启用）JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://xzzz2020.github.io"><img alt="logo" style="display:inline-block;" src="https://xzzz2020.github.io/images/avatar.png"/></a><h1 title="xzzz2020" class="weaklink"><a  href="/">xzzz2020</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >首页</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >归档</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >标签</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >关于</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >友链</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >首页</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >归档</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >标签</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >关于</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >友链</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1599740351189" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>【总结】数据库基础</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="繁"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="简"}else{if(document.getElementById("lan").innerText=="簡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="繁"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2020-07-26</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px">	<a href="https://xzzz2020.github.io/tag/MySQL/" class="tag">MySQL</a> | 	<a href="https://xzzz2020.github.io/tag/Interview_summary/" class="tag">面试总结</a></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">4971字</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">18 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="调整简繁体" style="margin-right:15px;">繁</a>
</section>

<img class="featureImg" alt="featureimg" src="https://img-1302474103.cos.ap-nanjing.myqcloud.com/img/photo-1593642703055-4b72c180d9b5.webp" referrerpolicy="no-referrer">

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<blockquote>
<p>该文章为知识总结的文章，如果是初学者，建议先从专栏学习：<a href="https://blog.csdn.net/qq_43040688/category_9832814.html">数据库专栏</a></p>
</blockquote>
<p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E8%83%BD%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AFmysql%E5%90%97">一、能简单介绍一下什么是Mysql吗？</a></li>
<li><a href="#%E4%BA%8C-sql-%E7%9A%84%E5%88%86%E7%B1%BB">二、SQL 的分类</a></li>
<li><a href="#%E4%B8%89-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%89%E5%A4%A7%E8%8C%83%E5%BC%8F">三、数据库三大范式</a>
<ul>
<li><a href="#1-%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F">1. 第一范式</a></li>
<li><a href="#2-%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F">2. 第二范式</a></li>
<li><a href="#3-%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F">3. 第三范式</a></li>
<li><a href="#4-%E6%80%BB%E7%BB%93">4. 总结</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%AE%80%E4%BB%8B">四、事务的简介</a></li>
<li><a href="#%E4%BA%94-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%89%B9%E6%80%A7">五、事务的特性</a>
<ul>
<li><a href="#1-%E5%8E%9F%E5%AD%90%E6%80%A7">1. 原子性</a></li>
<li><a href="#2-%E4%B8%80%E8%87%B4%E6%80%A7">2. 一致性</a></li>
<li><a href="#3-%E9%9A%94%E7%A6%BB%E6%80%A7">3. 隔离性</a></li>
<li><a href="#4-%E6%8C%81%E4%B9%85%E6%80%A7">4. 持久性</a></li>
</ul>
</li>
<li><a href="#%E5%85%AD-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98">六、并发事务出现的问题</a></li>
<li><a href="#%E4%B8%83-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB">七、事务隔离级别</a>
<ul>
<li><a href="#1-%E5%9B%9B%E4%B8%AA%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB">1. 四个隔离级别</a></li>
</ul>
</li>
<li><a href="#%E5%85%AB-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81%E5%92%8C%E5%B9%B6%E5%8F%91%E7%AD%96%E7%95%A5">八、数据库锁和并发策略</a>
<ul>
<li><a href="#1-%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%81">1. 常见的锁</a></li>
<li><a href="#2-%E9%A1%B5%E7%BA%A7%E9%94%81">2. 页级锁</a></li>
<li><a href="#3-%E4%B9%90%E8%A7%82%E9%94%81">3. 乐观锁</a></li>
<li><a href="#4-%E6%82%B2%E8%A7%82%E9%94%81">4. 悲观锁</a></li>
<li><a href="#5-innodb%E9%94%81%E7%AE%97%E6%B3%95">5. InnoDB锁算法</a></li>
</ul>
</li>
<li><a href="#%E4%B9%9D-%E7%BB%99%E5%AE%9A%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E%E8%AE%BE%E8%AE%A1%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%80%9D%E8%B7%AF">九、给定业务场景说明设计数据库的思路</a></li>
<li><a href="#%E5%8D%81-%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AF%E6%B1%A0%E5%8C%96%E8%AE%BE%E8%AE%A1">十、说一下什么是池化设计</a></li>
<li><a href="#%E5%8D%81%E4%B8%80-%E4%B8%80%E6%9D%A1sql%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0">十一、一条SQL语句执行慢的原因？</a>
<ul>
<li><a href="#1-%E5%88%86%E7%B1%BB%E8%AE%A8%E8%AE%BA">1. 分类讨论</a></li>
<li><a href="#2-%E9%92%88%E5%AF%B9%E5%81%B6%E5%B0%94%E5%BE%88%E6%85%A2%E7%9A%84%E6%83%85%E5%86%B5">2. 针对偶尔很慢的情况</a>
<ul>
<li><a href="#a-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8%E5%88%B7%E6%96%B0%E8%84%8F%E9%A1%B5flush">a. 数据库在刷新脏页（flush）</a></li>
<li><a href="#b-%E6%8B%BF%E4%B8%8D%E5%88%B0%E9%94%81%E6%88%91%E8%83%BD%E6%80%8E%E4%B9%88%E5%8A%9E">b. 拿不到锁我能怎么办</a></li>
</ul>
</li>
<li><a href="#3-%E9%92%88%E5%AF%B9%E4%B8%80%E7%9B%B4%E9%83%BD%E8%BF%99%E4%B9%88%E6%85%A2%E7%9A%84%E6%83%85%E5%86%B5">3. 针对一直都这么慢的情况</a>
<ul>
<li><a href="#a-%E6%B2%A1%E7%94%A8%E5%88%B0%E7%B4%A2%E5%BC%95">a. 没用到索引</a></li>
<li><a href="#b-%E7%94%A8%E5%88%B0%E4%BA%86%E7%B4%A2%E5%BC%95%E4%BD%86%E6%98%AF%E7%B3%BB%E7%BB%9F%E8%AF%AF%E5%88%A4%E4%BA%86">b. 用到了索引，但是系统误判了</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h2 id="一-能简单介绍一下什么是mysql吗">一、能简单介绍一下什么是Mysql吗？</h2>
<ul>
<li>MySQL 是一种关系型数据库</li>
<li>在Java企业级开发中非常常用，因为 MySQL 是开源免费的</li>
<li>阿里巴巴数据库系统也大量用到了 MySQL，因此它的稳定性是有保障的</li>
<li>MySQL的默认端口号是<strong>3306</strong></li>
</ul>
<h2 id="二-sql-的分类">二、SQL 的分类</h2>
<ul>
<li>
<p><strong>DQL--数据查询语言</strong>：代表关键字:select</p>
</li>
<li>
<p><strong>DML--数据操纵语言</strong>：代表关键字:insert,delete,update</p>
</li>
<li>
<p><strong>DDL--数据定义语言</strong>：代表关键字:create ,drop,alter,</p>
</li>
<li>
<p><strong>TCL--事务控制语言</strong>：代表关键字:commit ,rollback;</p>
</li>
<li>
<p><strong>DCL--数据控制语言</strong>：代表关键字:grant,revoke.</p>
</li>
</ul>
<h2 id="三-数据库三大范式">三、数据库三大范式</h2>
<h3 id="1-第一范式">1. 第一范式</h3>
<p><code>数据库表中不能出现重复记录，每个字段是原子性的不能再分</code></p>
<table>
<thead>
<tr>
<th style="text-align:center">学生编号</th>
<th style="text-align:center">学生姓名</th>
<th style="text-align:center">联系方式</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1001</td>
<td style="text-align:center">张三</td>
<td style="text-align:center">zs@gmail.com,1359999999</td>
</tr>
<tr>
<td style="text-align:center">1002</td>
<td style="text-align:center">李四</td>
<td style="text-align:center">ls@gmail.com,13699999999</td>
</tr>
<tr>
<td style="text-align:center">1001</td>
<td style="text-align:center">王五</td>
<td style="text-align:center">ww@163.net,13488888888</td>
</tr>
</tbody>
</table>
<ul>
<li>学生编号重复，因为没有主键</li>
<li>联系方式既有邮箱和电话</li>
</ul>
<p>因此需要修改成如下形式：</p>
<table>
<thead>
<tr>
<th>学生编号(pk)</th>
<th>学生姓名</th>
<th>email</th>
<th>联系电话</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>张三</td>
<td>zs@gmail.com</td>
<td>1359999999</td>
</tr>
<tr>
<td>1002</td>
<td>李四</td>
<td>ls@gmail.com</td>
<td>13699999999</td>
</tr>
<tr>
<td>1003</td>
<td>王五</td>
<td>ww@163.net</td>
<td>13488888888</td>
</tr>
</tbody>
</table>
<ul>
<li>每个行必须唯一，且存在主键</li>
<li>列不能再分</li>
</ul>
<h3 id="2-第二范式">2. 第二范式</h3>
<p><code>要求所有非主键字段完全依赖主键，不能产生部分依赖</code></p>
<table>
<thead>
<tr>
<th>学生编号(PK)</th>
<th>教师编号(PK)</th>
<th>学生姓名</th>
<th style="text-align:center">教师姓名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>001</td>
<td>张三</td>
<td style="text-align:center">王老师</td>
</tr>
<tr>
<td>1002</td>
<td>002</td>
<td>李四</td>
<td style="text-align:center">赵老师</td>
</tr>
<tr>
<td>1003</td>
<td>001</td>
<td>王五</td>
<td style="text-align:center">王老师</td>
</tr>
<tr>
<td>1001</td>
<td>002</td>
<td>张三</td>
<td style="text-align:center">赵老师</td>
</tr>
<tr>
<td>1001</td>
<td>002</td>
<td>爱迪生</td>
<td style="text-align:center">赵老师</td>
</tr>
</tbody>
</table>
<ul>
<li>如果只是拿学生编号或者教师编号做主键，都不能确定唯一一行数据，所以采用联合主键</li>
<li>学生姓名部分依赖了主键的一个字段学生编号，而没有依赖教师编号，而教师姓名部门依赖了主键<br>
的一个字段教师编号，这就是第二范式部分依赖。</li>
</ul>
<p><strong>解决就是分表</strong>：</p>
<ul>
<li>学生信息表</li>
</ul>
<table>
<thead>
<tr>
<th>学生编号（PK）</th>
<th>学生姓名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>张三</td>
</tr>
<tr>
<td>1002</td>
<td>李四</td>
</tr>
<tr>
<td>1003</td>
<td>王五</td>
</tr>
</tbody>
</table>
<ul>
<li>教师信息表</li>
</ul>
<table>
<thead>
<tr>
<th>教师编号（PK）</th>
<th>教师姓名</th>
</tr>
</thead>
<tbody>
<tr>
<td>001</td>
<td>王老师</td>
</tr>
<tr>
<td>002</td>
<td>赵老师</td>
</tr>
</tbody>
</table>
<ul>
<li>教师和学生的关系表</li>
</ul>
<table>
<thead>
<tr>
<th>学生编号(PK)</th>
<th>教师编号(PK)</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>001</td>
</tr>
<tr>
<td>1002</td>
<td>002</td>
</tr>
<tr>
<td>1003</td>
<td>001</td>
</tr>
<tr>
<td>1001</td>
<td>002</td>
</tr>
</tbody>
</table>
<h3 id="3-第三范式">3. 第三范式</h3>
<p><code>非主键字段不能传递依赖于主键字段。</code></p>
<table>
<thead>
<tr>
<th>学生编号（PK）</th>
<th>学生姓名</th>
<th>班级编号</th>
<th>班级名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>张三</td>
<td>01</td>
<td>一年一班</td>
</tr>
<tr>
<td>1002</td>
<td>李四</td>
<td>02</td>
<td>一年二班</td>
</tr>
<tr>
<td>1003</td>
<td>王五</td>
<td>03</td>
<td>一年三班</td>
</tr>
</tbody>
</table>
<ul>
<li>班级名称字段没有直接依赖于主键，班级名称字段依赖于班级编号，班级编号依赖于学生编号，那么这就是传递依赖</li>
</ul>
<p><strong>继续分表</strong></p>
<ul>
<li>学生信息表</li>
</ul>
<table>
<thead>
<tr>
<th>学生编号（PK）</th>
<th>学生姓名</th>
<th>班级编号</th>
</tr>
</thead>
<tbody>
<tr>
<td>1001</td>
<td>张三</td>
<td>01</td>
</tr>
<tr>
<td>1002</td>
<td>李四</td>
<td>02</td>
</tr>
<tr>
<td>1003</td>
<td>王五</td>
<td>03</td>
</tr>
</tbody>
</table>
<ul>
<li>班级信息表</li>
</ul>
<table>
<thead>
<tr>
<th>班级编号</th>
<th>班级名称</th>
</tr>
</thead>
<tbody>
<tr>
<td>01</td>
<td>一年一班</td>
</tr>
<tr>
<td>02</td>
<td>一年二班</td>
</tr>
<tr>
<td>03</td>
<td>一年三班</td>
</tr>
</tbody>
</table>
<h3 id="4-总结">4. 总结</h3>
<ul>
<li>第一范式： 有主键，具有原子性，字段不可分割</li>
<li>第二范式：完全依赖， 没有部分依赖</li>
<li>第三范式： 没有传递依赖</li>
</ul>
<p>数据库设计尽量遵循三范式，但是还是根据实际情况进行取舍，有时可能会拿冗余换速度，最终用目的要满足客户需求</p>
<h2 id="四-事务的简介">四、事务的简介</h2>
<ul>
<li>当执行 DML 语句是其实就是开启一个事务</li>
<li>关于事务的回滚需要注意：只能回滚 insert、 delete 和 update 语句，不能回滚 select（回滚 select 没有任何意义），对于 create、 drop、 alter 这些无法回滚.事务只对 DML 有效果。</li>
<li>注意： rollback，或者 commit 后事务就结束了。</li>
</ul>
<h2 id="五-事务的特性">五、事务的特性</h2>
<h3 id="1-原子性">1. 原子性</h3>
<ul>
<li>整个事务中的所有操作，必须作为一个单元全部完成（或全部取消）。</li>
</ul>
<p>undo log 名为回滚日志，是实现原子性的关键，当事务回滚时能够撤销所有已经成功执行的 sql 语句，他需要记录你要回滚的相应日志信息。</p>
<p>undo log 记录了这些回滚需要的信息，当事务执行失败或调用了 rollback，导致事务需要回滚，便可以利用 undolog 中的信息将数据回滚到修改之前的样子。</p>
<h3 id="2-一致性">2. 一致性</h3>
<ul>
<li>关注数据的可见性，中间状态的数据对外部不可见，只有最初状态和最终状态的数据对外可见</li>
</ul>
<p>数据库无法保证，需要从应用层角度考虑，用业务来实现。从应用层面，通过代码判断数据库数据是否有效，然后决定回滚还是提交数据</p>
<h3 id="3-隔离性">3. 隔离性</h3>
<p>并发访问数据库时，一个用户的事务不被其他事务所干扰，各并发事务之间数据库是独立的</p>
<p>事务的隔离性是利用的是锁和 MVCC 机制。</p>
<p>至于 MVCC,即多版本并发控制(Multi Version Concurrency Control),一个行记录数据有多个版本对快照数据，这些快照数据在 undo log 中。</p>
<p>如果一个事务读取的行正在做 DELELE 或者 UPDATE 操作，读取操作不会等行上的锁释放，而是读取该行的快照版本。</p>
<h3 id="4-持久性">4. 持久性</h3>
<p>在事务完成以后，该事务对数据库所作的更改将持久地保存在数据库之中，并不会被回滚。</p>
<p>事务的持久性是利用 Innodb 的redo log</p>
<h2 id="六-并发事务出现的问题">六、并发事务出现的问题</h2>
<ul>
<li><strong>脏读（Dirty read）:</strong> 当一个事务正在访问数据并且对数据进行了修改，而这种修改还没有提交到数据库中，这时另外一个事务也访问了这个数据，然后使用了这个数据。因为这个数据是还没有提交的数据，那么另外一个事务读到的这个数据是“脏数据”，依据“脏数据”所做的操作可能是不正确的。</li>
<li><strong>丢失修改（Lost to modify）:</strong>  指在一个事务读取一个数据时，另外一个事务也访问了该数据，那么在第一个事务中修改了这个数据后，第二个事务也修改了这个数据。这样第一个事务内的修改结果就被丢失，因此称为丢失修改。     例如：事务1读取某表中的数据A=20，事务2也读取A=20，事务1修改A=A-1，事务2也修改A=A-1，最终结果A=19，事务1的修改被丢失。</li>
<li><strong>不可重复读（Unrepeatableread）:</strong> 指在一个事务内多次读同一数据。在这个事务还没有结束时，另一个事务也访问该数据。那么，在第一个事务中的两次读数据之间，由于第二个事务的修改导致第一个事务两次读取的数据可能不太一样。这就发生了在一个事务内两次读到的数据是不一样的情况，因此称为不可重复读。</li>
<li><strong>幻读（Phantom read）:</strong> 幻读与不可重复读类似。它发生在一个事务（T1）读取了几行数据，接着另一个并发事务（T2）插入了一些数据时。在随后的查询中，第一个事务（T1）就会发现多了一些原本不存在的记录，就好像发生了幻觉一样，所以称为幻读。</li>
</ul>
<p><strong>不可重复读和幻读区别：</strong></p>
<p>不可重复读的重点是修改比如多次读取一条记录发现其中某些列的值被修改，幻读的重点在于新增或者删除比如多次读取一条记录发现记录增多或减少了。</p>
<h2 id="七-事务隔离级别">七、事务隔离级别</h2>
<h3 id="1-四个隔离级别">1. 四个隔离级别</h3>
<ul>
<li><strong>读未提交</strong>：允许一个事务可以看到其他事务未提交的修改，可能会导致脏读、幻读或不可重复读。</li>
<li><strong>读已提交</strong>：允许一个事务只能看到其他事务已经提交的修改，可以阻止脏读，但是幻读或不可重复读仍有可能发生。</li>
<li><strong>可重复读</strong>：确保如果在一个事务中执行两次相同的 SELECT 语句，都能得到相同的结果，不管其他事务是否提交这些修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。</li>
<li><strong>串行化</strong>：将一个事务与其他事务完全地隔离，相当于加锁，该级别可以防止脏读、不可重复读以及幻读。</li>
</ul>
<table>
<thead>
<tr>
<th>隔离级别</th>
<th>脏读</th>
<th>不可重复读</th>
<th>幻影读</th>
</tr>
</thead>
<tbody>
<tr>
<td>READ-UNCOMMITTED</td>
<td>√</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>READ-COMMITTED</td>
<td>×</td>
<td>√</td>
<td>√</td>
</tr>
<tr>
<td>REPEATABLE-READ</td>
<td>×</td>
<td>×</td>
<td>√</td>
</tr>
<tr>
<td>SERIALIZABLE</td>
<td>×</td>
<td>×</td>
<td>×</td>
</tr>
</tbody>
</table>
<p>MySQL InnoDB 存储引擎的默认支持的隔离级别是 <strong>REPEATABLE-READ（可重读）</strong>。</p>
<blockquote>
<p>InnoDB 存储引擎<strong>REPEATABLE-READ（可重读）</strong>  事务隔离级别下使用的是Next-Key Lock 锁算法，因此可以避免幻读的产生，这与其他数据库系统(如 SQL Server) 是不同的。所以说InnoDB 存储引擎的默认支持的隔离级别是 <strong>REPEATABLE-READ（可重读）</strong> 已经可以完全保证事务的隔离性要求，即达到了 SQL标准的 <strong>SERIALIZABLE(可串行化)</strong> 隔离级别。</p>
</blockquote>
<h2 id="八-数据库锁和并发策略">八、数据库锁和并发策略</h2>
<h3 id="1-常见的锁">1. 常见的锁</h3>
<ul>
<li><strong>MyIsam 实现了表锁</strong>。表锁可以针对数据库表加锁，在锁的灵活性上不如行锁。表锁分为两种锁：读锁与写锁。</li>
<li><strong>InnoDB 存储引擎实现了行锁与表锁（意向锁）</strong>。行锁可以以行为单位对数据集进行锁定。行锁也分为两种锁：<br>
共享锁与排他锁。 InnoDB 对于 Update、 Delete、 insert 语句会自动给涉及的数据集隐式的加上排他锁。对于 select语句 InnoDB 不会加任何锁
<ul>
<li><strong>共享锁</strong>：允许一个事务读取一行，阻止其他事务获得相同数据集的排他锁。但允许其他事务获取共享锁。<br>
显示加锁 select * from table where ... lock in share mode</li>
<li><strong>排他锁</strong>：允许获得排他锁的事务更新数据，阻止其他事务取得相同数据集的共享与排他锁。但是可以对获取了排他锁的数据集进行单纯的查询访问。<br>
显示加锁 sql select * from table where ... for update</li>
</ul>
</li>
<li><strong>innoDB 的行锁的实现方式是基于索引项的</strong>。这意味着即使你尝试获取不同行的排他锁，若使用了相同的索引键，也可能会造成锁冲突。</li>
</ul>
<p><strong>表级锁和行级锁对比：</strong></p>
<ul>
<li>
<p><strong>表级锁：</strong> MySQL中锁定 <strong>粒度最大</strong> 的一种锁，对当前操作的整张表加锁，实现简单，资源消耗也比较少，加锁快，不会出现死锁。其锁定粒度最大，触发锁冲突的概率最高，并发度最低，MyISAM和 InnoDB引擎都支持表级锁。</p>
</li>
<li>
<p><strong>行级锁：</strong> MySQL中锁定 <strong>粒度最小</strong> 的一种锁，只针对当前操作的行进行加锁。 行级锁能大大减少数据库操作的冲突。其加锁粒度最小，并发度高，但加锁的开销也最大，加锁慢，会出现死锁。</p>
</li>
<li>
<p>事务更新大表中的大部分数据直接使用表级锁效率更高；事务比较复杂，使用行级索很可能引起死锁导致回滚。</p>
</li>
</ul>
<h3 id="2-页级锁">2. 页级锁</h3>
<p>页级锁是 MySQL 中锁定粒度介于行级锁和表级锁中间的一种锁。表级锁速度快，但冲突多，行级冲突少，但速度慢。所以取了折衷的页级，一次锁定相邻的一组记录。 BDB 支持页级锁</p>
<h3 id="3-乐观锁">3. 乐观锁</h3>
<p>乐观锁认为一个用户读数据的时候，别人不会去写自己所读的数据</p>
<p><strong>实现</strong>：</p>
<p>时间戳就是在数据库表中单独加一列时间戳，比如“TimeStamp”，每次读出来的时候，把该字段也读出来，当写回去的时候，把该字段加 1，提交之前 ，跟数据库的该字段比较一次，如果比数 据库的值大的话，就允许保存，否则不允许保存，这种处理方法虽然不使用数据库系统提供的锁 机制，但是这种方法可以大大提高数据库处理的并发量</p>
<pre><code class="language-sql"># 每一个记录都有version，会有冗余，可以一个表一个version
Select data,version from biao where id = #{id};
Update biao set data=#{data},version=vsersion+1 where id=#{id} and version = #{version};

# 一个表一个修改
begin;
Select version from version_biao where table_name = #{table_name};
Update biao set data=#{data} where id=#{id};
Update version_biao set version=vsersion+1 from  where version = #{version};
commit;
</code></pre>
<h3 id="4-悲观锁">4. 悲观锁</h3>
<p>悲观锁就是在读取数据的时候，为了不让别人修改自己读取的数据，就会先对自己读取的数据加 锁，只有自<br>
己把数据读完了，才允许别人修改那部分数据，或者反过来说，就是自己修改某条数 据的时候，不允许别人读取<br>
该数据，只有等自己的整个事务提交了，才释放自己加上的锁，才允许其他用户访问那部分数据。</p>
<p><strong>实现</strong>：</p>
<p>sql 语句后边加上 for update</p>
<pre><code class="language-sql">select id,nam from biao for update ;
</code></pre>
<h3 id="5-innodb锁算法">5. InnoDB锁算法</h3>
<ul>
<li>
<p><strong>间隙锁</strong>：锁定一个一个区间记录中的间隙，不包括记录本身</p>
</li>
<li>
<p><strong>行锁</strong>：单个行记录上的锁</p>
</li>
<li>
<p><strong>临键锁</strong>：锁定一个一个区间记录中的间隙以及记录本身</p>
</li>
</ul>
<h2 id="九-给定业务场景说明设计数据库的思路">九、给定业务场景说明设计数据库的思路</h2>
<ol>
<li>分析场景选择存储引擎，比如业务是读多还是写多？需不需要支持事务？</li>
<li>数据库设计的原则，遵循三大范式，但是可以做一些适当的反三大范式</li>
<li>字段的设计，选择类型</li>
</ol>
<h2 id="十-说一下什么是池化设计">十、说一下什么是池化设计</h2>
<ul>
<li>我们常见的如java线程池、jdbc连接池、redis连接池等就是这类设计的代表实现。这种设计会初始预设资源，解决的问题就是抵消每次获取资源的消耗，如创建线程的开销，获取远程连接的开销等。</li>
<li>池化设计会配置一些参数，比如初始线程数，最大线程数等等，还会有一个阻塞队列，当一些请求过多时，会采用一些拒绝的策略</li>
<li>在连接池中，创建连接后，将其放置在池中，并再次使用它，因此不必建立新的连接。如果使用了所有连接，则会建立一个新连接并将其添加到池中。 连接池还减少了用户必须等待建立与数据库的连接的时间。</li>
</ul>
<h2 id="十一-一条sql语句执行慢的原因">十一、一条SQL语句执行慢的原因？</h2>
<h3 id="1-分类讨论">1. 分类讨论</h3>
<ul>
<li>
<p>大多数情况是正常的，只是偶尔会出现很慢的情况。</p>
</li>
<li>
<p>在数据量不变的情况下，这条SQL语句一直以来都执行的很慢。</p>
</li>
</ul>
<h3 id="2-针对偶尔很慢的情况">2. 针对偶尔很慢的情况</h3>
<p>一条 SQL 大多数情况正常，偶尔才能出现很慢的情况，针对这种情况，我觉得这条SQL语句的书写本身是没什么问题的，而是其他原因导致的，那会是什么原因呢？</p>
<h4 id="a-数据库在刷新脏页flush">a. 数据库在刷新脏页（flush）</h4>
<p>当我们要往数据库插入一条数据、或者要更新一条数据的时候，我们知道数据库会在<strong>内存</strong>中把对应字段的数据更新了，但是更新之后，这些更新的字段并不会马上同步持久化到<strong>磁盘</strong>中去，而是把这些更新的记录写入到 redo log 日记中去，等到空闲的时候，在通过 redo log 里的日记把最新的数据同步到<strong>磁盘</strong>中去。</p>
<blockquote>
<p>当内存数据页跟磁盘数据页内容不一致的时候，我们称这个内存页为“脏页”。内存数据写入到磁盘后，内存和磁盘上的数据页的内容就一致了，称为“干净页”。</p>
</blockquote>
<p><strong>刷脏页有两种场景会影响性能</strong></p>
<ul>
<li>**redolog写满了：**redo log 里的容量是有限的，如果数据库一直很忙，更新又很频繁，这个时候 redo log 很快就会被写满了，这个时候就没办法等到空闲的时候再把数据同步到磁盘的，只能暂停其他操作，全身心来把数据同步到磁盘中去的，而这个时候，<strong>就会导致我们平时正常的SQL语句突然执行的很慢</strong>，所以说，数据库在在同步数据到磁盘的时候，就有可能导致我们的SQL语句执行的很慢了。</li>
<li>**内存不够用了：**如果一次查询较多的数据，恰好碰到所查数据页不在内存中时，需要申请内存，而此时恰好内存不足的时候就需要淘汰一部分内存数据页，如果是干净页，就直接释放，如果恰好是脏页就需要刷脏页。</li>
</ul>
<h4 id="b-拿不到锁我能怎么办">b. 拿不到锁我能怎么办</h4>
<p>这个就比较容易想到了，我们要执行的这条语句，刚好这条语句涉及到的表，别人在用，并且加锁了，我们拿不到锁，只能慢慢等待别人释放锁了。或者，表没有加锁，但要使用到的某个一行被加锁了，这个时候，我也没办法啊。</p>
<h3 id="3-针对一直都这么慢的情况">3. 针对一直都这么慢的情况</h3>
<p>先通过EXPLAN去分析SQL语句是否用到索引，主要关注type，possible_key，keys这几个字段</p>
<h4 id="a-没用到索引">a. 没用到索引</h4>
<ul>
<li>如果该字段没有加索引，那么自然没有用到索引</li>
<li>字段有索引，但却没有用索引，那说明出现了索引失效，比如说like 查询以%开头，或者不满足索引的最左原则，或者使用了Or关键字，或者索引字段的值有NULL值，或者使用了函数</li>
</ul>
<h4 id="b-用到了索引但是系统误判了">b. 用到了索引，但是系统误判了</h4>
<ul>
<li>非主键索引存储的是主键索引的值，如果SQL语句走的非主键索引，那么还需要到主键索引去寻找对应的data</li>
<li>当一个SQL语句范围比较大，比如where  x&gt;0  and  x &lt; 20000或者没有where条件，那么可能命中的数据非常多，甚至命中全表，而全表扫描顶多就是O(n)，此时再走索引，还会有两次索引寻找的时间消耗，即使索引查找非常快</li>
<li>此时分析器就要判断是否走索引，采用的方式是抽样检测，来预测SQL语句范围中出现相同值的概率，比如在0-20000范围中，数字3可能出现了10次，也可能只出现1次，显然如果重复数字越少，走索引的性能越好</li>
</ul>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E8%83%BD%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AFmysql%E5%90%97">一、能简单介绍一下什么是Mysql吗？</a></li>
<li><a href="#%E4%BA%8C-sql-%E7%9A%84%E5%88%86%E7%B1%BB">二、SQL 的分类</a></li>
<li><a href="#%E4%B8%89-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%89%E5%A4%A7%E8%8C%83%E5%BC%8F">三、数据库三大范式</a>
<ul>
<li><a href="#1-%E7%AC%AC%E4%B8%80%E8%8C%83%E5%BC%8F">1. 第一范式</a></li>
<li><a href="#2-%E7%AC%AC%E4%BA%8C%E8%8C%83%E5%BC%8F">2. 第二范式</a></li>
<li><a href="#3-%E7%AC%AC%E4%B8%89%E8%8C%83%E5%BC%8F">3. 第三范式</a></li>
<li><a href="#4-%E6%80%BB%E7%BB%93">4. 总结</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%AE%80%E4%BB%8B">四、事务的简介</a></li>
<li><a href="#%E4%BA%94-%E4%BA%8B%E5%8A%A1%E7%9A%84%E7%89%B9%E6%80%A7">五、事务的特性</a>
<ul>
<li><a href="#1-%E5%8E%9F%E5%AD%90%E6%80%A7">1. 原子性</a></li>
<li><a href="#2-%E4%B8%80%E8%87%B4%E6%80%A7">2. 一致性</a></li>
<li><a href="#3-%E9%9A%94%E7%A6%BB%E6%80%A7">3. 隔离性</a></li>
<li><a href="#4-%E6%8C%81%E4%B9%85%E6%80%A7">4. 持久性</a></li>
</ul>
</li>
<li><a href="#%E5%85%AD-%E5%B9%B6%E5%8F%91%E4%BA%8B%E5%8A%A1%E5%87%BA%E7%8E%B0%E7%9A%84%E9%97%AE%E9%A2%98">六、并发事务出现的问题</a></li>
<li><a href="#%E4%B8%83-%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB">七、事务隔离级别</a>
<ul>
<li><a href="#1-%E5%9B%9B%E4%B8%AA%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB">1. 四个隔离级别</a></li>
</ul>
</li>
<li><a href="#%E5%85%AB-%E6%95%B0%E6%8D%AE%E5%BA%93%E9%94%81%E5%92%8C%E5%B9%B6%E5%8F%91%E7%AD%96%E7%95%A5">八、数据库锁和并发策略</a>
<ul>
<li><a href="#1-%E5%B8%B8%E8%A7%81%E7%9A%84%E9%94%81">1. 常见的锁</a></li>
<li><a href="#2-%E9%A1%B5%E7%BA%A7%E9%94%81">2. 页级锁</a></li>
<li><a href="#3-%E4%B9%90%E8%A7%82%E9%94%81">3. 乐观锁</a></li>
<li><a href="#4-%E6%82%B2%E8%A7%82%E9%94%81">4. 悲观锁</a></li>
<li><a href="#5-innodb%E9%94%81%E7%AE%97%E6%B3%95">5. InnoDB锁算法</a></li>
</ul>
</li>
<li><a href="#%E4%B9%9D-%E7%BB%99%E5%AE%9A%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E8%AF%B4%E6%98%8E%E8%AE%BE%E8%AE%A1%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%80%9D%E8%B7%AF">九、给定业务场景说明设计数据库的思路</a></li>
<li><a href="#%E5%8D%81-%E8%AF%B4%E4%B8%80%E4%B8%8B%E4%BB%80%E4%B9%88%E6%98%AF%E6%B1%A0%E5%8C%96%E8%AE%BE%E8%AE%A1">十、说一下什么是池化设计</a></li>
<li><a href="#%E5%8D%81%E4%B8%80-%E4%B8%80%E6%9D%A1sql%E8%AF%AD%E5%8F%A5%E6%89%A7%E8%A1%8C%E6%85%A2%E7%9A%84%E5%8E%9F%E5%9B%A0">十一、一条SQL语句执行慢的原因？</a>
<ul>
<li><a href="#1-%E5%88%86%E7%B1%BB%E8%AE%A8%E8%AE%BA">1. 分类讨论</a></li>
<li><a href="#2-%E9%92%88%E5%AF%B9%E5%81%B6%E5%B0%94%E5%BE%88%E6%85%A2%E7%9A%84%E6%83%85%E5%86%B5">2. 针对偶尔很慢的情况</a>
<ul>
<li><a href="#a-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9C%A8%E5%88%B7%E6%96%B0%E8%84%8F%E9%A1%B5flush">a. 数据库在刷新脏页（flush）</a></li>
<li><a href="#b-%E6%8B%BF%E4%B8%8D%E5%88%B0%E9%94%81%E6%88%91%E8%83%BD%E6%80%8E%E4%B9%88%E5%8A%9E">b. 拿不到锁我能怎么办</a></li>
</ul>
</li>
<li><a href="#3-%E9%92%88%E5%AF%B9%E4%B8%80%E7%9B%B4%E9%83%BD%E8%BF%99%E4%B9%88%E6%85%A2%E7%9A%84%E6%83%85%E5%86%B5">3. 针对一直都这么慢的情况</a>
<ul>
<li><a href="#a-%E6%B2%A1%E7%94%A8%E5%88%B0%E7%B4%A2%E5%BC%95">a. 没用到索引</a></li>
<li><a href="#b-%E7%94%A8%E5%88%B0%E4%BA%86%E7%B4%A2%E5%BC%95%E4%BD%86%E6%98%AF%E7%B3%BB%E7%BB%9F%E8%AF%AF%E5%88%A4%E4%BA%86">b. 用到了索引，但是系统误判了</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">

	  
		<div id="gitalk-container"></div>
		<!--评论显示区，请插入合适的位置-->
<div id="comment"></div>
<!--Leancloud 操作库:-->
<script src="//cdn1.lncld.net/static/js/3.6.1/av-min.js"></script>
<!--Valine 的核心代码库-->
<script src="//cdn.jsdelivr.net/npm/valine@1.4.4/dist/Valine.min.js"></script>
<script>
    new Valine({
        el:'#comment',
        appId: 'DysN4QrSvmmE6SpDXopbCLD6-gzGzoHsz',
        appKey: 'mjK643yLFa4WWXtobofr24Ap',
        placeholder: 'ヾﾉ≧∀≦)o快来评论一下吧!',
        avatar:''
    });
</script>
	  
		  
	  

</div></section>
</div></div></div>
<!--
<script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var list=document.querySelectorAll(".katex");for(var i=0;i<list.length;i++){list[i].style.display="unset"};
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
content="本文最后更新于2020-07-26，已超过 1 年没有更新，涉及的内容可能已经失效！";var date1="2020-07-26 18:37:57";date1=date1.replace("-","/");var date2=new Date();var date3=date2.getTime()-new Date(date1).getTime();var days=Math.floor(date3/(24*3600*1000));if(days>=365){document.getElementById("warn").innerHTML=content};
</script>
-->

<script>
    "use strict";
    ! function () {
        for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
            n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
            for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
                n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
            }
        }
    }();
    let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
    window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;
        mainNavLinks.forEach((link, index) => {
            let section = document.getElementById(decodeURI(link.hash).substring(1));
            let nextSection = null
            if (mainNavLinks[index + 1]) {
                nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
                    1));
            }
            if (section.offsetTop <= fromTop) {
                if (nextSection) {
                    if (nextSection.offsetTop > fromTop) {
                        link.classList.add("currentToc");
                    } else {
                        link.classList.remove("currentToc");
                    }
                } else {
                    link.classList.add("currentToc");
                }
            } else {
                link.classList.remove("currentToc");
            }
        });
    });
    var list = document.querySelectorAll(".katex");
    for (var i = 0; i < list.length; i++) {
        list[i].style.display = "unset"
    };
    var h = document.documentElement,
        b = document.body,
        st = "scrollTop",
        sh = "scrollHeight",
        progress = document.querySelector(".progress"),
        scroll;
    document.addEventListener("scroll", function () {
        scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
        progress.style.setProperty("--scroll", scroll + "%")
    });
    var wxScale = new WxScale({
        fullPage: document.querySelector("#fullPage"),
        canvas: document.querySelector("#canvas")
    });
    var imgBox = document.querySelectorAll("#md_block img");
    for (var i = 0; i < imgBox.length; i++) {
        imgBox[i].onclick = function (e) {
            wxScale.start(this)
        }
    };
    content = "本文最后更新于2020-07-26，已超过 1 年没有更新，涉及的内容可能已经失效！";
    var date1 = "2020-07-26 18:37:57";
    date1 = date1.replace("-", "/");
    var date2 = new Date();
    var date3 = date2.getTime() - new Date(date1).getTime();
    var days = Math.floor(date3 / (24 * 3600 * 1000));
    if (days >= 365) {
        document.getElementById("warn").innerHTML = content
    };
</script>

<style>#magnifyImg{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#magnifyImg img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Copyright © 2018-2020 <a href="https://xzzz2020.github.io" style="margin:0;">xzzz2020</a>.</div>
<span style="display: inline;margin-right:15px;">👁<strong><span id="busuanzi_value_site_pv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>📚<strong>58</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://xzzz2020.github.io/media/js/prism.js"></script>
</body>
</html>