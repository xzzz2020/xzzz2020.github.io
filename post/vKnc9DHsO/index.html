<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://xzzz2020.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="æ¸©æ•…è€ŒçŸ¥æ–°"><meta charset="UTF-8"><title>ã€æ€»ç»“ã€‘Javaå†…å­˜æ¨¡å‹ | xzzz2020</title>
<link href="https://xzzz2020.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://xzzz2020.github.io/media/css/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://xzzz2020.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<link rel="canonical" href="https://xzzz2020.github.io/post/vKnc9DHsO/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://xzzz2020.github.io"><img alt="logo" style="display:inline-block;" src="https://xzzz2020.github.io/images/avatar.png"/></a><h1 title="xzzz2020" class="weaklink"><a  href="/">xzzz2020</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1599740351189" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>ã€æ€»ç»“ã€‘Javaå†…å­˜æ¨¡å‹</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2020-07-12</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px">	<a href="https://xzzz2020.github.io/tag/Java_concurrency/" class="tag">Javaå¹¶å‘</a> | 	<a href="https://xzzz2020.github.io/tag/Interview_summary/" class="tag">é¢è¯•æ€»ç»“</a></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">2947å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">11 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<img class="featureImg" alt="featureimg" src="https://img-1302474103.cos.ap-nanjing.myqcloud.com/img/photo-1594204514141-80c88f000da7.webp" referrerpolicy="no-referrer">

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<blockquote>
<p>è¯¥æ–‡ç« ä¸ºé¢è¯•ç²¾åç‰ˆï¼Œå¦‚æœæ˜¯åˆå­¦è€…ï¼Œå»ºè®®å­¦ä¹ ä¸“æ ï¼š<a href="https://blog.csdn.net/qq_43040688/category_9910156.html">Javaå¹¶å‘ä¸“æ </a></p>
</blockquote>
<blockquote>
<p>Javaå¹¶å‘éœ€è¦ç»“åˆJVMä»¥åŠæ“ä½œç³»ç»Ÿçš„ç›¸å…³çŸ¥è¯†ï¼Œå»ºè®®å…ˆå­¦ä¹ è¿™ä¸¤ä¸ªéƒ¨åˆ†ï¼š<a href="https://blog.csdn.net/qq_43040688/category_9819683.html">JVMä¸“æ </a> å’Œ <a href="https://xzzz2020.gitee.io/tag/operating_system/">æ“ä½œç³»ç»Ÿä¸“æ </a></p>
</blockquote>
<p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8Bjmm">ä¸€ã€Javaå†…å­˜æ¨¡å‹JMM</a></li>
<li><a href="#%E4%BA%8C-%E5%86%85%E5%AD%98%E9%97%B4%E4%BA%A4%E4%BA%92%E6%93%8D%E4%BD%9C">äºŒã€å†…å­˜é—´äº¤äº’æ“ä½œ</a></li>
<li><a href="#%E4%B8%89-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7">ä¸‰ã€å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§</a>
<ul>
<li><a href="#%E5%8E%9F%E5%AD%90%E6%80%A7">åŸå­æ€§</a></li>
<li><a href="#%E5%8F%AF%E8%A7%81%E6%80%A7">å¯è§æ€§</a></li>
<li><a href="#%E6%9C%89%E5%BA%8F%E6%80%A7">æœ‰åºæ€§</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E9%87%8D%E6%8E%92%E5%BA%8F">å››ã€é‡æ’åº</a></li>
<li><a href="#%E4%BA%94-happens-before%E5%8E%9F%E5%88%99">äº”ã€happens-beforeåŸåˆ™</a></li>
<li><a href="#%E5%85%AD-volatitle">å…­ã€volatitle</a>
<ul>
<li><a href="#1-volatitle%E5%8F%98%E9%87%8F%E4%B8%BA%E4%BD%95%E7%AB%8B%E5%8D%B3%E5%8F%AF%E8%A7%81">1. volatitleå˜é‡ä¸ºä½•ç«‹å³å¯è§ï¼Ÿ</a></li>
<li><a href="#2-%E5%A6%82%E4%BD%95%E7%A6%81%E6%AD%A2%E9%87%8D%E6%8E%92%E5%BA%8F%E4%BC%98%E5%8C%96">2. å¦‚ä½•ç¦æ­¢é‡æ’åºä¼˜åŒ–ï¼Ÿ</a></li>
<li><a href="#3-%E5%92%8Csynchronized%E7%9A%84%E5%8C%BA%E5%88%AB">3. å’Œsynchronizedçš„åŒºåˆ«ï¼Ÿ</a></li>
</ul>
</li>
<li><a href="#%E4%B8%83-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">ä¸ƒã€å•ä¾‹æ¨¡å¼</a>
<ul>
<li><a href="#1-%E9%A5%BF%E6%B1%89%E5%BC%8F">1. é¥¿æ±‰å¼</a></li>
<li><a href="#2-%E6%99%AE%E9%80%9A%E7%9A%84%E6%87%92%E6%B1%89%E5%BC%8F">2. <strong>æ™®é€šçš„æ‡’æ±‰å¼</strong></a></li>
<li><a href="#3-%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95%E7%9A%84%E6%87%92%E6%B1%89%E5%BC%8F">3. åŒæ­¥æ–¹æ³•çš„æ‡’æ±‰å¼</a></li>
<li><a href="#4-%E4%BA%8C%E6%AC%A1%E6%A3%80%E6%9F%A5">4. äºŒæ¬¡æ£€æŸ¥</a></li>
<li><a href="#5-holder%E6%96%B9%E5%BC%8F">5. Holderæ–¹å¼</a></li>
<li><a href="#6-%E6%9E%9A%E4%B8%BE">6. æšä¸¾</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h2 id="ä¸€-javaå†…å­˜æ¨¡å‹jmm">ä¸€ã€Javaå†…å­˜æ¨¡å‹JMM</h2>
<p>å¤„ç†å™¨ä¸Šçš„å¯„å­˜å™¨çš„è¯»å†™çš„é€Ÿåº¦æ¯”å†…å­˜å¿«å‡ ä¸ªæ•°é‡çº§ï¼Œä¸ºäº†è§£å†³è¿™ç§é€Ÿåº¦çŸ›ç›¾ï¼Œåœ¨å®ƒä»¬ä¹‹é—´åŠ å…¥äº†é«˜é€Ÿç¼“å­˜ã€‚</p>
<p>åŠ å…¥é«˜é€Ÿç¼“å­˜å¸¦æ¥äº†ä¸€ä¸ªæ–°çš„é—®é¢˜ï¼šç¼“å­˜ä¸€è‡´æ€§ã€‚å¦‚æœå¤šä¸ªç¼“å­˜å…±äº«åŒä¸€å—ä¸»å†…å­˜åŒºåŸŸï¼Œé‚£ä¹ˆå¤šä¸ªç¼“å­˜çš„æ•°æ®å¯èƒ½ä¼šä¸ä¸€è‡´ï¼Œéœ€è¦ä¸€äº›åè®®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<img src="https://img-1302474103.cos.ap-nanjing.myqcloud.com/img/image-20200711163213039.png" alt="image-20200711163213039" style="zoom:50%;" />
<p>æ‰€æœ‰çš„å˜é‡éƒ½å­˜å‚¨åœ¨ä¸»å†…å­˜ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹è¿˜æœ‰è‡ªå·±çš„å·¥ä½œå†…å­˜ï¼Œå·¥ä½œå†…å­˜å­˜å‚¨åœ¨é«˜é€Ÿç¼“å­˜æˆ–è€…å¯„å­˜å™¨ä¸­ï¼Œä¿å­˜äº†è¯¥çº¿ç¨‹ä½¿ç”¨çš„å˜é‡çš„ä¸»å†…å­˜å‰¯æœ¬æ‹·è´ã€‚</p>
<p>çº¿ç¨‹åªèƒ½ç›´æ¥æ“ä½œå·¥ä½œå†…å­˜ä¸­çš„å˜é‡ï¼Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„å˜é‡å€¼ä¼ é€’éœ€è¦é€šè¿‡ä¸»å†…å­˜æ¥å®Œæˆã€‚</p>
<img src="https://img-1302474103.cos.ap-nanjing.myqcloud.com/img/image-20200711163313895.png" alt="image-20200711163313895" style="zoom:50%;" />
<h2 id="äºŒ-å†…å­˜é—´äº¤äº’æ“ä½œ">äºŒã€å†…å­˜é—´äº¤äº’æ“ä½œ</h2>
<figure data-type="image" tabindex="1"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWctMTMwMjQ3NDEwMy5jb3MuYXAtbmFuamluZy5teXFjbG91ZC5jb20vaW1nL2ltYWdlLTIwMjAwNzExMTYzNDA4ODI2LnBuZw?x-oss-process=image/format,png" alt="image-20200711163408826" loading="lazy"></figure>
<pre><code class="language-go">1. lockï¼ˆé”å®šï¼‰ï¼šä½œç”¨äº`ä¸»å†…å­˜`çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå˜é‡æ ‡è¯†ä¸ºä¸€æ¡çº¿ç¨‹ç‹¬å çš„çŠ¶æ€ã€‚
2. unlockï¼ˆè§£é”ï¼‰ï¼šä½œç”¨äº`ä¸»å†…å­˜`çš„å˜é‡ï¼Œå®ƒæŠŠä¸€ä¸ªå¤„äºé”å®šçŠ¶æ€çš„å˜é‡é‡Šæ”¾å‡ºæ¥ï¼Œé‡Šæ”¾åçš„å˜é‡æ‰å¯ä»¥è¢«å…¶ä»–çº¿ç¨‹é”å®šã€‚

// è¯»å…¥å·¥ä½œå†…å­˜
3. readï¼ˆè¯»å–ï¼‰ï¼šä¸»å†…å­˜ ---&gt; å·¥ä½œå†…å­˜ã€‚
4. loadï¼ˆè½½å…¥ï¼‰ï¼šæŠŠreadæ“ä½œä»ä¸»å†…å­˜ä¸­å¾—åˆ°çš„`å˜é‡å€¼` ---&gt; `å·¥ä½œå†…å­˜çš„å˜é‡å‰¯æœ¬`ã€‚

// ä¸­é—´æ­¥éª¤
5. useï¼ˆä½¿ç”¨ï¼‰ï¼šå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ª`å˜é‡çš„å€¼`---&gt;`æ‰§è¡Œå¼•æ“`ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªéœ€è¦`ä½¿ç”¨åˆ°å˜é‡çš„å€¼`çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶å°†ä¼šæ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚
6. assignï¼ˆèµ‹å€¼ï¼‰ï¼šæŠŠä¸€ä¸ª`ä»æ‰§è¡Œå¼•æ“`æ¥æ”¶åˆ°çš„å€¼---èµ‹ç»™---&gt;`å·¥ä½œå†…å­˜çš„å˜é‡`ï¼Œæ¯å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€ä¸ªç»™å˜é‡`èµ‹å€¼`çš„å­—èŠ‚ç æŒ‡ä»¤æ—¶æ‰§è¡Œè¿™ä¸ªæ“ä½œã€‚

// å†™å…¥ä¸»å†…å­˜
7. storeï¼ˆå­˜å‚¨ï¼‰ï¼šæŠŠå·¥ä½œå†…å­˜ä¸­ä¸€ä¸ª`å˜é‡çš„å€¼`---&gt;`ä¸»å†…å­˜`ã€‚
8. writeï¼ˆå†™å…¥ï¼‰ï¼šæŠŠstoreæ“ä½œä»å·¥ä½œå†…å­˜ä¸­å¾—åˆ°çš„å˜é‡çš„å€¼---&gt;ä¸»å†…å­˜çš„å˜é‡ã€‚
</code></pre>
<h2 id="ä¸‰-å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§">ä¸‰ã€å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§</h2>
<h3 id="åŸå­æ€§">åŸå­æ€§</h3>
<p>Java å†…å­˜æ¨¡å‹ä¿è¯äº† readã€loadã€useã€assignã€storeã€writeã€lock å’Œ unlock æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œä¾‹å¦‚å¯¹ä¸€ä¸ª intç±»å‹çš„å˜é‡æ‰§è¡Œ assign èµ‹å€¼æ“ä½œï¼Œè¿™ä¸ªæ“ä½œå°±æ˜¯åŸå­æ€§çš„ã€‚ä½†æ˜¯ Java å†…å­˜æ¨¡å‹å…è®¸è™šæ‹Ÿæœºå°†æ²¡æœ‰è¢« volatile ä¿®é¥°çš„64 ä½æ•°æ®ï¼ˆlongï¼Œdoubleï¼‰çš„è¯»å†™æ“ä½œåˆ’åˆ†ä¸ºä¸¤æ¬¡ 32 ä½çš„æ“ä½œæ¥è¿›è¡Œï¼Œå³ loadã€storeã€read å’Œ write æ“ä½œå¯ä»¥ä¸å…·å¤‡åŸå­æ€§ã€‚</p>
<p><strong>int ç­‰åŸå­æ€§çš„ç±»å‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</strong></p>
<p>æœ‰ä¸€ä¸ªé”™è¯¯è®¤è¯†å°±æ˜¯ï¼Œint ç­‰åŸå­æ€§çš„ç±»å‹åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚å‰é¢çš„çº¿ç¨‹ä¸å®‰å…¨ç¤ºä¾‹ä»£ç ä¸­ï¼Œcnt å±äº int ç±»å‹å˜é‡ï¼Œ1000 ä¸ªçº¿ç¨‹å¯¹å®ƒè¿›è¡Œè‡ªå¢æ“ä½œä¹‹åï¼Œå¾—åˆ°çš„å€¼ä¸º 997 è€Œä¸æ˜¯ 1000ã€‚<br>
ä¸ºäº†æ–¹ä¾¿è®¨è®ºï¼Œå°†å†…å­˜é—´çš„äº¤äº’æ“ä½œç®€åŒ–ä¸º 3 ä¸ªï¼šloadã€assignã€storeã€‚</p>
<p>ä¸‹å›¾æ¼”ç¤ºäº†ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶å¯¹ cnt è¿›è¡Œæ“ä½œï¼Œloadã€assignã€store è¿™ä¸€ç³»åˆ—æ“ä½œæ•´ä½“ä¸Šçœ‹ä¸å…·å¤‡åŸå­æ€§ï¼Œé‚£ä¹ˆåœ¨ T1ä¿®æ”¹ cnt å¹¶ä¸”è¿˜æ²¡æœ‰å°†ä¿®æ”¹åçš„å€¼å†™å…¥ä¸»å†…å­˜ï¼ŒT2 ä¾ç„¶å¯ä»¥è¯»å…¥æ—§å€¼ã€‚å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸¤ä¸ªçº¿ç¨‹è™½ç„¶æ‰§è¡Œäº†ä¸¤æ¬¡è‡ªå¢è¿ç®—ï¼Œä½†æ˜¯ä¸»å†…å­˜ä¸­ cnt çš„å€¼æœ€åä¸º 1 è€Œä¸æ˜¯ 2ã€‚å› æ­¤<strong>å¯¹ int ç±»å‹è¯»å†™æ“ä½œæ»¡è¶³åŸå­æ€§åªæ˜¯è¯´æ˜ loadã€assignã€store è¿™äº›å•ä¸ªæ“ä½œå…·å¤‡åŸå­æ€§ã€‚</strong></p>
<figure data-type="image" tabindex="2"><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly9pbWctMTMwMjQ3NDEwMy5jb3MuYXAtbmFuamluZy5teXFjbG91ZC5jb20vaW1nL2ltYWdlLTIwMjAwNzExMTYzOTU5NDg2LnBuZw?x-oss-process=image/format,png" alt="image-20200711163959486" loading="lazy"></figure>
<p><strong>å¦‚ä½•ä¿è¯åŸå­æ€§å‘¢ï¼Ÿ</strong></p>
<ul>
<li>AtomicåŸå­ç±»å¯ä»¥åˆ©ç”¨CASçš„æ–¹å¼ï¼Œåœ¨ä¸åŠ é”çš„æƒ…å†µä¸‹ä¿è¯åŸå­æ€§</li>
<li>synchronized äº’æ–¥é”æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼Œå®ƒå¯¹åº”çš„å†…å­˜é—´äº¤äº’æ“ä½œä¸ºï¼šlock å’Œunlock</li>
</ul>
<h3 id="å¯è§æ€§">å¯è§æ€§</h3>
<p>å¯è§æ€§æŒ‡å½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å…±äº«å˜é‡çš„å€¼ï¼Œå…¶å®ƒçº¿ç¨‹èƒ½å¤Ÿç«‹å³å¾—çŸ¥è¿™ä¸ªä¿®æ”¹ã€‚Java å†…å­˜æ¨¡å‹æ˜¯é€šè¿‡åœ¨å˜é‡ä¿®æ”¹åå°†æ–°å€¼åŒæ­¥å›ä¸»å†…å­˜ï¼Œåœ¨å˜é‡è¯»å–å‰ä»ä¸»å†…å­˜åˆ·æ–°å˜é‡å€¼æ¥å®ç°å¯è§æ€§çš„ã€‚</p>
<p><strong>ä¸»è¦æœ‰ä¸‰ç§å®ç°å¯è§æ€§çš„æ–¹å¼</strong>ï¼š</p>
<ul>
<li>volatileå…³é”®å­—ï¼Œæ˜¯å·¥ä½œå†…å­˜å¤±æ•ˆ</li>
<li>synchronizedï¼Œå¯¹ä¸€ä¸ªå˜é‡æ‰§è¡Œ unlock æ“ä½œä¹‹å‰ï¼Œå¿…é¡»æŠŠå˜é‡å€¼åŒæ­¥å›ä¸»å†…å­˜ ã€‚</li>
<li><strong>final</strong>ï¼Œè¢« final å…³é”®å­—ä¿®é¥°çš„å­—æ®µåœ¨æ„é€ å™¨ä¸­ä¸€æ—¦åˆå§‹åŒ–å®Œæˆï¼Œå¹¶ä¸”æ²¡æœ‰å‘ç”Ÿ this é€ƒé€¸ï¼ˆå…¶å®ƒçº¿ç¨‹é€šè¿‡ this å¼•ç”¨è®¿é—®åˆ°åˆå§‹åŒ–äº†ä¸€åŠçš„å¯¹è±¡ï¼‰ï¼Œé‚£ä¹ˆå…¶å®ƒçº¿ç¨‹å°±èƒ½çœ‹è§ final å­—æ®µçš„å€¼ã€‚</li>
</ul>
<pre><code class="language-java">public class FinalTest{
    final int i;
    static FinalTest obj;

    public FinalTest(){
        i  =1;
        /**
         *è¿™é‡Œä¼šä½¿æ­£åœ¨è¢«æ„é€ çš„å¯¹è±¡é€¸å‡ºï¼Œå¦‚æœå’Œä¸Šä¸€å¥åšäº†é‡æ’åºï¼Œé‚£ä¹ˆå…¶ä»–çº¿ç¨‹å°±å¯ä»¥é€šè¿‡objè®¿é—®åˆ°è¿˜ä¸ºè¢«åˆå§‹åŒ–çš„finalåŸŸã€‚
         **/
        obj = this;
    }
}
</code></pre>
<p>ç±»çš„ final åŸŸåœ¨ç¼–è¯‘å™¨å±‚é¢ä¼šä¿è¯åœ¨ç±»çš„æ„é€ å™¨è¿è¡Œç»“æŸä¹‹å‰ä¸€å®šè¦åˆå§‹åŒ–å®Œæˆï¼ŒåŒæ—¶ Java å†…å­˜æ¨¡å‹ä¼šä¿è¯å¯¹è±¡å®ä¾‹åŒ–åå®ƒçš„ final åŸŸå¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ï¼Œç„¶è€Œé final åŸŸå¹¶æ²¡æœ‰è¿™ç§å¾…é‡ã€‚ä¾‹å¦‚å¦‚ä¸‹ä»£ç ï¼š</p>
<pre><code class="language-java">public class FinalFiled {
    final int x;
    int y;
    static FinalFiled f;

    public FinalFiled() {
        x = 100;
        y = 100;
    }

    static void writer() {
        f = new FinalFiled();
    }

    static void reader() {
        if (f != null) {
            int i = f.x;  // ä¿è¯æ­¤æ—¶ä¸€å®šæ˜¯ 100
            int j = f.y;  // æœ‰å¯èƒ½æ­¤æ—¶è¿˜æ˜¯ 0
        }
    }
}
</code></pre>
<h3 id="æœ‰åºæ€§">æœ‰åºæ€§</h3>
<p>æœ‰åºæ€§æ˜¯æŒ‡ï¼šåœ¨æœ¬çº¿ç¨‹å†…è§‚å¯Ÿï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æœ‰åºçš„ã€‚åœ¨ä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå¦ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰€æœ‰æ“ä½œéƒ½æ˜¯æ— åºçš„ï¼Œæ— åºæ˜¯å› ä¸ºå‘ç”Ÿäº†æŒ‡ä»¤é‡æ’åºã€‚åœ¨ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œå…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œé‡æ’åºè¿‡ç¨‹ä¸ä¼šå½±å“åˆ°å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œï¼Œå´ä¼šå½±å“åˆ°å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„æ­£ç¡®æ€§ã€‚</p>
<p><strong>å¦‚ä½•ä¿è¯æœ‰åºæ€§ï¼Ÿ</strong></p>
<ul>
<li>volatile å…³é”®å­—é€šè¿‡æ·»åŠ å†…å­˜å±éšœçš„æ–¹å¼æ¥ç¦æ­¢æŒ‡ä»¤é‡æ’ï¼Œå³é‡æ’åºæ—¶ä¸èƒ½æŠŠåé¢çš„æŒ‡ä»¤æ”¾åˆ°å†…å­˜å±éšœä¹‹å‰ã€‚</li>
<li>é€šè¿‡ synchronized æ¥ä¿è¯æœ‰åºæ€§ï¼Œå®ƒä¿è¯æ¯ä¸ªæ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç ï¼Œç›¸å½“äºæ˜¯è®©çº¿ç¨‹é¡ºåºæ‰§è¡ŒåŒæ­¥ä»£ç ã€‚</li>
</ul>
<h2 id="å››-é‡æ’åº">å››ã€é‡æ’åº</h2>
<p>æ‰§è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œä¸ºäº†æé«˜ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„æ‰§è¡Œæ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨(åŒ…æ‹¬å†…å­˜ç³»ç»Ÿï¼Œå†…å­˜åœ¨è¡Œä¸ºæ²¡æœ‰é‡æ’ä½†æ˜¯å­˜å‚¨çš„æ—¶å€™æ˜¯æœ‰å˜åŒ–çš„)ä¼šå¯¹æŒ‡ä»¤é‡æ’åºã€‚ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºæ˜¯åœ¨ç¼–è¯‘æ—¶æœŸå®Œæˆçš„ï¼ŒæŒ‡ä»¤é‡æ’åºå’Œå†…å­˜é‡æ’åºæ˜¯å¤„ç†å™¨é‡æ’åº</p>
<ol>
<li>ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºï¼Œåœ¨ä¸æ”¹å˜å•çº¿ç¨‹è¯­ä¹‰çš„æƒ…å†µä¸‹é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåº</li>
<li>æŒ‡æŒ‡ä»¤çº§å¹¶è¡Œé‡æ’åºï¼Œå¤„ç†å™¨çš„æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œï¼Œå¦‚æœä¸å­˜åœ¨æ•°æ®çš„ä¾èµ–æ€§å°†ä¼šæ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåº</li>
<li>å†…å­˜ç³»ç»Ÿçš„é‡æ’åºï¼Œå› ä¸ºä½¿ç”¨äº†è¯»å†™ç¼“å­˜åŒºï¼Œä½¿å¾—çœ‹èµ·æ¥å¹¶ä¸æ˜¯é¡ºåºæ‰§è¡Œçš„</li>
</ol>
<h2 id="äº”-happens-beforeåŸåˆ™">äº”ã€happens-beforeåŸåˆ™</h2>
<ol>
<li>ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens-beforeäºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚</li>
<li>ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªé”çš„è§£é”ï¼Œhappens-beforeäºéšåå¯¹è¿™ä¸ªé”çš„åŠ é”ã€‚</li>
<li>volatileè§„åˆ™ï¼šå¯¹ä¸€ä¸ªvolatileåŸŸçš„å†™ï¼Œhappens-beforeäºä»»æ„åç»­å¯¹è¿™ä¸ªvolatileåŸŸçš„è¯»ã€‚</li>
<li>ä¼ é€’æ€§ï¼šå¦‚æœAhappens-before Bï¼Œå¹¶ä¸”B happens-before Cï¼Œé‚£ä¹ˆA happens-before Cã€‚</li>
<li>start()è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.start()ï¼Œé‚£ä¹ˆAçº¿ç¨‹çš„ThreadB.start()æ“ä½œhappens-beforeäºçº¿ç¨‹Bä¸­çš„ä»»æ„æ“ä½œã€‚</li>
<li>join()è§„åˆ™ï¼šå¦‚æœçº¿ç¨‹Aæ‰§è¡Œæ“ä½œThreadB.join()å¹¶æˆåŠŸè¿”å›ï¼Œé‚£ä¹ˆçº¿ç¨‹Bçš„ä»»æ„æ“ä½œhappens-beforeäºçº¿ç¨‹Aä»ThreadB.join()æ“ä½œæˆåŠŸè¿”å›ã€‚</li>
</ol>
<p><strong>å«ä¹‰</strong>ï¼šä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨happens-beforeå…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€Javaå¹³å°çš„å…·ä½“å®ç°å¿…é¡»æŒ‰ç…§happens-beforeå…³ç³»æŒ‡å®šçš„é¡ºåºæ¥æ‰§è¡Œã€‚å¦‚æœé‡æ’åºä¹‹åçš„æ‰§è¡Œç»“æœï¼Œä¸æŒ‰ç…§happens-beforeå…³ç³»æ¥æ‰§è¡Œçš„ç»“æœä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ã€‚æ‰€ä»¥åªè¦èƒ½å¤Ÿæ»¡è¶³<strong>Açš„æ“ä½œç»“æœä¸€å®šè¦å¯¹Bå¯è§</strong></p>
<h2 id="å…­-volatitle">å…­ã€volatitle</h2>
<h3 id="1-volatitleå˜é‡ä¸ºä½•ç«‹å³å¯è§">1. volatitleå˜é‡ä¸ºä½•ç«‹å³å¯è§ï¼Ÿ</h3>
<p>åœ¨å¯¹æœ‰volatileä¿®é¥°ç¬¦ä¿®é¥°çš„å…±äº«å˜é‡è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œæ±‡ç¼–ä»£ç ä¼šå¤šä¸€æ¡lockå‰ç¼€çš„æŒ‡ä»¤ã€‚è¯¥æŒ‡ä»¤æœ‰å¦‚ä¸‹ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ol>
<li>å°†å½“å‰ç¼“å­˜è¡Œçš„æ•°æ®å›å†™åˆ°å†…å­˜ä¸­</li>
<li>ä½¿å…¶ä»–cpué‡Œç¼“å­˜äº†è¯¥å†…å­˜åœ°å€çš„æ•°æ®æ— æ•ˆ(ç¼“å­˜ä¸€è‡´æ€§æœºåˆ¶)</li>
</ol>
<h3 id="2-å¦‚ä½•ç¦æ­¢é‡æ’åºä¼˜åŒ–">2. å¦‚ä½•ç¦æ­¢é‡æ’åºä¼˜åŒ–ï¼Ÿ</h3>
<p>é€šè¿‡æ’å…¥å†…å­˜å±éšœç¦æ­¢åœ¨å†…å­˜å±éšœå‰åçš„æŒ‡ä»¤æ‰§è¡Œé‡æ’åºä¼˜åŒ–</p>
<h3 id="3-å’Œsynchronizedçš„åŒºåˆ«">3. å’Œsynchronizedçš„åŒºåˆ«ï¼Ÿ</h3>
<ul>
<li>volatileæœ¬è´¨æ˜¯åœ¨å‘Šè¯‰JVMå½“å‰å˜é‡åœ¨å¯„å­˜å™¨(å·¥ä½œå†…å­˜)ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„,éœ€è¦ä»ä¸»å­˜ä¸­è¯»å–; synchronizedåˆ™æ˜¯é”å®šå½“å‰å˜é‡ï¼Œ åªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡,å…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä½ç›´åˆ°è¯¥çº¿ç¨‹å®Œæˆå˜é‡æ“ä½œä¸ºæ­¢</li>
<li>volatileä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«; synchronizedåˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡ã€æ–¹æ³•å’Œç±»çº§åˆ«</li>
<li>volatileä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§,ä¸èƒ½ä¿è¯åŸå­æ€§;è€Œsynchronizedåˆ™å¯ä»¥ä¿è¯å˜é‡ä¿®æ”¹çš„å¯è§æ€§å’ŒåŸå­æ€§</li>
<li>volatileä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡; synchronizedå¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡</li>
<li>volatileæ ‡è®°çš„å˜é‡ä¸ä¼šè¢«ç¼–è¯‘å™¨ä¼˜åŒ–; synchronizedæ ‡è®°çš„å˜é‡å¯ä»¥è¢«ç¼–è¯‘å™¨ä¼˜åŒ–</li>
</ul>
<h2 id="ä¸ƒ-å•ä¾‹æ¨¡å¼">ä¸ƒã€å•ä¾‹æ¨¡å¼</h2>
<h3 id="1-é¥¿æ±‰å¼">1. é¥¿æ±‰å¼</h3>
<pre><code>public class Singleton {

    private final static Singleton INSTANCE = new Singleton();
    
    private Singleton(){}

    public static Singleton getInstance(){
        return INSTANCE;
    }

}
</code></pre>
<h3 id="2-æ™®é€šçš„æ‡’æ±‰å¼">2. <strong>æ™®é€šçš„æ‡’æ±‰å¼</strong></h3>
<pre><code class="language-java">public class Singleton {  
    private static Singleton instance;  
    private Singleton (){}  
  
    public static Singleton getInstance() {  
    if (instance == null) {  
        instance = new Singleton();  
    }  
    return instance;  
    }  
}
</code></pre>
<ul>
<li>çº¿ç¨‹ä¸å®‰å…¨ï¼Œä¸æ”¯æŒå¤šçº¿ç¨‹</li>
</ul>
<h3 id="3-åŒæ­¥æ–¹æ³•çš„æ‡’æ±‰å¼">3. åŒæ­¥æ–¹æ³•çš„æ‡’æ±‰å¼</h3>
<pre><code class="language-java">class Singleton{
    private static Singleton singleton;
    
    private Singleton(){}
    
    public static synchronized Singleton getSingleton(){
        if (singleton==null){
            singleton = new Singleton();
        }
        return singleton;
    }
}
</code></pre>
<ul>
<li>çº¿ç¨‹å®‰å…¨ï¼Œä½†æ˜¯æ€§èƒ½å·®</li>
</ul>
<h3 id="4-äºŒæ¬¡æ£€æŸ¥">4. äºŒæ¬¡æ£€æŸ¥</h3>
<pre><code class="language-java">class Singleton{
    private static volatile Singleton singleton;

    private Singleton(){}

    public static  Singleton getSingleton(){
        if (singleton==null){
            synchronized (Singleton.class){
                if (singleton==null){
                    singleton = new Singleton();
                }
            }
        }
        return singleton;
    }
}
</code></pre>
<ul>
<li>éœ€è¦åŠ ä¸€ä¸ªvolatileå…³é”®å­—ï¼Œé¿å…æŒ‡ä»¤é‡æ’åºå¦‚æœä¸åŠ volatileå…³é”®å­—ï¼Œå¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼Œå› ä¸ºåœ¨æ„é€ singletonçš„æ—¶å€™ï¼Œå¯èƒ½ä¹Ÿä¼šæ„é€ å…¶ä»–çš„å¯¹è±¡ï¼Œå¦‚æœå‡ºç°äº†æŒ‡ä»¤é‡æ’åºï¼Œä¼šå¯¼è‡´singletonæ„é€ å®Œæˆæ—¶ï¼Œå…¶ä»–å¯¹è±¡æ²¡æœ‰æ„é€ å®Œæˆ</li>
</ul>
<h3 id="5-holderæ–¹å¼">5. Holderæ–¹å¼</h3>
<pre><code class="language-java">class Singleton{
    
    private Singleton(){}

    private static class instanceHolder {
        private static Singleton singleton = new Singleton();
    }

    public static  Singleton getSingleton(){
        return instanceHolder.singleton;
    }
}
</code></pre>
<ul>
<li>
<p>é™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨Singletonç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨getInstanceæ–¹æ³•ï¼Œæ‰ä¼šè£…è½½SingletonInstanceç±»ï¼Œä»è€Œå®Œæˆå¯¹è±¡çš„å®ä¾‹åŒ–ã€‚</p>
</li>
<li>
<p>åŒæ—¶ï¼Œå› ä¸ºç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œä¹Ÿå°±ä¿è¯äº†SingletonInstanceä¸­çš„å¯¹è±¡åªä¼šè¢«å®ä¾‹åŒ–ä¸€æ¬¡ï¼Œå¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
</li>
</ul>
<h3 id="6-æšä¸¾">6. æšä¸¾</h3>
<pre><code class="language-java">class Singleton{
    private Singleton(){}

    private enum enmuSingleton{
        INSTANCE;

        private Singleton singleton;
        enmuSingleton(){
            singleton = new Singleton();
        }

        public Singleton getSingleton() {
            return singleton;
        }
    }


    public static  Singleton getSingleton(){
        return enmuSingleton.INSTANCE.getSingleton();
    }
}
</code></pre>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-java%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8Bjmm">ä¸€ã€Javaå†…å­˜æ¨¡å‹JMM</a></li>
<li><a href="#%E4%BA%8C-%E5%86%85%E5%AD%98%E9%97%B4%E4%BA%A4%E4%BA%92%E6%93%8D%E4%BD%9C">äºŒã€å†…å­˜é—´äº¤äº’æ“ä½œ</a></li>
<li><a href="#%E4%B8%89-%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B%E4%B8%89%E5%A4%A7%E7%89%B9%E6%80%A7">ä¸‰ã€å†…å­˜æ¨¡å‹ä¸‰å¤§ç‰¹æ€§</a>
<ul>
<li><a href="#%E5%8E%9F%E5%AD%90%E6%80%A7">åŸå­æ€§</a></li>
<li><a href="#%E5%8F%AF%E8%A7%81%E6%80%A7">å¯è§æ€§</a></li>
<li><a href="#%E6%9C%89%E5%BA%8F%E6%80%A7">æœ‰åºæ€§</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-%E9%87%8D%E6%8E%92%E5%BA%8F">å››ã€é‡æ’åº</a></li>
<li><a href="#%E4%BA%94-happens-before%E5%8E%9F%E5%88%99">äº”ã€happens-beforeåŸåˆ™</a></li>
<li><a href="#%E5%85%AD-volatitle">å…­ã€volatitle</a>
<ul>
<li><a href="#1-volatitle%E5%8F%98%E9%87%8F%E4%B8%BA%E4%BD%95%E7%AB%8B%E5%8D%B3%E5%8F%AF%E8%A7%81">1. volatitleå˜é‡ä¸ºä½•ç«‹å³å¯è§ï¼Ÿ</a></li>
<li><a href="#2-%E5%A6%82%E4%BD%95%E7%A6%81%E6%AD%A2%E9%87%8D%E6%8E%92%E5%BA%8F%E4%BC%98%E5%8C%96">2. å¦‚ä½•ç¦æ­¢é‡æ’åºä¼˜åŒ–ï¼Ÿ</a></li>
<li><a href="#3-%E5%92%8Csynchronized%E7%9A%84%E5%8C%BA%E5%88%AB">3. å’Œsynchronizedçš„åŒºåˆ«ï¼Ÿ</a></li>
</ul>
</li>
<li><a href="#%E4%B8%83-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F">ä¸ƒã€å•ä¾‹æ¨¡å¼</a>
<ul>
<li><a href="#1-%E9%A5%BF%E6%B1%89%E5%BC%8F">1. é¥¿æ±‰å¼</a></li>
<li><a href="#2-%E6%99%AE%E9%80%9A%E7%9A%84%E6%87%92%E6%B1%89%E5%BC%8F">2. <strong>æ™®é€šçš„æ‡’æ±‰å¼</strong></a></li>
<li><a href="#3-%E5%90%8C%E6%AD%A5%E6%96%B9%E6%B3%95%E7%9A%84%E6%87%92%E6%B1%89%E5%BC%8F">3. åŒæ­¥æ–¹æ³•çš„æ‡’æ±‰å¼</a></li>
<li><a href="#4-%E4%BA%8C%E6%AC%A1%E6%A3%80%E6%9F%A5">4. äºŒæ¬¡æ£€æŸ¥</a></li>
<li><a href="#5-holder%E6%96%B9%E5%BC%8F">5. Holderæ–¹å¼</a></li>
<li><a href="#6-%E6%9E%9A%E4%B8%BE">6. æšä¸¾</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">

	  
		<div id="gitalk-container"></div>
		<!--è¯„è®ºæ˜¾ç¤ºåŒºï¼Œè¯·æ’å…¥åˆé€‚çš„ä½ç½®-->
<div id="comment"></div>
<!--Leancloud æ“ä½œåº“:-->
<script src="//cdn1.lncld.net/static/js/3.6.1/av-min.js"></script>
<!--Valine çš„æ ¸å¿ƒä»£ç åº“-->
<script src="//cdn.jsdelivr.net/npm/valine@1.4.4/dist/Valine.min.js"></script>
<script>
    new Valine({
        el:'#comment',
        appId: 'DysN4QrSvmmE6SpDXopbCLD6-gzGzoHsz',
        appKey: 'mjK643yLFa4WWXtobofr24Ap',
        placeholder: 'ãƒ¾ï¾‰â‰§âˆ€â‰¦)oå¿«æ¥è¯„è®ºä¸€ä¸‹å§!',
        avatar:''
    });
</script>
	  
		  
	  

</div></section>
</div></div></div>
<!--
<script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var list=document.querySelectorAll(".katex");for(var i=0;i<list.length;i++){list[i].style.display="unset"};
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
content="æœ¬æ–‡æœ€åæ›´æ–°äº2020-07-12ï¼Œå·²è¶…è¿‡ 1 å¹´æ²¡æœ‰æ›´æ–°ï¼Œæ¶‰åŠçš„å†…å®¹å¯èƒ½å·²ç»å¤±æ•ˆï¼";var date1="2020-07-12 18:43:53";date1=date1.replace("-","/");var date2=new Date();var date3=date2.getTime()-new Date(date1).getTime();var days=Math.floor(date3/(24*3600*1000));if(days>=365){document.getElementById("warn").innerHTML=content};
</script>
-->

<script>
    "use strict";
    ! function () {
        for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
            n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
            for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
                n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
            }
        }
    }();
    let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
    window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;
        mainNavLinks.forEach((link, index) => {
            let section = document.getElementById(decodeURI(link.hash).substring(1));
            let nextSection = null
            if (mainNavLinks[index + 1]) {
                nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
                    1));
            }
            if (section.offsetTop <= fromTop) {
                if (nextSection) {
                    if (nextSection.offsetTop > fromTop) {
                        link.classList.add("currentToc");
                    } else {
                        link.classList.remove("currentToc");
                    }
                } else {
                    link.classList.add("currentToc");
                }
            } else {
                link.classList.remove("currentToc");
            }
        });
    });
    var list = document.querySelectorAll(".katex");
    for (var i = 0; i < list.length; i++) {
        list[i].style.display = "unset"
    };
    var h = document.documentElement,
        b = document.body,
        st = "scrollTop",
        sh = "scrollHeight",
        progress = document.querySelector(".progress"),
        scroll;
    document.addEventListener("scroll", function () {
        scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
        progress.style.setProperty("--scroll", scroll + "%")
    });
    var wxScale = new WxScale({
        fullPage: document.querySelector("#fullPage"),
        canvas: document.querySelector("#canvas")
    });
    var imgBox = document.querySelectorAll("#md_block img");
    for (var i = 0; i < imgBox.length; i++) {
        imgBox[i].onclick = function (e) {
            wxScale.start(this)
        }
    };
    content = "æœ¬æ–‡æœ€åæ›´æ–°äº2020-07-12ï¼Œå·²è¶…è¿‡ 1 å¹´æ²¡æœ‰æ›´æ–°ï¼Œæ¶‰åŠçš„å†…å®¹å¯èƒ½å·²ç»å¤±æ•ˆï¼";
    var date1 = "2020-07-12 18:43:53";
    date1 = date1.replace("-", "/");
    var date2 = new Date();
    var date3 = date2.getTime() - new Date(date1).getTime();
    var days = Math.floor(date3 / (24 * 3600 * 1000));
    if (days >= 365) {
        document.getElementById("warn").innerHTML = content
    };
</script>

<style>#magnifyImg{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#magnifyImg img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Copyright Â© 2018-2020 <a href="https://xzzz2020.github.io" style="margin:0;">xzzz2020</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_pv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>58</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://xzzz2020.github.io/media/js/prism.js"></script>
</body>
</html>