<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://xzzz2020.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="æ¸©æ•…è€ŒçŸ¥æ–°"><meta charset="UTF-8"><title>ã€æ€»ç»“ã€‘Redisé…ç½® | xzzz2020</title>
<link href="https://xzzz2020.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://xzzz2020.github.io/media/css/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://xzzz2020.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<link rel="canonical" href="https://xzzz2020.github.io/post/IAIpFCygR/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://xzzz2020.github.io"><img alt="logo" style="display:inline-block;" src="https://xzzz2020.github.io/images/avatar.png"/></a><h1 title="xzzz2020" class="weaklink"><a  href="/">xzzz2020</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1599740351189" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>ã€æ€»ç»“ã€‘Redisé…ç½®</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2020-07-27</span><i class="iconfont icon-browse"></i><span style="margin-right:15px"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px">	<a href="https://xzzz2020.github.io/tag/Redis/" class="tag">Redis</a> | 	<a href="https://xzzz2020.github.io/tag/Interview_summary/" class="tag">é¢è¯•æ€»ç»“</a></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">4544å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">18 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<img class="featureImg" alt="featureimg" src="https://img-1302474103.cos.ap-nanjing.myqcloud.com/img/photo-1592438893151-2f81c7cb0532.webp" referrerpolicy="no-referrer">

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<blockquote>
<p>è¯¥æ–‡ç« ä¸ºçŸ¥è¯†æ€»ç»“çš„æ–‡ç« ï¼Œå¦‚æœæ˜¯åˆå­¦è€…ï¼Œå»ºè®®å…ˆä»ä¸“æ å­¦ä¹ ï¼š<a href="https://blog.csdn.net/qq_43040688/category_10005022.html">Redisä¸“æ </a></p>
</blockquote>
<p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E5%AE%B9%E7%81%BE%E7%AD%96%E7%95%A5">ä¸€ã€å®¹ç¾ç­–ç•¥</a>
<ul>
<li><a href="#1-%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AErdb%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6">1. å¦‚ä½•é…ç½®RDBæŒä¹…åŒ–æœºåˆ¶</a></li>
<li><a href="#2-rdb%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">2. RDBæŒä¹…åŒ–æœºåˆ¶çš„å·¥ä½œæµç¨‹</a></li>
<li><a href="#3-aof%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE">3. AOFæŒä¹…åŒ–çš„é…ç½®</a></li>
<li><a href="#4-aof-rewrite">4. AOF rewrite</a></li>
<li><a href="#5-aof%E7%A0%B4%E6%8D%9F%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%AE%E5%A4%8D">5. AOFç ´æŸæ–‡ä»¶çš„ä¿®å¤</a></li>
<li><a href="#6-aof%E5%92%8Crdb%E5%90%8C%E6%97%B6%E5%B7%A5%E4%BD%9C">6. AOFå’ŒRDBåŒæ—¶å·¥ä½œ</a></li>
<li><a href="#7-%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9A%84%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5">7. ä¼ä¸šçº§çš„å¤‡ä»½ç­–ç•¥</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB">äºŒã€è¯»å†™åˆ†ç¦»</a>
<ul>
<li><a href="#1-redis-replication%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E8%BF%87%E7%A8%8B">1. redis replicationä¸»ä»å¤åˆ¶è¿‡ç¨‹</a></li>
<li><a href="#2-%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA">2. ä¸»ä»æ­å»º</a>
<ul>
<li><a href="#%E4%BB%8E%E8%8A%82%E7%82%B9">ä»èŠ‚ç‚¹</a></li>
<li><a href="#%E4%B8%BB%E8%8A%82%E7%82%B9">ä¸»èŠ‚ç‚¹</a></li>
<li><a href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9E%B6%E6%9E%84%E7%9A%84%E6%B5%8B%E8%AF%95">è¯»å†™åˆ†ç¦»æ¶æ„çš„æµ‹è¯•</a></li>
</ul>
</li>
<li><a href="#3-%E5%BF%AB%E9%80%9F%E5%8E%8B%E6%B5%8B">3. å¿«é€Ÿå‹æµ‹</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%93%A8%E5%85%B5%E9%85%8D%E7%BD%AE">ä¸‰ã€å“¨å…µé…ç½®</a>
<ul>
<li><a href="#1-%E8%A7%A3%E5%86%B3%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6%E5%92%8C%E8%84%91%E8%A3%82%E5%AF%BC%E8%87%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1">1. è§£å†³å¼‚æ­¥å¤åˆ¶å’Œè„‘è£‚å¯¼è‡´çš„æ•°æ®ä¸¢å¤±</a></li>
<li><a href="#2-%E9%85%8D%E7%BD%AE%E7%BB%8F%E5%85%B8%E4%B8%89%E8%8A%82%E7%82%B9%E5%93%A8%E5%85%B5">2. é…ç½®ç»å…¸ä¸‰èŠ‚ç‚¹å“¨å…µ</a></li>
<li><a href="#3-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">3. å¸¸ç”¨å‘½ä»¤</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-redis-cluster%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE">å››ã€Redis-clusteré›†ç¾¤é…ç½®</a>
<ul>
<li><a href="#1-redis-cluster%E7%9A%84%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE">1. redis clusterçš„é‡è¦é…ç½®</a></li>
<li><a href="#2-%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2. ç¼–å†™é…ç½®æ–‡ä»¶</a></li>
<li><a href="#3-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83">3. å‡†å¤‡ç¯å¢ƒ</a></li>
<li><a href="#4-%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4">4. åˆ›å»ºé›†ç¾¤</a></li>
<li><a href="#5-%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9">5. æ·»åŠ åˆ é™¤èŠ‚ç‚¹</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h2 id="ä¸€-å®¹ç¾ç­–ç•¥">ä¸€ã€å®¹ç¾ç­–ç•¥</h2>
<h3 id="1-å¦‚ä½•é…ç½®rdbæŒä¹…åŒ–æœºåˆ¶">1. å¦‚ä½•é…ç½®RDBæŒä¹…åŒ–æœºåˆ¶</h3>
<p>redis.confæ–‡ä»¶ï¼Œä¹Ÿå°±æ˜¯/etc/redis/6379.confï¼Œå»é…ç½®æŒä¹…åŒ–</p>
<pre><code class="language-go">save 900 1
save 300 10
save 60 10000
</code></pre>
<p>æ¯éš”60sï¼Œå¦‚æœæœ‰è¶…è¿‡1000ä¸ªkeyå‘ç”Ÿäº†å˜æ›´ï¼Œé‚£ä¹ˆå°±ç”Ÿæˆä¸€ä¸ªæ–°çš„dump.rdbæ–‡ä»¶ï¼Œå°±æ˜¯å½“å‰rediså†…å­˜ä¸­å®Œæ•´çš„æ•°æ®å¿«ç…§ï¼Œè¿™ä¸ªæ“ä½œä¹Ÿè¢«ç§°ä¹‹ä¸ºsnapshottingï¼Œå¿«ç…§</p>
<p>ä¹Ÿå¯ä»¥æ‰‹åŠ¨è°ƒç”¨saveæˆ–è€…bgsaveå‘½ä»¤ï¼ŒåŒæ­¥æˆ–å¼‚æ­¥æ‰§è¡Œrdbå¿«ç…§ç”Ÿæˆ</p>
<p>saveå¯ä»¥è®¾ç½®å¤šä¸ªï¼Œå°±æ˜¯å¤šä¸ªsnapshottingæ£€æŸ¥ç‚¹ï¼Œæ¯åˆ°ä¸€ä¸ªæ£€æŸ¥ç‚¹ï¼Œå°±ä¼šå»checkä¸€ä¸‹ï¼Œæ˜¯å¦æœ‰æŒ‡å®šçš„keyæ•°é‡å‘ç”Ÿäº†å˜æ›´ï¼Œå¦‚æœæœ‰ï¼Œå°±ç”Ÿæˆä¸€ä¸ªæ–°çš„dump.rdbæ–‡ä»¶</p>
<h3 id="2-rdbæŒä¹…åŒ–æœºåˆ¶çš„å·¥ä½œæµç¨‹">2. RDBæŒä¹…åŒ–æœºåˆ¶çš„å·¥ä½œæµç¨‹</h3>
<p>ï¼ˆ1ï¼‰redisæ ¹æ®é…ç½®è‡ªå·±å°è¯•å»ç”Ÿæˆrdbå¿«ç…§æ–‡ä»¶</p>
<p>ï¼ˆ2ï¼‰forkä¸€ä¸ªå­è¿›ç¨‹å‡ºæ¥</p>
<p>ï¼ˆ3ï¼‰å­è¿›ç¨‹å°è¯•å°†æ•°æ®dumpåˆ°ä¸´æ—¶çš„rdbå¿«ç…§æ–‡ä»¶ä¸­</p>
<p>ï¼ˆ4ï¼‰å®Œæˆrdbå¿«ç…§æ–‡ä»¶çš„ç”Ÿæˆä¹‹åï¼Œå°±æ›¿æ¢ä¹‹å‰çš„æ—§çš„å¿«ç…§æ–‡ä»¶</p>
<p>dump.rdbï¼Œæ¯æ¬¡ç”Ÿæˆä¸€ä¸ªæ–°çš„å¿«ç…§ï¼Œéƒ½ä¼šè¦†ç›–ä¹‹å‰çš„è€å¿«ç…§</p>
<h3 id="3-aofæŒä¹…åŒ–çš„é…ç½®">3. AOFæŒä¹…åŒ–çš„é…ç½®</h3>
<p>AOFæŒä¹…åŒ–ï¼Œé»˜è®¤æ˜¯å…³é—­çš„ï¼Œé»˜è®¤æ˜¯æ‰“å¼€RDBæŒä¹…åŒ–</p>
<p><strong>appendonly yes</strong>ï¼Œå¯ä»¥æ‰“å¼€AOFæŒä¹…åŒ–æœºåˆ¶ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒé‡Œé¢ï¼Œä¸€èˆ¬æ¥è¯´AOFéƒ½æ˜¯è¦æ‰“å¼€çš„ï¼Œé™¤éä½ è¯´éšä¾¿ä¸¢ä¸ªå‡ åˆ†é’Ÿçš„æ•°æ®ä¹Ÿæ— æ‰€è°“</p>
<p>æ‰“å¼€AOFæŒä¹…åŒ–æœºåˆ¶ä¹‹åï¼Œredisæ¯æ¬¡æ¥æ”¶åˆ°ä¸€æ¡å†™å‘½ä»¤ï¼Œå°±ä¼šå†™å…¥æ—¥å¿—æ–‡ä»¶ä¸­ï¼Œå½“ç„¶æ˜¯å…ˆå†™å…¥os cacheçš„ï¼Œç„¶åæ¯éš”ä¸€å®šæ—¶é—´å†fsyncä¸€ä¸‹</p>
<p>è€Œä¸”å³ä½¿AOFå’ŒRDBéƒ½å¼€å¯äº†ï¼Œredisé‡å¯çš„æ—¶å€™ï¼Œä¹Ÿæ˜¯ä¼˜å…ˆé€šè¿‡AOFè¿›è¡Œæ•°æ®æ¢å¤çš„ï¼Œå› ä¸ºaofæ•°æ®æ¯”è¾ƒå®Œæ•´</p>
<p>å¯ä»¥é…ç½®AOFçš„fsyncç­–ç•¥ï¼Œæœ‰ä¸‰ç§ç­–ç•¥å¯ä»¥é€‰æ‹©ï¼Œä¸€ç§æ˜¯æ¯æ¬¡å†™å…¥ä¸€æ¡æ•°æ®å°±æ‰§è¡Œä¸€æ¬¡fsync; ä¸€ç§æ˜¯æ¯éš”ä¸€ç§’æ‰§è¡Œä¸€æ¬¡fsync; ä¸€ç§æ˜¯ä¸ä¸»åŠ¨æ‰§è¡Œfsync</p>
<ul>
<li>
<p><strong>always</strong>: æ¯æ¬¡å†™å…¥ä¸€æ¡æ•°æ®ï¼Œç«‹å³å°†è¿™ä¸ªæ•°æ®å¯¹åº”çš„å†™æ—¥å¿—fsyncåˆ°ç£ç›˜ä¸Šå»ï¼Œ<strong>æ€§èƒ½éå¸¸éå¸¸å·®ï¼Œååé‡å¾ˆä½; ç¡®ä¿è¯´redisé‡Œçš„æ•°æ®ä¸€æ¡éƒ½ä¸ä¸¢</strong>ï¼Œé‚£å°±åªèƒ½è¿™æ ·äº†</p>
</li>
<li>
<p><strong>everysec</strong>: æ¯ç§’å°†os cacheä¸­çš„æ•°æ®fsyncåˆ°ç£ç›˜ï¼Œè¿™ä¸ªæœ€å¸¸ç”¨çš„ï¼Œç”Ÿäº§ç¯å¢ƒä¸€èˆ¬éƒ½è¿™ä¹ˆé…ç½®ï¼Œæ€§èƒ½å¾ˆé«˜ï¼ŒQPSè¿˜æ˜¯å¯ä»¥ä¸Šä¸‡çš„ï¼Œä½†æ˜¯å¯èƒ½ä¼šå¤±å»ä¸€ç§’çš„æ•°æ®</p>
</li>
<li>
<p><strong>no</strong>: ä»…ä»…redisè´Ÿè´£å°†æ•°æ®å†™å…¥os cacheå°±æ’’æ‰‹ä¸ç®¡äº†ï¼Œç„¶ååé¢osè‡ªå·±ä¼šæ—¶ä¸æ—¶æœ‰è‡ªå·±çš„ç­–ç•¥å°†æ•°æ®åˆ·å…¥ç£ç›˜ï¼Œä¸å¯æ§äº†</p>
</li>
</ul>
<pre><code class="language-java"># appendfsync always
appendfsync everysec
# appendfsync no
</code></pre>
<h3 id="4-aof-rewrite">4. AOF rewrite</h3>
<p>redisä¸­çš„æ•°æ®å…¶å®æœ‰é™çš„ï¼Œå¾ˆå¤šæ•°æ®å¯èƒ½ä¼šè‡ªåŠ¨è¿‡æœŸï¼Œå¯èƒ½ä¼šè¢«ç”¨æˆ·åˆ é™¤ï¼Œå¯èƒ½ä¼šè¢«redisç”¨ç¼“å­˜æ¸…é™¤çš„ç®—æ³•æ¸…ç†æ‰ã€‚</p>
<p>redisä¸­çš„æ•°æ®ä¼šä¸æ–­æ·˜æ±°æ‰æ—§çš„ï¼Œå°±ä¸€éƒ¨åˆ†å¸¸ç”¨çš„æ•°æ®ä¼šè¢«è‡ªåŠ¨ä¿ç•™åœ¨rediså†…å­˜ä¸­</p>
<p>æ‰€ä»¥å¯èƒ½å¾ˆå¤šä¹‹å‰çš„å·²ç»è¢«æ¸…ç†æ‰çš„æ•°æ®ï¼Œå¯¹åº”çš„å†™æ—¥å¿—è¿˜åœç•™åœ¨AOFä¸­ï¼ŒAOFæ—¥å¿—æ–‡ä»¶å°±ä¸€ä¸ªï¼Œä¼šä¸æ–­çš„è†¨èƒ€ï¼Œåˆ°å¾ˆå¤§å¾ˆå¤§ã€‚</p>
<p>æ‰€ä»¥AOFä¼šè‡ªåŠ¨åœ¨åå°æ¯éš”ä¸€å®šæ—¶é—´åšrewriteæ“ä½œï¼Œæ¯”å¦‚æ—¥å¿—é‡Œå·²ç»å­˜æ”¾äº†é’ˆå¯¹100wæ•°æ®çš„å†™æ—¥å¿—äº†; rediså†…å­˜åªå‰©ä¸‹10ä¸‡; åŸºäºå†…å­˜ä¸­å½“å‰çš„10ä¸‡æ•°æ®æ„å»ºä¸€å¥—æœ€æ–°çš„æ—¥å¿—ï¼Œåˆ°AOFä¸­; è¦†ç›–ä¹‹å‰çš„è€æ—¥å¿—; ç¡®ä¿AOFæ—¥å¿—æ–‡ä»¶ä¸ä¼šè¿‡å¤§ï¼Œä¿æŒè·Ÿrediså†…å­˜æ•°æ®é‡ä¸€è‡´</p>
<pre><code>no-appendfsync-on-rewrite no
</code></pre>
<p>å½“è¿›è¡Œrewriteæ“ä½œæ—¶ï¼Œæ¶‰åŠå¤§é‡ç£ç›˜æ“ä½œï¼Œè¿™æ ·å°±ä¼šé€ æˆä¸»è¿›ç¨‹åœ¨å†™aofæ–‡ä»¶çš„æ—¶å€™å‡ºç°é˜»å¡çš„æƒ…å½¢ï¼Œè®¾ç½®æˆnoæ„æ€å°±æ˜¯æ¥å—é˜»å¡ï¼Œè€Œè®¾ç½®æˆyesåˆ™ç›¸å½“äºå°†appendfsyncè®¾ç½®ä¸ºnoï¼Œå°†å¯èƒ½ä¸¢å¤±30sçš„æ•°æ®</p>
<p>å¦‚æœåº”ç”¨ç³»ç»Ÿæ— æ³•å¿å—å»¶è¿Ÿï¼Œè€Œå¯ä»¥å®¹å¿å°‘é‡çš„æ•°æ®ä¸¢å¤±ï¼Œåˆ™è®¾ç½®ä¸ºyesï¼›å¦‚æœåº”ç”¨ç³»ç»Ÿæ— æ³•å¿å—æ•°æ®ä¸¢å¤±ï¼Œåˆ™è®¾ç½®ä¸ºnoã€‚</p>
<p>åœ¨redis.confä¸­ï¼Œå¯ä»¥é…ç½®rewriteç­–ç•¥</p>
<pre><code>auto-aof-rewrite-percentage 100  # å¢é•¿è¶…è¿‡100%çš„æ¯”ä¾‹

auto-aof-rewrite-min-size 64mb   # æœ€å°çš„é‡å†™å¤§å°
</code></pre>
<p>æ¯ä¸€æ¬¡rewriteä¹‹åä¼šè®°ä½å½“å‰æ–‡ä»¶çš„å¤§å°ï¼Œå½“æ–‡ä»¶å¤§å°è¶…è¿‡ä¸€å®šæ¯”ä¾‹æ—¶å°±ä¼šè¿›è¡Œrewrite</p>
<p>æ¯”å¦‚è¯´ä¸Šä¸€æ¬¡AOF rewriteä¹‹åï¼Œæ˜¯128mb</p>
<p>ç„¶åå°±ä¼šæ¥ç€128mbç»§ç»­å†™AOFçš„æ—¥å¿—ï¼Œå¦‚æœå‘ç°å¢é•¿çš„æ¯”ä¾‹ï¼Œè¶…è¿‡äº†ä¹‹å‰çš„100%ï¼Œ256mbï¼Œå°±å¯èƒ½ä¼šå»è§¦å‘ä¸€æ¬¡rewrite</p>
<p>ä½†æ˜¯æ­¤æ—¶è¿˜è¦å»è·Ÿmin-sizeï¼Œ64mbå»æ¯”è¾ƒï¼Œ256mb &gt; 64mbï¼Œæ‰ä¼šå»è§¦å‘rewrite</p>
<p><strong>é‡å†™çš„è¿‡ç¨‹</strong>ï¼š</p>
<ol>
<li>
<p>redis forkä¸€ä¸ªå­è¿›ç¨‹</p>
</li>
<li>
<p>å­è¿›ç¨‹åŸºäºå½“å‰å†…å­˜ä¸­çš„æ•°æ®ï¼Œæ„å»ºæ—¥å¿—ï¼Œå¼€å§‹å¾€ä¸€ä¸ªæ–°çš„ä¸´æ—¶çš„AOFæ–‡ä»¶ä¸­å†™å…¥æ—¥å¿—</p>
</li>
<li>
<p>redisä¸»è¿›ç¨‹ï¼Œæ¥æ”¶åˆ°clientæ–°çš„å†™æ“ä½œä¹‹åï¼Œåœ¨å†…å­˜ä¸­å†™å…¥æ—¥å¿—ï¼ŒåŒæ—¶æ–°çš„æ—¥å¿—ä¹Ÿç»§ç»­å†™å…¥æ—§çš„AOFæ–‡ä»¶</p>
</li>
<li>
<p>å­è¿›ç¨‹å†™å®Œæ–°çš„æ—¥å¿—æ–‡ä»¶ä¹‹åï¼Œredisä¸»è¿›ç¨‹å°†å†…å­˜ä¸­çš„æ–°æ—¥å¿—å†æ¬¡è¿½åŠ åˆ°æ–°çš„AOFæ–‡ä»¶ä¸­</p>
</li>
<li>
<p>ç”¨æ–°çš„æ—¥å¿—æ–‡ä»¶æ›¿æ¢æ‰æ—§çš„æ—¥å¿—æ–‡ä»¶</p>
</li>
</ol>
<h3 id="5-aofç ´æŸæ–‡ä»¶çš„ä¿®å¤">5. AOFç ´æŸæ–‡ä»¶çš„ä¿®å¤</h3>
<p>å¦‚æœredisåœ¨appendæ•°æ®åˆ°AOFæ–‡ä»¶æ—¶ï¼Œæœºå™¨å®•æœºäº†ï¼Œå¯èƒ½ä¼šå¯¼è‡´AOFæ–‡ä»¶ç ´æŸ</p>
<p><strong>ç”¨redis-check-aof --fixå‘½ä»¤æ¥ä¿®å¤ç ´æŸçš„AOFæ–‡ä»¶ï¼Œå°±æ˜¯åˆ é™¤é‚£äº›ç ´æŸçš„å‘½ä»¤</strong></p>
<h3 id="6-aofå’ŒrdbåŒæ—¶å·¥ä½œ">6. AOFå’ŒRDBåŒæ—¶å·¥ä½œ</h3>
<ol>
<li><strong>RDBå’ŒAOF é‡å†™åŒä¸€æ—¶é—´åªä¼šæ‰§è¡Œä¸€ä¸ª</strong></li>
<li>åŒæ—¶æœ‰RDB snapshotæ–‡ä»¶å’ŒAOFæ—¥å¿—æ–‡ä»¶ï¼Œ<strong>é‚£ä¹ˆredisé‡å¯çš„æ—¶å€™ï¼Œä¼šä¼˜å…ˆä½¿ç”¨AOFè¿›è¡Œæ•°æ®æ¢å¤ï¼Œå› ä¸ºå…¶ä¸­çš„æ—¥å¿—æ›´å®Œæ•´</strong></li>
</ol>
<h3 id="7-ä¼ä¸šçº§çš„å¤‡ä»½ç­–ç•¥">7. ä¼ä¸šçº§çš„å¤‡ä»½ç­–ç•¥</h3>
<p>RDBä¸­æ¯éš”ä¸€åˆ†é’Ÿæ›´æ”¹çš„æ•°æ®é‡ä¸ºå¤šå°‘éœ€è¦æ ¹æ®ä¸šåŠ¡éœ€æ±‚æ”¹å˜</p>
<blockquote>
<p>åšä¸»è®¾ç½®çš„ä¸º<code>save 60 1000</code></p>
</blockquote>
<p>AOFä¸€å®šè¦æ‰“å¼€ï¼Œfsyncç£ç›˜åˆ·æ–°ç­–ç•¥ä½¿ç”¨everysecï¼Œé‡å†™ç­–ç•¥é‡‡ç”¨å°±æ˜¯è¶…è¿‡100%ï¼Œæœ€å°å¤§å°è®¾ç½®ä¸º16mb</p>
<pre><code>auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 16mb
</code></pre>
<p>ç„¶åè®¾ç½®å®šæ—¶ä»»åŠ¡æ¯å¤©å’Œæ¯ä¸ªå°æ—¶éƒ½åšä¸€ä¸ªå¤‡ä»½ï¼Œç„¶åæ¯å¤©éƒ½å°†å¤‡ä»½ä¸Šä¼ åˆ°äº‘æœåŠ¡å™¨ä¸Š</p>
<p>å¤‡ä»½ä¹Ÿå¯ä»¥é¿å…ä¸Šçº¿å‡ºç°çš„BUGï¼Œæ¯”å¦‚12ç‚¹ä¸Šçº¿äº†ä»£ç ï¼Œå‘ç°ä»£ç æœ‰bugï¼Œå¯¼è‡´ä»£ç ç”Ÿæˆçš„æ‰€æœ‰çš„ç¼“å­˜æ•°æ®ï¼Œå†™å…¥redisï¼Œå…¨éƒ¨é”™äº†æ‰¾åˆ°ä¸€ä»½11ç‚¹çš„rdbçš„å†·å¤‡ï¼Œç„¶åæŒ‰ç…§ä¸Šé¢çš„æ­¥éª¤ï¼Œå»æ¢å¤åˆ°11ç‚¹çš„æ•°æ®</p>
<h2 id="äºŒ-è¯»å†™åˆ†ç¦»">äºŒã€è¯»å†™åˆ†ç¦»</h2>
<p>å•æœºRedisæœ€é«˜ä¸è¶…è¿‡10ä¸‡QPSï¼Œä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤§é‡çš„è¯·æ±‚éƒ½æ˜¯è¯»è¯·æ±‚</p>
<h3 id="1-redis-replicationä¸»ä»å¤åˆ¶è¿‡ç¨‹">1. redis replicationä¸»ä»å¤åˆ¶è¿‡ç¨‹</h3>
<blockquote>
<p>åƒä¸‡ä¸èƒ½å…³é—­ä¸»èŠ‚ç‚¹çš„æŒä¹…åŒ–ï¼Œå¦åˆ™ä¸€æ—¦é‡å¯ä¸»èŠ‚ç‚¹ï¼Œæ•°æ®å°†æ˜¯ç©ºï¼Œç„¶åå°†å…¨éƒ¨çš„ä»èŠ‚ç‚¹ä¹Ÿå˜æˆç©º</p>
</blockquote>
<p>å½“å¯åŠ¨ä¸€ä¸ªslave nodeçš„æ—¶å€™ï¼Œå®ƒä¼šå‘é€ä¸€ä¸ªPSYNCå‘½ä»¤ç»™master node</p>
<p>å¦‚æœè¿™æ˜¯slave nodeé‡æ–°è¿æ¥master nodeï¼Œé‚£ä¹ˆmaster nodeä»…ä»…ä¼šå¤åˆ¶ç»™slaveéƒ¨åˆ†ç¼ºå°‘çš„æ•°æ®; å¦åˆ™å¦‚æœæ˜¯slave nodeç¬¬ä¸€æ¬¡è¿æ¥master nodeï¼Œé‚£ä¹ˆä¼šè§¦å‘ä¸€æ¬¡å…¨é‡å¤åˆ¶</p>
<p><strong>å…¨é‡å¤åˆ¶</strong></p>
<ul>
<li>masterä¼šå¯åŠ¨ä¸€ä¸ªåå°çº¿ç¨‹ï¼Œå¼€å§‹ç”Ÿæˆä¸€ä»½RDBå¿«ç…§æ–‡ä»¶ï¼ŒåŒæ—¶è¿˜ä¼šå°†ä»å®¢æˆ·ç«¯æ”¶åˆ°çš„æ‰€æœ‰å†™å‘½ä»¤ç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚RDBæ–‡ä»¶ç”Ÿæˆå®Œæ¯•ä¹‹åï¼Œmasterä¼šå°†è¿™ä¸ªRDBå‘é€ç»™slaveï¼Œslaveä¼šå…ˆå†™å…¥æœ¬åœ°ç£ç›˜ï¼Œç„¶åå†ä»æœ¬åœ°ç£ç›˜åŠ è½½åˆ°å†…å­˜ä¸­ã€‚ç„¶åmasterä¼šå°†å†…å­˜ä¸­ç¼“å­˜çš„å†™å‘½ä»¤å‘é€ç»™slaveï¼Œslaveä¹Ÿä¼šåŒæ­¥è¿™äº›æ•°æ®ã€‚</li>
<li>å¦‚æœå‘ç°æœ‰å¤šä¸ªslave nodeéƒ½æ¥é‡æ–°è¿æ¥ï¼Œä»…ä»…ä¼šå¯åŠ¨ä¸€ä¸ªrdb saveæ“ä½œï¼Œç”¨ä¸€ä»½æ•°æ®æœåŠ¡æ‰€æœ‰slave nodeã€‚</li>
</ul>
<p><strong>å¼‚æ­¥åŒæ­¥</strong></p>
<ul>
<li>å½“ç»™ä¸€ä¸ªä¸»èŠ‚ç‚¹å†™ä¸€æ¡æ•°æ®çš„æ—¶å€™ï¼Œä¼šç›´æ¥è¿”å›ç»™å®¢æˆ·ç«¯å†™å…¥æˆåŠŸï¼Œç„¶ååœ¨å¼‚æ­¥çš„æŠŠè¿™ä¸ªå‘½ä»¤åŒæ­¥ç»™ä»èŠ‚ç‚¹</li>
</ul>
<p><strong>æ–­ç‚¹ç»­ä¼ </strong></p>
<ul>
<li>å¦‚æœä¸»ä»å¤åˆ¶è¿‡ç¨‹ä¸­ï¼Œç½‘ç»œè¿æ¥æ–­æ‰äº†ï¼Œé‚£ä¹ˆå¯ä»¥æ¥ç€ä¸Šæ¬¡å¤åˆ¶çš„åœ°æ–¹ï¼Œç»§ç»­å¤åˆ¶ä¸‹å»ï¼Œè€Œä¸æ˜¯ä»å¤´å¼€å§‹å¤åˆ¶ä¸€ä»½</li>
</ul>
<p><strong>æ— ç£ç›˜åŒ–åŒæ­¥</strong></p>
<ul>
<li>masteråœ¨å†…å­˜ä¸­ç›´æ¥åˆ›å»ºrdbï¼Œç„¶åå‘é€ç»™slaveï¼Œä¸ä¼šåœ¨è‡ªå·±æœ¬åœ°è½åœ°ç£ç›˜äº†</li>
</ul>
<pre><code>repl-diskless-sync yes      # å¼€å¯æ— ç£ç›˜åŒ–ï¼Œé»˜è®¤æ˜¯false
repl-diskless-sync-delay 5  # ç­‰å¾…ä¸€å®šæ—¶é•¿å†å¼€å§‹å¤åˆ¶ï¼Œå› ä¸ºè¦ç­‰æ›´å¤šslaveé‡æ–°è¿æ¥è¿‡æ¥ï¼Œé»˜è®¤ç­‰å¾…5ç§’
</code></pre>
<p><strong>è¿‡æœŸkeyå¤„ç†</strong></p>
<ul>
<li>slaveä¸ä¼šè¿‡æœŸkeyï¼Œåªä¼šç­‰å¾…masterè¿‡æœŸkeyã€‚å¦‚æœmasterè¿‡æœŸäº†ä¸€ä¸ªkeyï¼Œæˆ–è€…é€šè¿‡LRUæ·˜æ±°äº†ä¸€ä¸ªkeyï¼Œé‚£ä¹ˆä¼šæ¨¡æ‹Ÿä¸€æ¡delå‘½ä»¤å‘é€ç»™slaveã€‚</li>
</ul>
<h3 id="2-ä¸»ä»æ­å»º">2. ä¸»ä»æ­å»º</h3>
<h4 id="ä»èŠ‚ç‚¹">ä»èŠ‚ç‚¹</h4>
<p><strong>ä¿®æ”¹ç»‘å®šçš„IPåœ°å€</strong></p>
<pre><code class="language-properties">bind 0.0.0.0
</code></pre>
<p><strong>é…ç½®ä»èŠ‚ç‚¹</strong></p>
<pre><code class="language-properties">slaveof  192.168.xxx.xxx 6379
</code></pre>
<p><strong>å¼ºåˆ¶è¯»å†™åˆ†ç¦»</strong></p>
<pre><code class="language-properties">slave-read-only yes
</code></pre>
<ul>
<li>å¼€å¯äº†åªè¯»çš„redis slave nodeï¼Œä¼šæ‹’ç»æ‰€æœ‰çš„å†™æ“ä½œï¼Œè¿™æ ·å¯ä»¥å¼ºåˆ¶æ­å»ºæˆè¯»å†™åˆ†ç¦»çš„æ¶æ„</li>
</ul>
<p><strong>é›†ç¾¤å®‰å…¨è®¤è¯</strong></p>
<pre><code class="language-properties">masterauth redis-pass # masterè¿æ¥å£ä»¤
</code></pre>
<h4 id="ä¸»èŠ‚ç‚¹">ä¸»èŠ‚ç‚¹</h4>
<p><strong>ä¿®æ”¹ç»‘å®šçš„IPåœ°å€</strong></p>
<pre><code class="language-properties">bind 0.0.0.0
</code></pre>
<p><strong>é›†ç¾¤å®‰å…¨è®¤è¯</strong></p>
<pre><code class="language-properties">requirepass redis-pass  # masterä¸Šå¯ç”¨å®‰å…¨è®¤è¯
</code></pre>
<h4 id="è¯»å†™åˆ†ç¦»æ¶æ„çš„æµ‹è¯•">è¯»å†™åˆ†ç¦»æ¶æ„çš„æµ‹è¯•</h4>
<ul>
<li>å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼Œeshop-cache01ä¸Šçš„rediså®ä¾‹</li>
<li>å†å¯åŠ¨ä»èŠ‚ç‚¹ï¼Œeshop-cache02ä¸Šçš„rediså®ä¾‹</li>
</ul>
<p><strong>ä½¿ç”¨å‘½ä»¤æŸ¥çœ‹å„ä¸ªèŠ‚ç‚¹çŠ¶æ€</strong></p>
<pre><code class="language-shell">redis-cli -a redis-pass
info replication
</code></pre>
<h3 id="3-å¿«é€Ÿå‹æµ‹">3. å¿«é€Ÿå‹æµ‹</h3>
<pre><code class="language-shell">redis-3.2.8/src

./redis-benchmark -h eshop-cache01

-c &lt;clients&gt;       Number of parallel connections (default 50)
-n &lt;requests&gt;      Total number of requests (default 100000)
-d &lt;size&gt;          Data size of SET/GET value in bytes (default 2)

æ ¹æ®ä½ è‡ªå·±çš„é«˜å³°æœŸçš„è®¿é—®é‡ï¼Œåœ¨é«˜å³°æœŸï¼Œç¬æ—¶æœ€å¤§ç”¨æˆ·é‡ä¼šè¾¾åˆ°10ä¸‡+ï¼Œ-c 100000ï¼Œ-n 10000000ï¼Œ-d 50
</code></pre>
<h2 id="ä¸‰-å“¨å…µé…ç½®">ä¸‰ã€å“¨å…µé…ç½®</h2>
<h3 id="1-è§£å†³å¼‚æ­¥å¤åˆ¶å’Œè„‘è£‚å¯¼è‡´çš„æ•°æ®ä¸¢å¤±">1. è§£å†³å¼‚æ­¥å¤åˆ¶å’Œè„‘è£‚å¯¼è‡´çš„æ•°æ®ä¸¢å¤±</h3>
<pre><code class="language-properties">min-slaves-to-write 1 # ä»æœåŠ¡å™¨çš„æ•°é‡å°‘äº1ä¸ªï¼Œæˆ–è€…å°äº1ä¸ªä»æœåŠ¡å™¨çš„å»¶è¿Ÿï¼ˆlagï¼‰å€¼éƒ½å°äºç­‰äº10ç§’æ—¶
min-slaves-max-lag 10 # å…è®¸ä¸¢å¤±å¤šé•¿æ—¶é—´çš„æ•°æ®é‡
</code></pre>
<ul>
<li>
<p><strong>è¦æ±‚è‡³å°‘æœ‰ä¸€ä¸ªslaveæ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’</strong></p>
</li>
<li>
<p><strong>å¦‚æœè¯´ä¸€æ—¦æ‰€æœ‰çš„slavesï¼Œæ•°æ®å¤åˆ¶å’ŒåŒæ­¥çš„å»¶è¿Ÿéƒ½è¶…è¿‡äº†10ç§’é’Ÿï¼Œæˆ–è€…å½“å‰è¿æ¥çš„slaveæ•°å°‘äº1ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ï¼Œmasterå°†ä¼šå˜æˆåªè¯»</strong></p>
</li>
</ul>
<p>ä¸Šé¢ä¸¤ä¸ªé…ç½®å¯ä»¥å‡å°‘å¼‚æ­¥å¤åˆ¶å’Œè„‘è£‚å¯¼è‡´çš„æ•°æ®ä¸¢å¤±</p>
<p><strong>ï¼ˆ1ï¼‰å‡å°‘å¼‚æ­¥å¤åˆ¶çš„æ•°æ®ä¸¢å¤±</strong></p>
<p>æœ‰äº†min-slaves-max-lagè¿™ä¸ªé…ç½®ï¼Œå°±å¯ä»¥ç¡®ä¿è¯´ï¼Œä¸€æ—¦slaveå¤åˆ¶æ•°æ®å’Œackå»¶æ—¶å¤ªé•¿ï¼Œå°±è®¤ä¸ºå¯èƒ½masterå®•æœºåæŸå¤±çš„æ•°æ®å¤ªå¤šäº†ï¼Œé‚£ä¹ˆå°±æ‹’ç»å†™è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æŠŠmasterå®•æœºæ—¶ç”±äºéƒ¨åˆ†æ•°æ®æœªåŒæ­¥åˆ°slaveå¯¼è‡´çš„æ•°æ®ä¸¢å¤±é™ä½çš„å¯æ§èŒƒå›´å†…</p>
<p><strong>ï¼ˆ2ï¼‰å‡å°‘è„‘è£‚çš„æ•°æ®ä¸¢å¤±</strong></p>
<p>å¦‚æœä¸€ä¸ªmasterå‡ºç°äº†è„‘è£‚ï¼Œè·Ÿå…¶ä»–slaveä¸¢äº†è¿æ¥ï¼Œé‚£ä¹ˆä¸Šé¢ä¸¤ä¸ªé…ç½®å¯ä»¥ç¡®ä¿è¯´ï¼Œå¦‚æœä¸èƒ½ç»§ç»­ç»™æŒ‡å®šæ•°é‡çš„slaveå‘é€æ•°æ®ï¼Œè€Œä¸”slaveè¶…è¿‡10ç§’æ²¡æœ‰ç»™è‡ªå·±ackæ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥æ‹’ç»å®¢æˆ·ç«¯çš„å†™è¯·æ±‚</p>
<p>è¿™æ ·è„‘è£‚åçš„æ—§masterå°±ä¸ä¼šæ¥å—clientçš„æ–°æ•°æ®ï¼Œä¹Ÿå°±é¿å…äº†æ•°æ®ä¸¢å¤±</p>
<p>ä¸Šé¢çš„é…ç½®å°±ç¡®ä¿äº†ï¼Œå¦‚æœè·Ÿæ‰€æœ‰çš„slaveä¸¢äº†è¿æ¥ï¼Œåœ¨10ç§’åå‘ç°æ²¡æœ‰slaveç»™è‡ªå·±ackï¼Œé‚£ä¹ˆå°±æ‹’ç»æ–°çš„å†™è¯·æ±‚</p>
<p>å› æ­¤åœ¨è„‘è£‚åœºæ™¯ä¸‹ï¼Œæœ€å¤šå°±ä¸¢å¤±10ç§’çš„æ•°æ®</p>
<h3 id="2-é…ç½®ç»å…¸ä¸‰èŠ‚ç‚¹å“¨å…µ">2. é…ç½®ç»å…¸ä¸‰èŠ‚ç‚¹å“¨å…µ</h3>
<p>å“¨å…µçš„é…ç½®æ–‡ä»¶åœ¨sentinel.conf</p>
<ul>
<li>
<p>æ¯ä¸€ä¸ªå“¨å…µéƒ½å¯ä»¥å»ç›‘æ§å¤šä¸ªmaser-slavesçš„ä¸»ä»æ¶æ„</p>
</li>
<li>
<p>å› ä¸ºå¯èƒ½ä½ çš„å…¬å¸é‡Œï¼Œä¸ºä¸åŒçš„é¡¹ç›®ï¼Œéƒ¨ç½²äº†å¤šä¸ªmaster-slavesçš„redisä¸»ä»é›†ç¾¤</p>
</li>
<li>
<p>ç›¸åŒçš„ä¸€å¥—å“¨å…µé›†ç¾¤ï¼Œå°±å¯ä»¥å»ç›‘æ§ä¸åŒçš„å¤šä¸ªredisä¸»ä»é›†ç¾¤</p>
</li>
<li>
<p>ä½ è‡ªå·±ç»™æ¯ä¸ªredisä¸»ä»é›†ç¾¤åˆ†é…ä¸€ä¸ªé€»è¾‘çš„åç§°</p>
</li>
</ul>
<p>ç±»ä¼¼è¿™ç§é…ç½®ï¼Œæ¥æŒ‡å®šå¯¹ä¸€ä¸ªmasterçš„ç›‘æ§ï¼Œç»™ç›‘æ§çš„masteræŒ‡å®šçš„ä¸€ä¸ªåç§°ï¼Œå› ä¸ºåé¢åˆ†å¸ƒå¼é›†ç¾¤æ¶æ„é‡Œä¼šè®²è§£ï¼Œå¯ä»¥é…ç½®å¤šä¸ªmasteråšæ•°æ®æ‹†åˆ†</p>
<p><strong>æ ¸å¿ƒé…ç½®</strong>ï¼š</p>
<pre><code class="language-properties">sentinel down-after-milliseconds mymaster 60000 # å“¨å…µä¸»ç®¡è®¤ä¸ºçš„å®•æœºæ—¶é—´ï¼ˆ60sï¼‰
sentinel failover-timeout mymaster 180000 # ä¸€å°æœºå™¨æ•…éšœè½¬ç§»è¶…æ—¶æ—¶é—´ï¼ˆ180sï¼‰
sentinel parallel-syncs mymaster 1 # æ•…éšœè½¬ç§»æ¯æ¬¡è½¬ç§»å‡ å°æœºå™¨
</code></pre>
<p>ä¸Šé¢çš„ä¸‰ä¸ªé…ç½®ï¼Œéƒ½æ˜¯é’ˆå¯¹æŸä¸ªç›‘æ§çš„masteré…ç½®çš„ï¼Œç»™å…¶æŒ‡å®šä¸Šé¢åˆ†é…çš„åç§°å³å¯</p>
<p>ä¸Šé¢è¿™æ®µé…ç½®ï¼Œå°±ç›‘æ§äº†ä¸¤ä¸ªmaster node</p>
<p>è¿™æ˜¯æœ€å°çš„å“¨å…µé…ç½®ï¼Œå¦‚æœå‘ç”Ÿäº†master-slaveæ•…éšœè½¬ç§»ï¼Œæˆ–è€…æ–°çš„å“¨å…µè¿›ç¨‹åŠ å…¥å“¨å…µé›†ç¾¤ï¼Œé‚£ä¹ˆå“¨å…µä¼šè‡ªåŠ¨æ›´æ–°è‡ªå·±çš„é…ç½®æ–‡ä»¶</p>
<pre><code class="language-properties">sentinel monitor master-group-name hostname port quorum
</code></pre>
<p><strong>quorumçš„è§£é‡Šå¦‚ä¸‹</strong>ï¼š</p>
<ol>
<li>è‡³å°‘å¤šå°‘ä¸ªå“¨å…µè¦ä¸€è‡´åŒæ„ï¼Œmasterè¿›ç¨‹æŒ‚æ‰äº†ï¼Œæˆ–è€…slaveè¿›ç¨‹æŒ‚æ‰äº†ï¼Œæˆ–è€…è¦å¯åŠ¨ä¸€ä¸ªæ•…éšœè½¬ç§»æ“ä½œ</li>
<li>quorumæ˜¯ç”¨æ¥è¯†åˆ«æ•…éšœçš„ï¼ŒçœŸæ­£æ‰§è¡Œæ•…éšœè½¬ç§»çš„æ—¶å€™ï¼Œè¿˜æ˜¯è¦åœ¨å“¨å…µé›†ç¾¤æ‰§è¡Œé€‰ä¸¾ï¼Œé€‰ä¸¾ä¸€ä¸ªå“¨å…µè¿›ç¨‹å‡ºæ¥æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œ</li>
<li>å‡è®¾æœ‰5ä¸ªå“¨å…µï¼Œquorumè®¾ç½®äº†2ï¼Œé‚£ä¹ˆå¦‚æœ5ä¸ªå“¨å…µä¸­çš„2ä¸ªéƒ½è®¤ä¸ºmasteræŒ‚æ‰äº†; 2ä¸ªå“¨å…µä¸­çš„ä¸€ä¸ªå°±ä¼šåšä¸€ä¸ªé€‰ä¸¾ï¼Œé€‰ä¸¾ä¸€ä¸ªå“¨å…µå‡ºæ¥ï¼Œæ‰§è¡Œæ•…éšœè½¬ç§»; å¦‚æœ5ä¸ªå“¨å…µä¸­æœ‰3ä¸ªå“¨å…µéƒ½æ˜¯è¿è¡Œçš„ï¼Œé‚£ä¹ˆæ•…éšœè½¬ç§»å°±ä¼šè¢«å…è®¸æ‰§è¡Œ</li>
</ol>
<p><strong>down-after-milliseconds</strong></p>
<ul>
<li>è¶…è¿‡å¤šå°‘æ¯«ç§’è·Ÿä¸€ä¸ªrediså®ä¾‹æ–­äº†è¿æ¥ï¼Œå“¨å…µå°±å¯èƒ½è®¤ä¸ºè¿™ä¸ªrediså®ä¾‹æŒ‚äº†</li>
</ul>
<p><strong>parallel-syncs</strong></p>
<ul>
<li>
<p>æ–°çš„masteråˆ«åˆ‡æ¢ä¹‹åï¼ŒåŒæ—¶æœ‰å¤šå°‘ä¸ªslaveè¢«åˆ‡æ¢åˆ°å»è¿æ¥æ–°masterï¼Œé‡æ–°åšåŒæ­¥ï¼Œæ•°å­—è¶Šä½ï¼ŒèŠ±è´¹çš„æ—¶é—´è¶Šå¤š</p>
</li>
<li>
<p>å‡è®¾ä½ çš„redisæ˜¯1ä¸ªmasterï¼Œ4ä¸ªslave</p>
</li>
<li>
<p>ç„¶åmasterå®•æœºäº†ï¼Œ4ä¸ªslaveä¸­æœ‰1ä¸ªåˆ‡æ¢æˆäº†masterï¼Œå‰©ä¸‹3ä¸ªslaveå°±è¦æŒ‚åˆ°æ–°çš„masterä¸Šé¢å»</p>
</li>
<li>
<p>è¿™ä¸ªæ—¶å€™ï¼Œå¦‚æœparallel-syncsæ˜¯1ï¼Œé‚£ä¹ˆ3ä¸ªslaveï¼Œä¸€ä¸ªä¸€ä¸ªåœ°æŒ‚æ¥åˆ°æ–°çš„masterä¸Šé¢å»ï¼Œ1ä¸ªæŒ‚æ¥å®Œï¼Œè€Œä¸”ä»æ–°çš„master syncå®Œæ•°æ®ä¹‹åï¼Œå†æŒ‚æ¥ä¸‹ä¸€ä¸ª</p>
</li>
<li>
<p>å¦‚æœparallel-syncsæ˜¯3ï¼Œé‚£ä¹ˆä¸€æ¬¡æ€§å°±ä¼šæŠŠæ‰€æœ‰slaveæŒ‚æ¥åˆ°æ–°çš„masterä¸Šå»</p>
</li>
</ul>
<p><strong>failover-timeout</strong></p>
<ul>
<li>æ‰§è¡Œæ•…éšœè½¬ç§»çš„timeoutè¶…æ—¶æ—¶é•¿</li>
</ul>
<p><strong>é…ç½®sentinal</strong></p>
<pre><code class="language-shell">mkdir /etc/sentinal
mkdir -p /var/sentinal/5000
mkdir -p /var/log/sentinal/5000
cp /var/sentinal/5000/26379.log  /var/log/sentinal/5000/5000.log
cp /usr/local/redis/redis-3.2.8/sentinel.conf /etc/sentinal/5000.conf
vi /etc/sentinal/5000.conf
</code></pre>
<p><strong>è¯¦ç»†é…ç½®</strong></p>
<pre><code class="language-properties">port 5000
bind 0.0.0.0
dir /var/sentinal/5000
sentinel monitor mymaster 192.168.31.187 6379 2
sentinel down-after-milliseconds mymaster 30000
sentinel failover-timeout mymaster 60000
sentinel parallel-syncs mymaster 1
daemonize yes  # é…ç½®æˆåå°è¿›ç¨‹
logfile /var/log/sentinal/5000/5000.log
sentinel auth-pass mymaster redis-pass # é…ç½®ä¸»èŠ‚ç‚¹çš„å¯†ç 
</code></pre>
<p><strong>å¯åŠ¨å“¨å…µ</strong></p>
<pre><code class="language-shell">redis-sentinel /etc/sentinal/5000.conf
</code></pre>
<p><strong>è¿æ¥å“¨å…µæŸ¥çœ‹çŠ¶æ€</strong></p>
<pre><code class="language-shell">redis-cli -h 127.0.0.1 -p 5000 
info sentinel # å±•ç¤ºåŸºæœ¬ä¿¡æ¯
</code></pre>
<p>æ—¥å¿—é‡Œä¼šæ˜¾ç¤ºå‡ºæ¥ï¼Œæ¯ä¸ªå“¨å…µéƒ½èƒ½å»ç›‘æ§åˆ°å¯¹åº”çš„redis masterï¼Œå¹¶èƒ½å¤Ÿè‡ªåŠ¨å‘ç°å¯¹åº”çš„slave</p>
<p>å“¨å…µä¹‹é—´ï¼Œäº’ç›¸ä¼šè‡ªåŠ¨è¿›è¡Œå‘ç°ï¼Œç”¨çš„å°±æ˜¯ä¹‹å‰è¯´çš„pub/subï¼Œæ¶ˆæ¯å‘å¸ƒå’Œè®¢é˜…channelæ¶ˆæ¯ç³»ç»Ÿå’Œæœºåˆ¶</p>
<h3 id="3-å¸¸ç”¨å‘½ä»¤">3. å¸¸ç”¨å‘½ä»¤</h3>
<p><strong>å¢åŠ sentinalï¼Œä¼šè‡ªåŠ¨å‘ç°</strong></p>
<p><strong>åˆ é™¤sentinalçš„æ­¥éª¤</strong></p>
<ul>
<li>åœæ­¢sentinalè¿›ç¨‹</li>
</ul>
<pre><code class="language-shell">SENTINEL RESET * # åœ¨æ‰€æœ‰sentinalä¸Šæ‰§è¡Œï¼Œæ¸…ç†æ‰€æœ‰çš„masterçŠ¶æ€
</code></pre>
<p><strong>slaveçš„æ°¸ä¹…ä¸‹çº¿</strong></p>
<pre><code class="language-shell"> SENTINEL RESET mymaster # è®©masteræ‘˜é™¤æŸä¸ªå·²ç»ä¸‹çº¿çš„slave
</code></pre>
<h2 id="å››-redis-clusteré›†ç¾¤é…ç½®">å››ã€Redis-clusteré›†ç¾¤é…ç½®</h2>
<h3 id="1-redis-clusterçš„é‡è¦é…ç½®">1. redis clusterçš„é‡è¦é…ç½®</h3>
<ul>
<li>
<p><strong>cluster-enabled &lt;yes/no&gt;</strong>ï¼šå¼€å¯é›†ç¾¤</p>
</li>
<li>
<p><strong>cluster-config-file &lt;filename&gt;</strong>ï¼šè¿™æ˜¯æŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œä¾›clusteræ¨¡å¼ä¸‹çš„rediså®ä¾‹å°†é›†ç¾¤çŠ¶æ€ä¿å­˜åœ¨é‚£é‡Œï¼ŒåŒ…æ‹¬é›†ç¾¤ä¸­å…¶ä»–æœºå™¨çš„ä¿¡æ¯ï¼Œæ¯”å¦‚èŠ‚ç‚¹çš„ä¸Šçº¿å’Œä¸‹é™ï¼Œæ•…éšœè½¬ç§»ï¼Œä¸æ˜¯æˆ‘ä»¬å»ç»´æŠ¤çš„ï¼Œç»™å®ƒæŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè®©redisè‡ªå·±å»ç»´æŠ¤çš„</p>
</li>
<li>
<p><strong>cluster-node-timeout &lt;milliseconds&gt;</strong>ï¼šèŠ‚ç‚¹å­˜æ´»è¶…æ—¶æ—¶é•¿ï¼Œè¶…è¿‡ä¸€å®šæ—¶é•¿ï¼Œè®¤ä¸ºèŠ‚ç‚¹å®•æœºï¼Œmasterå®•æœºçš„è¯å°±ä¼šè§¦å‘ä¸»å¤‡åˆ‡æ¢ï¼Œslaveå®•æœºå°±ä¸ä¼šæä¾›æœåŠ¡</p>
</li>
</ul>
<h3 id="2-ç¼–å†™é…ç½®æ–‡ä»¶">2. ç¼–å†™é…ç½®æ–‡ä»¶</h3>
<pre><code class="language-properties">port 7001
cluster-enabled yes
cluster-config-file /etc/redis-cluster/node-7001.conf
cluster-node-timeout 15000
daemonize	yes							
pidfile		/var/run/redis_7001.pid 						
dir 		/var/redis/7001		
logfile /var/log/redis/7001.log
bind 192.168.31.187		
appendonly yes
</code></pre>
<h3 id="3-å‡†å¤‡ç¯å¢ƒ">3. å‡†å¤‡ç¯å¢ƒ</h3>
<p>å‡†å¤‡å¯åŠ¨è„šæœ¬å¹¶å¯åŠ¨</p>
<pre><code class="language-shell">mkdir -p /etc/redis-cluster
mkdir -p /var/log/redis
mkdir -p /var/redis/7001
mkdir -p /var/redis/7002
cd /etc/init.d
cp redis_6379 7001_redis
cp redis_6379 7002_redis
vi 7001_redis
vi 7002_redis

./7002_redis start
./7002_redis start
</code></pre>
<h3 id="4-åˆ›å»ºé›†ç¾¤">4. åˆ›å»ºé›†ç¾¤</h3>
<pre><code class="language-shell">wget https://cache.ruby-lang.org/pub/ruby/2.3/ruby-2.3.1.tar.gz
tar -zxvf ruby-2.3.1.tar.gz
./configure -prefix=/usr/local/ruby
make &amp;&amp; make install
cd /usr/local/ruby/ruby-2.3.1
cp bin/ruby /usr/local/bin
cp bin/gem /usr/local/bin

wget http://rubygems.org/downloads/redis-3.3.0.gem
gem install -l ./redis-3.3.0.gem
gem list --check redis gem

cp /usr/local/redis-3.2.8/src/redis-trib.rb /usr/local/bin

redis-trib.rb create --replicas 1 192.168.31.187:7001 192.168.31.187:7002 192.168.31.19:7003 192.168.31.19:7004 192.168.31.227:7005 192.168.31.227:7006


redis-trib.rb check 192.168.31.187:7001
</code></pre>
<h3 id="5-æ·»åŠ åˆ é™¤èŠ‚ç‚¹">5. æ·»åŠ åˆ é™¤èŠ‚ç‚¹</h3>
<p><strong>æ·»åŠ </strong></p>
<pre><code>redis-trib.rb add-node 192.168.31.227:7007 192.168.31.187:7001
redis-trib.rb reshard 192.168.31.187:7001

# è¿ç§»slotåˆ°ä¸€ä¸ªnodeçš„id

</code></pre>
<p><strong>åˆ é™¤</strong></p>
<pre><code>å…ˆç”¨reshardingå°†æ•°æ®éƒ½ç§»é™¤åˆ°å…¶ä»–èŠ‚ç‚¹ï¼Œç¡®ä¿nodeä¸ºç©ºä¹‹åï¼Œæ‰èƒ½æ‰§è¡Œremoveæ“ä½œ

redis-trib.rb del-node 192.168.31.187:7001 bd5a40a6ddccbd46a0f4a2208eb25d2453c2a8db
</code></pre>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E5%AE%B9%E7%81%BE%E7%AD%96%E7%95%A5">ä¸€ã€å®¹ç¾ç­–ç•¥</a>
<ul>
<li><a href="#1-%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AErdb%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6">1. å¦‚ä½•é…ç½®RDBæŒä¹…åŒ–æœºåˆ¶</a></li>
<li><a href="#2-rdb%E6%8C%81%E4%B9%85%E5%8C%96%E6%9C%BA%E5%88%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E6%B5%81%E7%A8%8B">2. RDBæŒä¹…åŒ–æœºåˆ¶çš„å·¥ä½œæµç¨‹</a></li>
<li><a href="#3-aof%E6%8C%81%E4%B9%85%E5%8C%96%E7%9A%84%E9%85%8D%E7%BD%AE">3. AOFæŒä¹…åŒ–çš„é…ç½®</a></li>
<li><a href="#4-aof-rewrite">4. AOF rewrite</a></li>
<li><a href="#5-aof%E7%A0%B4%E6%8D%9F%E6%96%87%E4%BB%B6%E7%9A%84%E4%BF%AE%E5%A4%8D">5. AOFç ´æŸæ–‡ä»¶çš„ä¿®å¤</a></li>
<li><a href="#6-aof%E5%92%8Crdb%E5%90%8C%E6%97%B6%E5%B7%A5%E4%BD%9C">6. AOFå’ŒRDBåŒæ—¶å·¥ä½œ</a></li>
<li><a href="#7-%E4%BC%81%E4%B8%9A%E7%BA%A7%E7%9A%84%E5%A4%87%E4%BB%BD%E7%AD%96%E7%95%A5">7. ä¼ä¸šçº§çš„å¤‡ä»½ç­–ç•¥</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB">äºŒã€è¯»å†™åˆ†ç¦»</a>
<ul>
<li><a href="#1-redis-replication%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E8%BF%87%E7%A8%8B">1. redis replicationä¸»ä»å¤åˆ¶è¿‡ç¨‹</a></li>
<li><a href="#2-%E4%B8%BB%E4%BB%8E%E6%90%AD%E5%BB%BA">2. ä¸»ä»æ­å»º</a>
<ul>
<li><a href="#%E4%BB%8E%E8%8A%82%E7%82%B9">ä»èŠ‚ç‚¹</a></li>
<li><a href="#%E4%B8%BB%E8%8A%82%E7%82%B9">ä¸»èŠ‚ç‚¹</a></li>
<li><a href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%9E%B6%E6%9E%84%E7%9A%84%E6%B5%8B%E8%AF%95">è¯»å†™åˆ†ç¦»æ¶æ„çš„æµ‹è¯•</a></li>
</ul>
</li>
<li><a href="#3-%E5%BF%AB%E9%80%9F%E5%8E%8B%E6%B5%8B">3. å¿«é€Ÿå‹æµ‹</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%93%A8%E5%85%B5%E9%85%8D%E7%BD%AE">ä¸‰ã€å“¨å…µé…ç½®</a>
<ul>
<li><a href="#1-%E8%A7%A3%E5%86%B3%E5%BC%82%E6%AD%A5%E5%A4%8D%E5%88%B6%E5%92%8C%E8%84%91%E8%A3%82%E5%AF%BC%E8%87%B4%E7%9A%84%E6%95%B0%E6%8D%AE%E4%B8%A2%E5%A4%B1">1. è§£å†³å¼‚æ­¥å¤åˆ¶å’Œè„‘è£‚å¯¼è‡´çš„æ•°æ®ä¸¢å¤±</a></li>
<li><a href="#2-%E9%85%8D%E7%BD%AE%E7%BB%8F%E5%85%B8%E4%B8%89%E8%8A%82%E7%82%B9%E5%93%A8%E5%85%B5">2. é…ç½®ç»å…¸ä¸‰èŠ‚ç‚¹å“¨å…µ</a></li>
<li><a href="#3-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4">3. å¸¸ç”¨å‘½ä»¤</a></li>
</ul>
</li>
<li><a href="#%E5%9B%9B-redis-cluster%E9%9B%86%E7%BE%A4%E9%85%8D%E7%BD%AE">å››ã€Redis-clusteré›†ç¾¤é…ç½®</a>
<ul>
<li><a href="#1-redis-cluster%E7%9A%84%E9%87%8D%E8%A6%81%E9%85%8D%E7%BD%AE">1. redis clusterçš„é‡è¦é…ç½®</a></li>
<li><a href="#2-%E7%BC%96%E5%86%99%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">2. ç¼–å†™é…ç½®æ–‡ä»¶</a></li>
<li><a href="#3-%E5%87%86%E5%A4%87%E7%8E%AF%E5%A2%83">3. å‡†å¤‡ç¯å¢ƒ</a></li>
<li><a href="#4-%E5%88%9B%E5%BB%BA%E9%9B%86%E7%BE%A4">4. åˆ›å»ºé›†ç¾¤</a></li>
<li><a href="#5-%E6%B7%BB%E5%8A%A0%E5%88%A0%E9%99%A4%E8%8A%82%E7%82%B9">5. æ·»åŠ åˆ é™¤èŠ‚ç‚¹</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">

	  
		<div id="gitalk-container"></div>
		<!--è¯„è®ºæ˜¾ç¤ºåŒºï¼Œè¯·æ’å…¥åˆé€‚çš„ä½ç½®-->
<div id="comment"></div>
<!--Leancloud æ“ä½œåº“:-->
<script src="//cdn1.lncld.net/static/js/3.6.1/av-min.js"></script>
<!--Valine çš„æ ¸å¿ƒä»£ç åº“-->
<script src="//cdn.jsdelivr.net/npm/valine@1.4.4/dist/Valine.min.js"></script>
<script>
    new Valine({
        el:'#comment',
        appId: 'DysN4QrSvmmE6SpDXopbCLD6-gzGzoHsz',
        appKey: 'mjK643yLFa4WWXtobofr24Ap',
        placeholder: 'ãƒ¾ï¾‰â‰§âˆ€â‰¦)oå¿«æ¥è¯„è®ºä¸€ä¸‹å§!',
        avatar:''
    });
</script>
	  
		  
	  

</div></section>
</div></div></div>
<!--
<script>
"use strict";!function(){for(var n=document.getElementsByTagName("pre"),e=n.length,s=0;s<e;s++){n[s].innerHTML='<span class="line-number"></span>'+n[s].innerHTML+'<span class="cl"></span>';for(var a=n[s].innerHTML.split(/\n/).length,r=0;r<a-1;r++){n[s].getElementsByTagName("span")[0].innerHTML+="<span>"+(r+1)+"</span>"}}}();
let mainNavLinks=document.querySelectorAll(".markdownIt-TOC a");window.addEventListener("scroll",event=>{let fromTop=window.scrollY;mainNavLinks.forEach((link,index)=>{let section=document.getElementById(decodeURI(link.hash).substring(1));let nextSection=null
if(mainNavLinks[index+1]){nextSection=document.getElementById(decodeURI(mainNavLinks[index+1].hash).substring(1));}
if(section.offsetTop<=fromTop){if(nextSection){if(nextSection.offsetTop>fromTop){link.classList.add("currentToc");}else{link.classList.remove("currentToc");}}else{link.classList.add("currentToc");}}else{link.classList.remove("currentToc");}});});
var list=document.querySelectorAll(".katex");for(var i=0;i<list.length;i++){list[i].style.display="unset"};
var h=document.documentElement,b=document.body,st="scrollTop",sh="scrollHeight",progress=document.querySelector(".progress"),scroll;document.addEventListener("scroll",function(){scroll=(h[st]||b[st])/((h[sh]||b[sh])-h.clientHeight)*100;progress.style.setProperty("--scroll",scroll+"%")});
var wxScale=new WxScale({fullPage:document.querySelector("#fullPage"),canvas:document.querySelector("#canvas")});var imgBox=document.querySelectorAll("#md_block img");for(var i=0;i<imgBox.length;i++){imgBox[i].onclick=function(e){wxScale.start(this)}};
content="æœ¬æ–‡æœ€åæ›´æ–°äº2020-07-27ï¼Œå·²è¶…è¿‡ 1 å¹´æ²¡æœ‰æ›´æ–°ï¼Œæ¶‰åŠçš„å†…å®¹å¯èƒ½å·²ç»å¤±æ•ˆï¼";var date1="2020-07-27 18:43:03";date1=date1.replace("-","/");var date2=new Date();var date3=date2.getTime()-new Date(date1).getTime();var days=Math.floor(date3/(24*3600*1000));if(days>=365){document.getElementById("warn").innerHTML=content};
</script>
-->

<script>
    "use strict";
    ! function () {
        for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
            n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
            for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
                n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
            }
        }
    }();
    let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
    window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;
        mainNavLinks.forEach((link, index) => {
            let section = document.getElementById(decodeURI(link.hash).substring(1));
            let nextSection = null
            if (mainNavLinks[index + 1]) {
                nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
                    1));
            }
            if (section.offsetTop <= fromTop) {
                if (nextSection) {
                    if (nextSection.offsetTop > fromTop) {
                        link.classList.add("currentToc");
                    } else {
                        link.classList.remove("currentToc");
                    }
                } else {
                    link.classList.add("currentToc");
                }
            } else {
                link.classList.remove("currentToc");
            }
        });
    });
    var list = document.querySelectorAll(".katex");
    for (var i = 0; i < list.length; i++) {
        list[i].style.display = "unset"
    };
    var h = document.documentElement,
        b = document.body,
        st = "scrollTop",
        sh = "scrollHeight",
        progress = document.querySelector(".progress"),
        scroll;
    document.addEventListener("scroll", function () {
        scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
        progress.style.setProperty("--scroll", scroll + "%")
    });
    var wxScale = new WxScale({
        fullPage: document.querySelector("#fullPage"),
        canvas: document.querySelector("#canvas")
    });
    var imgBox = document.querySelectorAll("#md_block img");
    for (var i = 0; i < imgBox.length; i++) {
        imgBox[i].onclick = function (e) {
            wxScale.start(this)
        }
    };
    content = "æœ¬æ–‡æœ€åæ›´æ–°äº2020-07-27ï¼Œå·²è¶…è¿‡ 1 å¹´æ²¡æœ‰æ›´æ–°ï¼Œæ¶‰åŠçš„å†…å®¹å¯èƒ½å·²ç»å¤±æ•ˆï¼";
    var date1 = "2020-07-27 18:43:03";
    date1 = date1.replace("-", "/");
    var date2 = new Date();
    var date3 = date2.getTime() - new Date(date1).getTime();
    var days = Math.floor(date3 / (24 * 3600 * 1000));
    if (days >= 365) {
        document.getElementById("warn").innerHTML = content
    };
</script>

<style>#magnifyImg{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#magnifyImg img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Copyright Â© 2018-2020 <a href="https://xzzz2020.github.io" style="margin:0;">xzzz2020</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_pv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>58</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://xzzz2020.github.io/media/js/prism.js"></script>
</body>
</html>