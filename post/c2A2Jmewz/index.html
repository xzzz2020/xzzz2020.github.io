<!DOCTYPE html>
<html>
<head>
<link rel="shortcut icon" href="https://xzzz2020.github.io/favicon.ico" type="image/x-icon" /><meta name="viewport"content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/><meta name="apple-mobile-web-app-capable"content="yes"/><meta name="apple-mobile-web-app-status-bar-style"content="black"/><meta name="format-detection"content="telephone=no"/><meta name="renderer"content="webkit"><meta name="description"content="æ¸©æ•…è€ŒçŸ¥æ–°"><meta charset="UTF-8"><title>ã€æ€»ç»“ã€‘è‡ªå®šä¹‰SpringAOP | xzzz2020</title>
<link href="https://xzzz2020.github.io/styles/main.css" type="text/css" rel="stylesheet" /><link href="https://at.alicdn.com/t/font_1621793_zatzzgvf30g.css" type="text/css" rel="stylesheet" /><link rel="stylesheet" href="https://xzzz2020.github.io/media/css/katex.css"><script async src="https://cdn.jsdelivr.net/npm/busuanzi@2.3.0/bsz.pure.mini.min.js"></script><script src="https://xzzz2020.github.io/media/js/magnify.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js"></script><script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
<script type="text/javascript">function btn_toggle(){document.getElementById("hn").classList.contains("no-js")?document.getElementById("hn").classList.remove("no-js"):document.getElementById("hn").classList.add("no-js")}</script>

<link rel="canonical" href="https://xzzz2020.github.io/post/c2A2Jmewz/" />
</head>
<body>
<div class="progress"></div><style>.progress{background:linear-gradient(to right,#87ceeb var(--scroll),transparent 0);background-repeat:no-repeat;position:fixed;width:100%;height:4px;z-index:1}</style><div class="darkmode-background"></div><div class="darkmode-layer"></div>
<noscript><p class="warn" >æœ¬é¡µé¢éœ€è¦æµè§ˆå™¨æ”¯æŒï¼ˆå¯ç”¨ï¼‰JavaScript</p></noscript><div class="header"><div class="logo_title"><div class="title animated fadeInDown"><a href="https://xzzz2020.github.io"><img alt="logo" style="display:inline-block;" src="https://xzzz2020.github.io/images/avatar.png"/></a><h1 title="xzzz2020" class="weaklink"><a  href="/">xzzz2020</a></h1>

<div class="navbar weaklink">
<div class="normal_nav">
<div class="bitcron_nav_container"><div class="bitcron_nav"><div class="bitcron_nav"><div style="display:flex;justify-content:center;"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul></nav>
<div style="float:right;margin-top:1em"><form id="gridea-search-form" data-update="1578893743252" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q" placeholder="Search..."></form></div><div style="margin-left:0.5em;margin-top:1.2em"><input id="switch_default" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
<div class="clear clear_nav_inline_end"></div></div></div><div class="clear clear_nav_end"></div></div></div><div class="hamberger" href="javascript:void(0)" onclick="btn_toggle();"><i class="iconfont icon-category"></i></div></div></div></div>
<div id="hn" class="no-js hidden_nav animated fadeInDown"><div class="bitcron_nav_container"><div class="bitcron_nav"><nav class="mixed_site_nav_wrap site_nav_wrap"><ul class="mixed_site_nav site_nav sm sm-base">	<li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/" class="selected active current nav__item" >é¦–é¡µ</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/archives" class="selected active current nav__item" >å½’æ¡£</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/tags" class="selected active current nav__item" >æ ‡ç­¾</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/about" class="selected active current nav__item" >å…³äº</a></li><li><a id="d2ef19af68cc211e98f8a0242ac110003" href="/post/Friendship_chain" class="selected active current nav__item" >å‹é“¾</a></li></ul><div class="clear clear_nav_inline_end"></div></nav></div><div class="clear clear_nav_end"></div></div>
<div style="display:flex;justify-content:center;inline-block;text-align:center;margin-top:7%"><div><form id="gridea-search-form" data-update="1605234722742" action="/search/index.html"><input class="search-input" autocomplete="off" spellcheck="false" name="q"  placeholder="Search..." /></form></div><div style="margin-left:0.5em"><input id="switch_default_h" onclick="mobileBtn()" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div>
</div></div>
<script>function enableDarkmode(){document.body.classList.add("darkmode"),document.getElementById("switch_default").checked=1,document.getElementById("switch_default_h").checked=1}function removeDarkmode(){document.body.classList.remove("darkmode"),document.getElementById("switch_default").checked=0,document.getElementById("switch_default_h").checked=0}function getCookie(a){var b,c=new RegExp("(^| )"+a+"=([^;]*)(;|$)");return(b=document.cookie.match(c))?unescape(b[2]):null}cookie=getCookie("darkmode"),"enable"==cookie&&enableDarkmode(),window.matchMedia("(prefers-color-scheme: dark)").matches&&"disable"!==cookie&&(enableDarkmode(),document.cookie="darkmode=enable; path=/");var mobileBtn=function(){1==document.getElementById("switch_default").checked?(enableDarkmode(),document.cookie="darkmode=enable; path=/"):(removeDarkmode(),document.cookie="darkmode=disable; path=/")};</script>

<div class="main"><div class="main-inner"><div class="content">
<article class="post">
<h2 class="post_title sm_margin"><a>ã€æ€»ç»“ã€‘è‡ªå®šä¹‰SpringAOP</a></h2>
<script>function lan(){if(document.getElementById("lan").innerText=="ç¹"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_tw.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç®€"}else{if(document.getElementById("lan").innerText=="ç°¡"){var s=document.getElementById("tongwenlet_cn");if(s!=null){document.body.removeChild(s)}var s=document.createElement("script");s.language="javascript";s.type="text/javascript";s.src="https://cdn.jsdelivr.net/gh/qyxtim/Static@1.1/bookmarklet_cn.js";s.id="tongwenlet_cn";document.body.appendChild(s);document.getElementById("lan").innerHTML="ç¹"}}};</script>
<section class="post_details"><i class="iconfont icon-calendar"></i><span style="margin-right:15px"> 2020-09-10</span><i class="iconfont icon-browse"></i><span style="margin-right:15px" id="busuanzi_container_page_pv"> <span id="busuanzi_value_page_pv"></span> Views</span><i class="iconfont icon-category"></i><span class="weaklink" style="margin-right:15px">	<a href="https://xzzz2020.github.io/tag/spring/" class="tag">Spring</a></span><i class="iconfont icon-caret-down"></i><span style="margin-right:15px">4291å­—</span><i class="iconfont icon-naozhong"></i><span style="margin-right:15px">19 min read</span><a id="lan" href="javascript:void(0);"onclick="lan();"title="è°ƒæ•´ç®€ç¹ä½“" style="margin-right:15px;">ç¹</a>
</section>

<img class="featureImg" alt="featureimg" src="https://img-1302474103.cos.ap-nanjing.myqcloud.com/img/photo-1599713201276-6733c471d85a.webp" referrerpolicy="no-referrer">

<div style="display:flex">
<div class="md_block" id="md_block">
<div class="round-shape-one"></div>
<p><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E7%AE%80%E4%BB%8B">ä¸€ã€ç®€ä»‹</a>
<ul>
<li><a href="#1-aop%E7%9A%84%E5%BC%95%E5%87%BA">1. AOPçš„å¼•å‡º</a></li>
<li><a href="#2-%E8%87%AA%E7%A0%94aop%E6%8F%90%E4%BE%9B%E7%9A%84%E5%8A%9F%E8%83%BD">2. è‡ªç ”AOPæä¾›çš„åŠŸèƒ½</a></li>
<li><a href="#3-aop%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">3. AOPçš„æ ¸å¿ƒæ¦‚å¿µï¼š</a></li>
<li><a href="#4-advice%E7%9A%84%E7%A7%8D%E7%B1%BB">4. Adviceçš„ç§ç±»ï¼š</a></li>
<li><a href="#5-%E5%88%87%E9%9D%A2%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">5. åˆ‡é¢æ‰§è¡Œé¡ºåº</a></li>
<li><a href="#6-introduction-%E5%BC%95%E5%85%A5%E5%9E%8Badvice">6. Introduction--å¼•å…¥å‹Advice</a></li>
<li><a href="#7-jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">7. JDKåŠ¨æ€ä»£ç†</a></li>
<li><a href="#8-cglib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">8. CGLIbåŠ¨æ€ä»£ç†</a></li>
<li><a href="#9-springaop%E7%9A%84%E5%BA%95%E5%B1%82%E6%9C%BA%E5%88%B6">9. SpringAOPçš„åº•å±‚æœºåˆ¶</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%88%A9%E7%94%A8cglib%E5%AE%9E%E7%8E%B0aop%E9%80%BB%E8%BE%91">äºŒã€åˆ©ç”¨CGLibå®ç°AOPé€»è¾‘</a>
<ul>
<li><a href="#1-%E5%AE%8C%E6%88%90%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%88%9B%E5%BB%BA">1. å®Œæˆæ³¨è§£çš„åˆ›å»º</a></li>
<li><a href="#2-%E5%88%87%E9%9D%A2%E6%A8%A1%E6%9D%BF%E7%B1%BB">2. åˆ‡é¢æ¨¡æ¿ç±»</a></li>
<li><a href="#3-%E8%A2%AB%E4%BB%A3%E7%90%86%E7%B1%BB%E7%9A%84%E7%BB%87%E5%85%A5%E5%AE%9E%E7%8E%B0">3. è¢«ä»£ç†ç±»çš„ç»‡å…¥å®ç°</a></li>
<li><a href="#4-%E6%89%A7%E8%A1%8C%E5%AE%B9%E5%99%A8%E7%9A%84aop%E6%93%8D%E4%BD%9C">4. æ‰§è¡Œå®¹å™¨çš„AOPæ“ä½œ</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%BC%95%E5%85%A5aspectj%E6%A1%86%E6%9E%B6">ä¸‰ã€å¼•å…¥AspectJæ¡†æ¶</a>
<ul>
<li><a href="#1-aspectj%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B">1. AspectJæ¡†æ¶ç®€ä»‹</a></li>
<li><a href="#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">2. ç¯å¢ƒé…ç½®</a></li>
<li><a href="#3-%E8%A7%A3%E6%9E%90aspect%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%B9%B6%E5%AE%9A%E4%BD%8D%E8%A2%AB%E7%BB%87%E5%85%A5%E7%9B%AE%E6%A0%87">3. è§£æAspectè¡¨è¾¾å¼å¹¶å®šä½è¢«ç»‡å…¥ç›®æ ‡</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</p>
<h2 id="ä¸€-ç®€ä»‹">ä¸€ã€ç®€ä»‹</h2>
<h3 id="1-aopçš„å¼•å‡º">1. AOPçš„å¼•å‡º</h3>
<p><strong>åœ¨å¼€å‘ä¸­é™¤äº†æœ‰ä¸šåŠ¡éœ€æ±‚ï¼Œä¹Ÿä¼šå­˜åœ¨ç³»ç»Ÿéœ€æ±‚ï¼š</strong></p>
<ul>
<li><strong>æ·»åŠ æ—¥å¿—ä¿¡æ¯</strong>ï¼šä¸ºæ¯ä¸ªæ–¹æ³•æ·»åŠ ç»Ÿè®¡ç»Ÿè®¡</li>
<li>**æ·»åŠ ç³»ç»Ÿæƒé™æ ¡éªŒï¼š**é’ˆå¯¹æŸäº›æ–¹æ³•è¿›è¡Œé™åˆ¶</li>
<li><strong>äº‹åŠ¡æ§åˆ¶</strong>ï¼šé’ˆå¯¹æŒä¹…åŒ–çš„æ•°æ®ï¼Œè¿›è¡Œäº‹åŠ¡çš„ç²¾ç»†æ§åˆ¶</li>
</ul>
<p><strong>é¢å‘å¯¹è±¡ç¼–ç¨‹éœ€è¦åœ¨æ¯ä¸ªæ–¹æ³•åŠ å…¥é€šç”¨çš„ä»£ç ï¼Œä»£ç æ²¡æœ‰è¢«å¤ç”¨ï¼ŒåŒæ—¶å¢åŠ ç»´æŠ¤æˆæœ¬</strong></p>
<p>è½¯ä»¶å·¥ç¨‹é‡Œé¢æœ‰ä¸€ä¸ªæ¦‚å¿µå«åšå…³æ³¨ç‚¹åˆ†ç¦»ï¼Œå³ä¸åŒçš„é—®é¢˜äº¤ç»™ä¸åŒçš„éƒ¨åˆ†å»è§£å†³ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼ˆAOPï¼‰å°±æ˜¯ä¸€ç§å…³æ³¨ç‚¹åˆ†ç¦»çš„æŠ€æœ¯ã€‚</p>
<p>å°†ä¸šåŠ¡åŠŸèƒ½ä»£ç å’Œç³»ç»Ÿå±‚é¢ä»£ç åˆ†ç¦»ï¼Œç³»ç»Ÿé€šç”¨åŒ–åŠŸèƒ½çš„ä»£ç å®ç°å°±æ˜¯åˆ‡é¢Aspectã€‚Aspectä¹‹äºAOPï¼Œç›¸å½“äºclassä¹‹äºOOPï¼ŒBeanä¹‹äºIOCã€‚</p>
<h3 id="2-è‡ªç ”aopæä¾›çš„åŠŸèƒ½">2. è‡ªç ”AOPæä¾›çš„åŠŸèƒ½</h3>
<ul>
<li>
<p>åˆ©ç”¨CGLIBå®ç°å¯¹ç›®æ ‡ç±»æ–¹æ³•çš„å¢å¼º</p>
<ul>
<li>å®šä¹‰MethodInterceptorå®ç°ç±»ï¼Œå®Œæˆå¯¹æ–¹æ³•çš„å¢å¼ºï¼ŒmethodProxyçš„invokeSuperæ–¹æ³•å¤æ‚æ‰§è¡ŒåŸå®šçš„æ–¹æ³•é€»è¾‘ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå‰åä»¥åŠå‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œå¯ä»¥ç»‡å…¥ç›¸å…³é€»è¾‘ã€‚åŒæ—¶å®šä¹‰äº†@Orderæ³¨è§£ï¼Œå¯¹åˆ‡é¢æŒ‰ç…§æŒ‡å®šçš„é¡ºåºæ‰§è¡Œã€‚</li>
<li>åˆ©ç”¨Enhancerçš„createæ–¹æ³•ï¼Œä¼ å…¥ç›®æ ‡ç±»å’Œå¯¹æ–¹æ³•å¢å¼ºçš„ç»‡å…¥é€»è¾‘ï¼ŒåŠ¨æ€äº§ç”Ÿä¸€ä¸ªå¢å¼ºåçš„ç±»ï¼Œæ›¿æ¢æ‰åŸæ¥çš„ç±»</li>
</ul>
</li>
<li>
<p>å¼•å…¥AspectJçš„è¡¨è¾¾å¼è§£æèƒ½åŠ›ï¼Œæ›´åŠ çµæ´»çš„å®šä¹‰åˆ‡ç‚¹</p>
<ul>
<li><strong>PointcutParser</strong>ï¼šæä¾›å¯¹è¡¨è¾¾å¼è¯­æ³•çš„æ”¯æŒï¼Œåˆ©ç”¨parsePointcutExpressionæ–¹æ³•ï¼Œè§£æè¡¨è¾¾å¼ï¼Œå°†è¿”å›ä¸€ä¸ªPointcutExpressionæ¥å£çš„å®ç°ç±»</li>
<li><strong>PointcutExpressionæ¥å£</strong>ï¼šç”¨äºéªŒè¯ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¬¦åˆè¡¨è¾¾å¼è§„åˆ™ï¼ŒcouldMatchJoinPointsInTypeæ–¹æ³•æä¾›ç±»çš„ç²—æ£€æŸ¥ï¼Œåªèƒ½æ ¡éªŒwithinçš„è¡¨è¾¾å¼ï¼Œå…¶ä»–çš„éƒ½ä¼šè¡¨è¾¾trueï¼›matchesMethodExecutionæ–¹æ³•æä¾›å¯¹æ–¹æ³•çš„ç²¾ç¡®æ£€æŸ¥</li>
</ul>
</li>
</ul>
<h3 id="3-aopçš„æ ¸å¿ƒæ¦‚å¿µ">3. AOPçš„æ ¸å¿ƒæ¦‚å¿µï¼š</h3>
<ul>
<li>**åˆ‡é¢Aspectï¼š**å°†æ¨ªåˆ‡å…³æ³¨ç‚¹é€»è¾‘é€»è¾‘è¿›è¡Œæ¨¡å—åŒ–å°è£…çš„å®ä½“å¯¹è±¡</li>
<li>**é€šçŸ¥Adviceï¼š**å¥½æ¯”æ˜¯Classé‡Œé¢çš„æ–¹æ³•ï¼Œè¿˜å®šä¹‰äº†ç»‡å…¥é€»è¾‘çš„æ—¶æœº</li>
<li>**è¿æ¥ç‚¹JoinPointï¼š**å…è®¸ä½¿ç”¨Adviceçš„åœ°æ–¹</li>
<li>**åˆ‡å…¥ç‚¹PointCutï¼š**å®šä¹‰ä¸€ç³»åˆ—è§„åˆ™å¯¹JoinPointè¿›è¡Œç­›é€‰</li>
<li>**ç›®æ ‡å¯¹è±¡Targetï¼š**ç¬¦åˆPointCutçš„å¯¹è±¡</li>
<li><strong>ç»‡å…¥</strong>ï¼šå°†Aspectæ¨¡å—åŒ–çš„æ¨ªåˆ‡å…³æ³¨ç‚¹é›†æˆåˆ°OOPé‡Œ</li>
<li>**ç»‡å…¥å™¨ï¼š**å®Œæˆç»‡å…¥è¿‡ç¨‹çš„æ‰§è¡Œè€…ï¼Œå¦‚ajc</li>
</ul>
<h3 id="4-adviceçš„ç§ç±»">4. Adviceçš„ç§ç±»ï¼š</h3>
<blockquote>
<p>éœ€è¦æ³¨æ„ä¸€ç‚¹@Aroundæ³¨è§£å¦‚æœä½¿ç”¨äº†try..catch..ï¼Œå°±ä¼šè®©@AfterThrowingæ³¨è§£å¤±è´¥</p>
</blockquote>
<ul>
<li>**BeforeAdviceï¼š**åœ¨JoinPointå‰è¢«æ‰§è¡Œçš„Adviceï¼Œæ— æ³•é˜»æ­¢JoinPointçš„æ‰§è¡Œï¼Œé™¤éå‘ç”Ÿäº†å¼‚å¸¸</li>
<li>**AfterAdviceï¼š**å¥½æ¯”try..catch..finallyé‡Œé¢çš„finallyæ–¹æ³•ï¼Œä¸ç®¡æ–¹æ³•æ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæœ€ç»ˆæ‰§è¡Œ</li>
<li>**AfterReturningAdviceï¼š**åœ¨JoinPointæ­£å¸¸æ‰§è¡Œåï¼Œæ‰èƒ½æ­£åœ¨æ‰§è¡Œï¼Œå¦‚æœå‡ºç°å¼‚å¸¸ï¼Œåˆ™æ— æ³•æ‰§è¡Œ</li>
<li>**AfterThrowingAdviceï¼š**åœ¨JoinPointåœ¨æ‰§è¡Œæ—¶æŠ›å‡ºæ‰ä¼šè§¦å‘</li>
<li>**AroundAdviceï¼š**å¯ä»¥åœ¨JoinPointæ‰§è¡Œå‰åè¿›è¡Œç»‡å…¥ï¼Œä¹Ÿå¯ä»¥å†³å®šJoinPointæ˜¯å¦éœ€è¦æ‰§è¡Œ</li>
</ul>
<p><strong>åˆ†æ‹†çš„åŸå› </strong>ï¼šä¸°å¯ŒAdviceçš„è¯­ä¹‰ï¼Œå¯ä»¥å•ç‹¬å°†æŸä¸ªç¯èŠ‚æ‹†å‡ºæ¥ç”¨ï¼Œå¹¶èƒ½ä¾æ®ä¸åŒåœºæ™¯ï¼Œæœ€å°åŒ–ç»‡å…¥Advice</p>
<h3 id="5-åˆ‡é¢æ‰§è¡Œé¡ºåº">5. åˆ‡é¢æ‰§è¡Œé¡ºåº</h3>
<blockquote>
<p>å¤šä¸ªAspectå¯ä»¥ä½¿ç”¨@Orderè¿›è¡Œæ’åºï¼Œæ•°å€¼è¶Šå°è¶Šå…ˆæ‰§è¡Œ</p>
</blockquote>
<ol>
<li>@Aroundï¼ŒJoinPointçš„proceedæ–¹æ³•æ‰§è¡Œå‰</li>
<li>@Beforeï¼Œåœ¨@Aroundé€‰æ‹©æ‰§è¡Œæ—¶è§¦å‘ï¼Œåœ¨æ‰§è¡Œå‰ç»‡å…¥</li>
<li>@Aroundæ–¹æ³•æ‰§è¡Œä»¥åŠæ‰§è¡Œåé€»è¾‘</li>
<li>@After</li>
<li>å¦‚æœæ­£å¸¸æ‰§è¡Œï¼Œæ˜¯@AfterReturningï¼Œå‡ºç°å¼‚å¸¸æ˜¯@AfterThrowing</li>
</ol>
<h3 id="6-introduction-å¼•å…¥å‹advice">6. Introduction--å¼•å…¥å‹Advice</h3>
<ul>
<li>ä¸ºç›®æ ‡ç±»å¼•å…¥æ–°æ¥å£ï¼Œè€Œä¸éœ€è¦ç›®æ ‡ç±»åšä»»ä½•å®ç°</li>
<li>ä½¿å¾—ç›®æ ‡ç±»åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­è½¬å‹æˆæ–°æ¥å£å¯¹è±¡ï¼Œè°ƒç”¨æ–°æ¥å£æ–¹æ³•</li>
</ul>
<h3 id="7-jdkåŠ¨æ€ä»£ç†">7. JDKåŠ¨æ€ä»£ç†</h3>
<h3 id="8-cglibåŠ¨æ€ä»£ç†">8. CGLIbåŠ¨æ€ä»£ç†</h3>
<ul>
<li>ä¸è¦æ±‚è¢«ä»£ç†ç±»å®ç°æ¥å£</li>
<li>å†…éƒ¨ä¸»è¦å°è£…äº†ASM Javaå­—èŠ‚ç æ“ä½œæ¡†æ¶ï¼Œå¯ä»¥å¸®åŠ©æˆ‘ä»¬å®‰å…¨çš„æ“ä½œå­—èŠ‚ç </li>
<li>åŠ¨æ€ç”Ÿæˆä¸€ä¸ªå­ç±»ä»¥è¦†ç›–éfinalçš„æ–¹æ³•ï¼Œç»‘å®šé’©å­å›è°ƒè‡ªå®šä¹‰æ‹¦æˆªå™¨</li>
</ul>
<p><strong>è¢«ä»£ç†ç±»ï¼š</strong></p>
<pre><code class="language-java">public class CommonPayment {
    public void pay() {
        System.out.println(&quot;ä¸ªäººåä¹‰æˆ–è€…å…¬å¸åä¹‰éƒ½å¯ä»¥èµ°è¿™ä¸ªæ”¯ä»˜é€šé“&quot;);
    }
}
</code></pre>
<p><strong>æ–¹æ³•æ‹¦æˆªå™¨ï¼š</strong></p>
<pre><code class="language-java">public class AlipayMethodInterceptor implements MethodInterceptor {
    /**
     *
     * @param proxy ç”Ÿæˆçš„ä»£ç†å¯¹è±¡
     * @param method è¢«å¢å¼ºçš„æ–¹æ³•
     * @param args æ–¹æ³•çš„å‚æ•°
     * @param methodProxy å¢å¼ºåçš„æ–¹æ³•
     * @return æ–¹æ³•çš„è¿”å›å€¼
     * @throws Throwable
     */
    @Override
    public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {
        beforePay();
        Object result = methodProxy.invokeSuper(proxy,args);
        afterPay();
        return result;
    }

    private void afterPay() {
        System.out.println(&quot;æ”¯ä»˜ç»™å…¬å¸&quot;);
    }

    private void beforePay() {
        System.out.println(&quot;ä»é“¶è¡Œå–æ¬¾&quot;);
    }

}
</code></pre>
<p><strong>Cglibå·¥å…·ç±»</strong>ï¼š</p>
<pre><code class="language-java">public class CglibUtil {
    public static &lt;T&gt; T creatProxy(T targetObject, MethodInterceptor interceptor){
        Object proxy = Enhancer.create(targetObject.getClass(), interceptor);
        return (T) proxy;
    }
}
</code></pre>
<p><strong>JDKåŠ¨æ€ä»£ç†å’ŒCglibçš„åŒºåˆ«ï¼Ÿ</strong></p>
<blockquote>
<p>JDKåŠ¨æ€ä»£ç†åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ‰€ä»¥æ€§èƒ½å’ŒCglibå·®å¼‚ä¸å¤§</p>
</blockquote>
<ul>
<li>JDKåŠ¨æ€ä»£ç†æ˜¯åŸºäºåå°„å®ç°çš„ï¼Œè¦æ±‚ä¸šåŠ¡ç±»å¿…é¡»å®ç°æ¥å£ï¼Œæ˜¯JDKåŸç”Ÿï¼Œåœ¨JVMè¿è¡Œæ›´å¯é ï¼Œå¯ä»¥å‡å°‘ä¾èµ–</li>
<li>CglibåŸºäºASMæœºåˆ¶å®ç°ï¼Œé€šè¿‡ç”Ÿæˆä¸šåŠ¡ç±»çš„å­ç±»ä½œä¸ºä»£ç†ç±»ï¼Œæ— éœ€å®ç°æ¥å£ï¼Œèƒ½å®ç°ä»£ç†ç±»çš„æ— ä¾µå…¥</li>
</ul>
<h3 id="9-springaopçš„åº•å±‚æœºåˆ¶">9. SpringAOPçš„åº•å±‚æœºåˆ¶</h3>
<ul>
<li>æ˜¯Cglibä¸JDKåŠ¨æ€ä»£ç†å…±å­˜çš„</li>
<li><strong>é»˜è®¤ç­–ç•¥</strong>ï¼šå¦‚æœBeanå®ç°äº†æ¥å£é‡‡ç”¨JDKåŠ¨æ€ä»£ç†çš„æ–¹å¼ï¼Œå¦åˆ™ä½¿ç”¨CGlib</li>
</ul>
<h2 id="äºŒ-åˆ©ç”¨cglibå®ç°aopé€»è¾‘">äºŒã€åˆ©ç”¨CGLibå®ç°AOPé€»è¾‘</h2>
<blockquote>
<p>ç”±äºCGLibä¸éœ€è¦å®ç°æ¥å£ï¼Œå®ç°æ¯”è¾ƒç®€å•</p>
</blockquote>
<h3 id="1-å®Œæˆæ³¨è§£çš„åˆ›å»º">1. å®Œæˆæ³¨è§£çš„åˆ›å»º</h3>
<p><strong>æ ‡è®°ç±»ä¸ºåˆ‡é¢ï¼Œå®ç°æ¨ªåˆ‡é€»è¾‘</strong></p>
<pre><code class="language-java">//åªèƒ½æ³¨å…¥åˆ°ç±»ä¸Š
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Aspect {
    /*
    * éœ€è¦è¢«ç»‡å…¥æ¨ªåˆ‡é€»è¾‘çš„æ³¨è§£æ ‡ç­¾
    */
    Class&lt;? extends Annotation&gt; value();
}
</code></pre>
<p><strong>æ ‡è®°åˆ‡é¢çš„æ‰§è¡Œé¡ºåº</strong></p>
<pre><code class="language-java">@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Order {
    /*
    å€¼è¶Šå°ï¼Œè¶Šå…ˆæ‰§è¡Œ
     */
    int value() default Integer.MAX_VALUE;
}
</code></pre>
<h3 id="2-åˆ‡é¢æ¨¡æ¿ç±»">2. åˆ‡é¢æ¨¡æ¿ç±»</h3>
<blockquote>
<p>åˆ‡é¢éœ€è¦ç»§æ‰¿è¯¥ç±»ï¼Œå¹¶é‡å†™ç›¸åº”çš„æ–¹æ³•å®ç°æ¨ªåˆ‡é€»è¾‘</p>
<p>å¦‚æœæ²¡æœ‰é‡å†™ï¼Œåˆ™ç›¸åº”æ–¹æ³•ä¸ºç©ºï¼Œä¸å½±å“ç»“æœ</p>
</blockquote>
<pre><code class="language-java">public abstract class DefaultAspect {
    /**
     * äº‹å‰æ‹¦æˆª
     * @param targetClass è¢«ä»£ç†çš„ç›®æ ‡ç±»
     * @param method è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•
     * @param args è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å¯¹åº”çš„å‚æ•°åˆ—è¡¨
     * @throws Throwable
     */
    public void before(Class&lt;?&gt; targetClass, Method method, Object[] args) throws Throwable{

    }
    /**
     * äº‹åæ‹¦æˆª
     * @param targetClass è¢«ä»£ç†çš„ç›®æ ‡ç±»
     * @param method è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•
     * @param args è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å¯¹åº”çš„å‚æ•°åˆ—è¡¨
     * @param returnValue è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æ‰§è¡Œåçš„è¿”å›å€¼
     * @throws Throwable
     */
    public Object afterReturning(Class&lt;?&gt; targetClass, Method method, Object[] args, Object returnValue) throws Throwable{
        return returnValue;
    }
    /**
     *
     * @param targetClass è¢«ä»£ç†çš„ç›®æ ‡ç±»
     * @param method è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•
     * @param args è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•å¯¹åº”çš„å‚æ•°åˆ—è¡¨
     * @param e è¢«ä»£ç†çš„ç›®æ ‡æ–¹æ³•æŠ›å‡ºçš„å¼‚å¸¸
     * @throws Throwable
     */
    public void afterThrowing(Class&lt;?&gt; targetClass, Method method, Object[] args,  Throwable e) throws Throwable{

    }
}
</code></pre>
<h3 id="3-è¢«ä»£ç†ç±»çš„ç»‡å…¥å®ç°">3. è¢«ä»£ç†ç±»çš„ç»‡å…¥å®ç°</h3>
<blockquote>
<ul>
<li>
<p>å®ç°CGLibä¸­MethodInterceptoræ¥å£çš„interceptæ–¹æ³•ï¼Œå®ç°è¢«ä»£ç†ç±»çš„åˆ‡å…¥é€»è¾‘</p>
</li>
<li>
<p>ä¼šè‡ªåŠ¨å¯¹ä¼ å…¥çš„åˆ‡é¢æŒ‰ç…§orderæ’åº</p>
</li>
</ul>
</blockquote>
<pre><code class="language-java">public class AspectListExecutor implements MethodInterceptor {
    //è¢«ä»£ç†çš„ç±»
    private Class&lt;?&gt; targetClass;
    //æ’è¿‡åºçš„Aspectåˆ—è¡¨
    @Getter
    private List&lt;AspectInfo&gt; sortedAspectInfos;

    public AspectListExecutor(Class&lt;?&gt; targetClass, List&lt;AspectInfo&gt; aspectInfos) {
        this.targetClass = targetClass;
        this.sortedAspectInfos = sortAspectInfoList(aspectInfos);
    }

    /**
     * æ ¹æ®aspectInfosçš„Orderå±æ€§å€¼è¿›è¡Œæ’åº
     *
     * @param aspectInfos
     * @return
     */
    private List&lt;AspectInfo&gt; sortAspectInfoList(List&lt;AspectInfo&gt; aspectInfos) {
        aspectInfos.sort(new Comparator&lt;AspectInfo&gt;() {
            @Override
            public int compare(AspectInfo o1, AspectInfo o2) {
                //æŒ‰ç…§orderçš„å¤§å°æ’åº
                return o1.getOrderIndex() - o2.getOrderIndex();
            }
        });
        return aspectInfos;
    }

    /**
     * å®ç°è¢«ä»£ç†ç±»çš„ç»‡å…¥é€»è¾‘
     * @param proxy ç”Ÿæˆçš„ä»£ç†å¯¹è±¡
     * @param method è¢«å¢å¼ºçš„æ–¹æ³•
     * @param args æ–¹æ³•çš„å‚æ•°
     * @param methodProxy å¢å¼ºåçš„æ–¹æ³•
     * @return æ–¹æ³•çš„è¿”å›å€¼
     * @throws Throwable
     */
    @Override
    public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {
        Object returnValue = null;
        if (ValidationUtil.isEmpty(sortedAspectInfos)){
            return null;
        }
        try {
            //1.æŒ‰ç…§orderçš„é¡ºåºå‡åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„beforeæ–¹æ³•
            invokeBeforeAdvices(method,args);
            //2.æ‰§è¡Œè¢«ä»£ç†ç±»çš„æ–¹æ³•
            returnValue = methodProxy.invokeSuper(proxy,args);
            //3.å¦‚æœè¢«ä»£ç†æ–¹æ³•æ­£å¸¸è¿”å›ï¼Œåˆ™æŒ‰ç…§orderçš„é¡ºåºé™åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„afterReturningæ–¹æ³•
            returnValue = invokeAfterReturningAdvice(method,args,returnValue);
        } catch (Throwable throwable) {
            //4.å¦‚æœè¢«ä»£ç†æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™æŒ‰ç…§orderçš„é¡ºåºé™åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„afterThrowingæ–¹æ³•
            invokeAfterThrowingAdvices(method,args,throwable);
        }
        return returnValue;
    }

    //å¦‚æœè¢«ä»£ç†æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™æŒ‰ç…§orderçš„é¡ºåºé™åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„afterThrowingæ–¹æ³•
    private void invokeAfterThrowingAdvices(Method method, Object[] args, Throwable throwable) throws Throwable {
        for(int i = sortedAspectInfos.size()-1;i&gt;=0;i--){
           sortedAspectInfos.get(i).getDefaultAspect().afterThrowing(targetClass,method,args,throwable);
        }
    }

    //å¦‚æœè¢«ä»£ç†æ–¹æ³•æ­£å¸¸è¿”å›ï¼Œåˆ™æŒ‰ç…§orderçš„é¡ºåºé™åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„afterReturningæ–¹æ³•
    private Object invokeAfterReturningAdvice(Method method, Object[] args, Object returnValue) throws Throwable {
        Object result = null;
        for(int i = sortedAspectInfos.size()-1;i&gt;=0;i--){
            result = sortedAspectInfos.get(i).getDefaultAspect().afterReturning(targetClass,method,args,returnValue);
        }
        return result;
    }

    //æŒ‰ç…§orderçš„é¡ºåºå‡åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„beforeæ–¹æ³•
    private void invokeBeforeAdvices(Method method, Object[] args) throws Throwable {
        for (AspectInfo sortedAspectInfo : sortedAspectInfos) {
            sortedAspectInfo.getDefaultAspect().before(targetClass,method,args);
        }
    }
}
</code></pre>
<h3 id="4-æ‰§è¡Œå®¹å™¨çš„aopæ“ä½œ">4. æ‰§è¡Œå®¹å™¨çš„AOPæ“ä½œ</h3>
<p><strong>åŸºæœ¬é€»è¾‘ä¸ºï¼š</strong></p>
<ol>
<li>å°†æ‰€æœ‰è¢«@Aspectæ³¨è§£æ ‡è®°çš„åˆ‡é¢ç±»è·å–</li>
<li>æ ¹æ®åˆ‡é¢ç±»çš„åˆ‡å…¥ç‚¹ä¸åŒï¼Œè¿›è¡Œåˆ†ç±»</li>
<li>æ ¹æ®ä¸åŒçš„åˆ‡å…¥ç‚¹ï¼Œç”Ÿæˆè¯¥åˆ‡å…¥ç‚¹çš„åŠ¨æ€ä»£ç†ç±»ï¼Œæ›¿æ¢æ‰å®¹å™¨ä¸­æ²¡æœ‰è¢«ä»£ç†çš„ç±»</li>
</ol>
<pre><code class="language-java">public class AspectWeaver {
    private BeanContainer beanContainer;

    public AspectWeaver() {
        beanContainer = BeanContainer.getInstance();
    }

    public void doAop() {
        //1.è·å–æ‰€æœ‰çš„åˆ‡é¢ç±»
        Set&lt;Class&lt;?&gt;&gt; aspectSet = beanContainer.getClassesByAnnotation(Aspect.class);
        if (ValidationUtil.isEmpty(aspectSet)) {
            return;
        }
        //2.å°†åˆ‡é¢ç±»æŒ‰ç…§ä¸åŒçš„ç»‡å…¥ç›®æ ‡åˆ†ç±»
        Map&lt;Class&lt;? extends Annotation&gt;, List&lt;AspectInfo&gt;&gt; categorizedMap = new HashMap&lt;&gt;();
        for (Class&lt;?&gt; aspectClass : aspectSet) {
            //éªŒè¯åˆ‡é¢
            if (verifyAspect(aspectClass)) {
                categorizeAspect(categorizedMap, aspectClass);
            } else {
                //ä¸éµå®ˆè§„èŒƒåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸
                throw new RuntimeException(&quot;@Aspect and @Order must be added to the Aspect class, and Aspect class must extend from DefaultAspect&quot;);
            }
        }
        //3.æŒ‰ç…§ä¸åŒçš„ç»‡å…¥ç›®æ ‡ï¼Œåˆ†åˆ«å»æŒ‰åºç»‡å…¥Aspectçš„é€»è¾‘
        if (!ValidationUtil.isEmpty(categorizedMap)){
            for (Class&lt;? extends Annotation&gt; category : categorizedMap.keySet()) {
                weaveByCategory(category,categorizedMap.get(category));
            }
        }
    }

    private void weaveByCategory(Class&lt;? extends Annotation&gt; category, List&lt;AspectInfo&gt; aspectInfos) {
        //1.è·å–è¢«ä»£ç†ç±»çš„é›†åˆ
        Set&lt;Class&lt;?&gt;&gt; classSet = beanContainer.getClassesByAnnotation(category);
        if (ValidationUtil.isEmpty(classSet)){
            return;
        }
        //2.éå†è¢«ä»£ç†ç±»ï¼Œåˆ†åˆ«ä¸ºæ¯ä¸ªè¢«ä»£ç†ç±»ç”ŸæˆåŠ¨æ€ä»£ç†å®ä¾‹
        for (Class&lt;?&gt; targerClass : classSet) {
            //åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡
            AspectListExecutor aspectListExecutor = new AspectListExecutor(targerClass,aspectInfos);
            //æœ¬è´¨è°ƒç”¨çš„è¿™ä¸ªEnhancer.create(targetClass,interceptor);
            Object proxyBean = ProxyCreator.createProxy(targerClass, aspectListExecutor);
            //3.å°†åŠ¨æ€ä»£ç†çš„å®ä¾‹å¯¹è±¡æ·»åŠ åˆ°å®¹å™¨ä¸­ï¼Œå–ä»£æœªè¢«ä»£ç†å‰çš„å®ä¾‹
            beanContainer.addBean(targerClass,proxyBean);
        }
    }

    //å°†åˆ‡é¢ç±»æŒ‰ç…§ä¸åŒçš„ç»‡å…¥ç›®æ ‡åˆ†ç±»
    private void categorizeAspect(Map&lt;Class&lt;? extends Annotation&gt;, List&lt;AspectInfo&gt;&gt; categorizedMap, Class&lt;?&gt; aspectClass) {
        Order orderTag = aspectClass.getAnnotation(Order.class);
        Aspect aspectTag = aspectClass.getAnnotation(Aspect.class);
        DefaultAspect bean = (DefaultAspect) beanContainer.getBean(aspectClass);
        AspectInfo aspectInfo = new AspectInfo(orderTag.value(),bean);
        //è·å–ç»‡å…¥ç‚¹çš„é›†åˆ
        List&lt;AspectInfo&gt; infoList = categorizedMap.getOrDefault(aspectTag.value(), new ArrayList&lt;AspectInfo&gt;());
        infoList.add(aspectInfo);
        categorizedMap.put(aspectTag.value(),infoList);
    }

    //æ¡†æ¶ä¸­ä¸€å®šè¦éµå®ˆç»™Aspectç±»æ·»åŠ @Aspectå’Œ@Orderæ ‡ç­¾çš„è§„èŒƒï¼ŒåŒæ—¶ï¼Œå¿…é¡»ç»§æ‰¿è‡ªDefaultAspect.class
    //æ­¤å¤–ï¼Œ@Aspectçš„å±æ€§å€¼ä¸èƒ½æ˜¯å®ƒæœ¬èº«
    private boolean verifyAspect(Class&lt;?&gt; aspectClass) {
        return aspectClass.isAnnotationPresent(Aspect.class)
                &amp;&amp; aspectClass.isAnnotationPresent(Order.class)
                &amp;&amp; DefaultAspect.class.isAssignableFrom(aspectClass)
                &amp;&amp; aspectClass.getAnnotation(Aspect.class).value() != Aspect.class;
    }
}

/**
 * åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡
 * @author xzzz2020
 * @version 1.0
 * @date 2020/8/8 11:33
 */
public class ProxyCreator {

    public static Object createProxy(Class&lt;?&gt; targetClass, MethodInterceptor interceptor){
        return Enhancer.create(targetClass,interceptor);
    }
}

</code></pre>
<h2 id="ä¸‰-å¼•å…¥aspectjæ¡†æ¶">ä¸‰ã€å¼•å…¥AspectJæ¡†æ¶</h2>
<blockquote>
<p>è®©Pointcutæ›´åŠ çµæ´»ï¼Œå¼•å…¥AspectJçš„åˆ‡é¢è¡¨è¾¾å¼å’Œç›¸å…³çš„å®šä½è§£ææœºåˆ¶</p>
</blockquote>
<h3 id="1-aspectjæ¡†æ¶ç®€ä»‹">1. AspectJæ¡†æ¶ç®€ä»‹</h3>
<ul>
<li>å®šä¹‰äº†åˆ‡é¢è¯­æ³•ä»¥åŠåˆ‡é¢è¯­æ³•çš„è§£ææœºåˆ¶</li>
<li>æä¾›äº†å¼ºå¤§çš„ç»‡å…¥å·¥å…·ï¼Œç”±äºCglibåªæ”¯æŒæ–¹æ³•çš„ç»‡å…¥ï¼Œè€ŒAspectJå¯ä»¥æ”¯æŒæ‰€æœ‰çš„ç»‡å…¥ï¼Œæ¯”å¦‚è¯´å±æ€§æˆ–è€…æ„é€ å‡½æ•°</li>
</ul>
<p><strong>æ”¯æŒå¤šç§æ—¶æœºçš„ç»‡å…¥ï¼Œ</strong></p>
<ul>
<li><strong>ç¼–è¯‘æ—¶ç»‡å…¥ï¼ˆé™æ€ç»‡å…¥ï¼‰</strong>ï¼šåˆ©ç”¨ajcç¼–è¯‘å™¨è€Œä¸æ˜¯Javacç¼–è¯‘å™¨ï¼Œå°†æºæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œå¹¶å°†åˆ‡é¢é€»è¾‘ç»‡å…¥åˆ°classæ–‡ä»¶</li>
<li><strong>ç¼–è¯‘åç»‡å…¥ï¼ˆé™æ€ç»‡å…¥ï¼‰</strong>ï¼šå…ˆåˆ©ç”¨Javacå°†æºæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œå†åˆ©ç”¨ajcå°†åˆ‡é¢é€»è¾‘ç»‡å…¥åˆ°classæ–‡ä»¶</li>
<li><strong>ç±»åŠ è½½æœŸç»‡å…¥ï¼ˆåŠ¨æ€ç»‡å…¥ï¼ŒLoad Time Weavingï¼‰</strong>ï¼šåˆ©ç”¨java agentï¼Œåœ¨ç±»åŠ è½½çš„æ—¶å€™ç»‡å…¥åˆ‡é¢é€»è¾‘</li>
</ul>
<p><strong>ä¼˜ç‚¹ï¼š</strong></p>
<ul>
<li>
<p>ç›¸æ¯”äºSpringæ€§èƒ½æ›´é«˜ï¼ŒSpringæ˜¯åœ¨ç±»åŠ è½½åæ‰å»ç”Ÿæˆä¸€ä¸ªåŠ¨æ€ä»£ç†çš„å¯¹è±¡ï¼Œè€ŒAspectJæ˜¯åœ¨ç¼–è¯‘æœŸæˆ–è€…ç±»åŠ è½½æ—¶æœŸå®Œæˆåˆ‡é¢é€»è¾‘çš„æ›¿æ¢</p>
<blockquote>
<p>SpringAOPåœ¨å®¹å™¨Refreshæ—¶å·²ç»å®Œæˆäº†åŠ è½½ï¼ŒåŒæ—¶ç±»æ˜¯å•ä¾‹çš„ï¼Œå­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼Œå®é™…ä½¿ç”¨æ—¶æ€§èƒ½å·®è·å¹¶ä¸å¤§</p>
</blockquote>
</li>
</ul>
<p><strong>å¯¹äºSpringè€Œè¨€ä»…ä»…ä½¿ç”¨äº†AspectJçš„åˆ‡é¢è¯­æ³•ï¼Œå¹¶æ²¡ç”¨ä½¿ç”¨ajcç¼–è¯‘å™¨</strong></p>
<ul>
<li>é¿å…å¢åŠ ç”¨æˆ·çš„å­¦ä¹ æˆæœ¬ï¼Œå³ä½¿ç”¨20%çš„å­¦ä¹ æˆæœ¬æ»¡è¶³80%çš„éœ€æ±‚</li>
<li>åªæ˜¯é»˜è®¤ä¸ä½¿ç”¨ï¼Œå¦‚æœæƒ³ç”¨ajcè¿˜æ˜¯å¯ä»¥å¼•å…¥çš„</li>
<li>ç»‡å…¥æœºåˆ¶è¿˜æ˜¯æ²¿ç”¨äº†CGLIBä»¥åŠJDKåŠ¨æ€ä»£ç†æœºåˆ¶</li>
</ul>
<h3 id="2-ç¯å¢ƒé…ç½®">2. ç¯å¢ƒé…ç½®</h3>
<p><strong>å¼•å…¥aspectjweaverçš„JARåŒ…ï¼Œä»¥æ”¯æŒè¡¨è¾¾å¼çš„è§£æã€‚</strong></p>
<pre><code class="language-xml">&lt;dependency&gt;
    &lt;groupId&gt;org.aspectj&lt;/groupId&gt;
    &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt;
    &lt;version&gt;1.9.5&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>
<p><strong>ä¿®æ”¹@Aspectæ³¨è§£</strong></p>
<pre><code class="language-java">@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
public @interface Aspect {
    String pointcut();
}
</code></pre>
<h3 id="3-è§£æaspectè¡¨è¾¾å¼å¹¶å®šä½è¢«ç»‡å…¥ç›®æ ‡">3. è§£æAspectè¡¨è¾¾å¼å¹¶å®šä½è¢«ç»‡å…¥ç›®æ ‡</h3>
<p><strong>æœ‰ä¸¤ä¸ªå…³é”®çš„ç±»</strong></p>
<ul>
<li><strong>PointcutParser</strong>ï¼šæä¾›å¯¹è¡¨è¾¾å¼è¯­æ³•çš„æ”¯æŒï¼Œåˆ©ç”¨parsePointcutExpressionæ–¹æ³•ï¼Œè§£æè¡¨è¾¾å¼ï¼Œå°†è¿”å›ä¸€ä¸ªPointcutExpressionæ¥å£çš„å®ç°ç±»</li>
<li><strong>PointcutExpressionæ¥å£</strong>ï¼šç”¨äºéªŒè¯ç±»æˆ–è€…æ–¹æ³•æ˜¯å¦ç¬¦åˆè¡¨è¾¾å¼è§„åˆ™ï¼ŒcouldMatchJoinPointsInTypeæ–¹æ³•æä¾›ç±»çš„ç²—æ£€æŸ¥ï¼Œåªèƒ½æ ¡éªŒwithinçš„è¡¨è¾¾å¼ï¼Œå…¶ä»–çš„éƒ½ä¼šè¡¨è¾¾trueï¼›matchesMethodExecutionæ–¹æ³•æä¾›å¯¹æ–¹æ³•çš„ç²¾ç¡®æ£€æŸ¥</li>
</ul>
<pre><code class="language-java">public class PointcutLocator {
    //è¡¨è¾¾å¼è§£æå™¨ï¼Œåˆ¤æ–­ç±»å’Œæ–¹æ³•æ˜¯å¦ç¬¦åˆè¡¨è¾¾å¼
    private PointcutExpression pointcutExpression;

    public PointcutLocator(String expression){
        //Pointcutè§£æå™¨,æ”¯æŒæ‰€æœ‰AspectJçš„æ‰€æœ‰è¯­æ³•æ ‘ï¼Œè§£æStringç±»å‹çš„Pointcutè¯­æ³•
        PointcutParser pointcutParser = PointcutParser.getPointcutParserSupportingSpecifiedPrimitivesAndUsingContextClassloaderForResolution(
                PointcutParser.getAllSupportedPointcutPrimitives()
        );
        this.pointcutExpression = pointcutParser.parsePointcutExpression(expression);
    }

    /**
     * åˆ¤æ–­ä¼ å…¥çš„Classå¯¹è±¡æ˜¯å¦ç¬¦åˆPointcutè¡¨è¾¾å¼ï¼ˆåˆç­›ï¼‰
     * @param targetClass ç›®æ ‡ç±»
     * @return æ˜¯å¦åŒ¹é…
     */
    public boolean roughMatches(Class&lt;?&gt; targetClass){
        //åªèƒ½æ ¡éªŒwithinçš„è¡¨è¾¾å¼ï¼Œå…¶ä»–çš„éƒ½ä¼šè¡¨è¾¾true
        return pointcutExpression.couldMatchJoinPointsInType(targetClass);
    }

    /**
     * åˆ¤æ–­ä¼ å…¥çš„Methodå¯¹è±¡æ˜¯å¦ç¬¦åˆPointcutè¡¨è¾¾å¼ï¼ˆç²¾ç¡®ç­›é€‰ï¼‰
     * @param method ç›®æ ‡æ–¹æ³•
     * @return æ˜¯å¦åŒ¹é…
     */
    public boolean accurateMatches(Method method){
        ShadowMatch shadowMatch = pointcutExpression.matchesMethodExecution(method);
        //åˆ¤æ–­æ˜¯å¦å®Œå…¨åŒ¹é…
        return shadowMatch.alwaysMatches();
    }
}
</code></pre>
<p><strong>ä¿®æ”¹AspectInfoç±»ï¼Œæä¾›å¯¹è¡¨è¾¾å¼è§£æçš„æ”¯æŒ</strong></p>
<pre><code class="language-java">@AllArgsConstructor
@Getter
@ToString
public class AspectInfo {
    //Aspectçš„æ‰§è¡Œé¡ºåº
    private  int OrderIndex;
    //Aspect
    private  DefaultAspect defaultAspect;

    private PointcutLocator pointcutLocator;

}
</code></pre>
<p><strong>ä¿®æ”¹doAopçš„é€»è¾‘ä»¥æ”¯æŒè¡¨è¾¾å¼</strong></p>
<pre><code class="language-java">public class AspectWeaver {
    private BeanContainer beanContainer;

    public AspectWeaver() {
        beanContainer = BeanContainer.getInstance();
    }

    public void doAop() {
        //1.è·å–æ‰€æœ‰çš„åˆ‡é¢ç±»
        Set&lt;Class&lt;?&gt;&gt; aspectSet = beanContainer.getClassesByAnnotation(Aspect.class);
        if (ValidationUtil.isEmpty(aspectSet)) {
            return;
        }
        //2.æ‹¼è£…AspectInfoList
        List&lt;AspectInfo&gt; aspectInfoList = packAspectInfoList(aspectSet);
        //3.éå†å®¹å™¨çš„æ‰€æœ‰ç±»
        Set&lt;Class&lt;?&gt;&gt; classSet = beanContainer.getClasses();
        for (Class&lt;?&gt; targetClass : classSet) {
            //æ’é™¤åˆ‡é¢ç±»æœ¬èº«
            if(!targetClass.isAnnotationPresent(Aspect.class)){
                //4.ç²—ç­›ç¬¦åˆæ¡ä»¶çš„åˆ‡é¢
                List&lt;AspectInfo&gt; roughMatchedAspectList = collectRoughMatchedAspectListForSpecificClass(aspectInfoList,targetClass);
                //5.å°è¯•è¿›è¡ŒAspectç»‡å…¥
                wrapIfNecessary(roughMatchedAspectList,targetClass);
            }
        }


    }

    /**
     *
     * @param roughMatchedAspectList
     * @param targetClass
     */
    private void wrapIfNecessary(List&lt;AspectInfo&gt; roughMatchedAspectList, Class&lt;?&gt; targetClass) {
        if(!ValidationUtil.isEmpty(roughMatchedAspectList)){
            //åˆ›å»ºåŠ¨æ€ä»£ç†å¯¹è±¡
            AspectListExecutor aspectListExecutor = new AspectListExecutor(targetClass,roughMatchedAspectList);
            Object proxy = ProxyCreator.createProxy(targetClass, aspectListExecutor);
            beanContainer.addBean(targetClass,proxy);
        }
    }

    /**
     * ç²—ç­›é€‰å‡ºå­˜åœ¨å¯¹åº”åˆ‡ç‚¹çš„åˆ‡é¢é€»è¾‘
     * @param aspectInfoList åˆ‡é¢é›†åˆ
     * @param targetClass ç›®æ ‡ç±»
     * @return
     */
    private List&lt;AspectInfo&gt; collectRoughMatchedAspectListForSpecificClass(List&lt;AspectInfo&gt; aspectInfoList, Class&lt;?&gt; targetClass) {
        List&lt;AspectInfo&gt; roughMatchedAspectList = new ArrayList&lt;&gt;();
        for (AspectInfo aspectInfo : aspectInfoList) {
            //ç²—ç­›
            if (aspectInfo.getPointcutLocator().roughMatches(targetClass)){
                roughMatchedAspectList.add(aspectInfo);
            }
        }
        return roughMatchedAspectList;
    }

    /**
     * éªŒè¯è¢«@Aspectæ³¨è§£æ ‡è®°çš„ç±»æ˜¯å¦ç¬¦åˆè¦æ±‚
     * å¦‚æœç¬¦åˆè¦æ±‚ï¼Œå–å‡ºæ‰€éœ€çš„Pointcutè¡¨è¾¾å¼ï¼ŒOrderå€¼ä»¥åŠå¯¹åº”çš„Bean
     * @param aspectSet
     * @return
     */
    private List&lt;AspectInfo&gt; packAspectInfoList(Set&lt;Class&lt;?&gt;&gt; aspectSet) {
        List&lt;AspectInfo&gt; aspectInfos = new ArrayList&lt;&gt;();
        for (Class&lt;?&gt; aspectClass : aspectSet) {
            if (verifyAspect(aspectClass)){
                Order orderTag = aspectClass.getAnnotation(Order.class);
                Aspect aspectTag = aspectClass.getAnnotation(Aspect.class);
                DefaultAspect defaultAspect = (DefaultAspect) beanContainer.getBean(aspectClass);
                //åˆå§‹åŒ–è¡¨è¾¾å¼å®šä½å™¨
                PointcutLocator pointcutLocator = new PointcutLocator(aspectTag.pointcut());
                AspectInfo aspectInfo = new AspectInfo(orderTag.value(),defaultAspect,pointcutLocator);
                aspectInfos.add(aspectInfo);
            }else {
                //ä¸éµå®ˆè§„èŒƒåˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸
                throw new RuntimeException(&quot;@Aspect and @Order must be added to the Aspect class, and Aspect class must extend from DefaultAspect&quot;);
            }
        }
        return aspectInfos;
    }

    //æ¡†æ¶ä¸­ä¸€å®šè¦éµå®ˆç»™Aspectç±»æ·»åŠ @Aspectå’Œ@Orderæ ‡ç­¾çš„è§„èŒƒï¼ŒåŒæ—¶ï¼Œå¿…é¡»ç»§æ‰¿è‡ªDefaultAspect.class
    //æ­¤å¤–ï¼Œ@Aspectçš„å±æ€§å€¼ä¸èƒ½æ˜¯å®ƒæœ¬èº«
    private boolean verifyAspect(Class&lt;?&gt; aspectClass) {
        return aspectClass.isAnnotationPresent(Aspect.class) &amp;&amp;
                aspectClass.isAnnotationPresent(Order.class) &amp;&amp;
                DefaultAspect.class.isAssignableFrom(aspectClass);
    }

}
</code></pre>
<p><strong>åœ¨ç»‡å…¥ä¹‹å‰åšä¸€æ¬¡ç²¾ç¡®çš„åˆ¤æ–­</strong></p>
<pre><code class="language-java">@Override
public Object intercept(Object proxy, Method method, Object[] args, MethodProxy methodProxy) throws Throwable {
    Object returnValue = null;
    //å¯¹ä»£ç†ç±»è¿›è¡Œç²¾ç­›
    collectAccurateMatchedAspectList(method);
    if (ValidationUtil.isEmpty(sortedAspectInfos)){
        return methodProxy.invokeSuper(proxy,args);
    }
    try {
        //1.æŒ‰ç…§orderçš„é¡ºåºå‡åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„beforeæ–¹æ³•
        invokeBeforeAdvices(method,args);
        //2.æ‰§è¡Œè¢«ä»£ç†ç±»çš„æ–¹æ³•
        returnValue = methodProxy.invokeSuper(proxy,args);
        //3.å¦‚æœè¢«ä»£ç†æ–¹æ³•æ­£å¸¸è¿”å›ï¼Œåˆ™æŒ‰ç…§orderçš„é¡ºåºé™åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„afterReturningæ–¹æ³•
        returnValue = invokeAfterReturningAdvice(method,args,returnValue);
    } catch (Throwable throwable) {
        //4.å¦‚æœè¢«ä»£ç†æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™æŒ‰ç…§orderçš„é¡ºåºé™åºæ‰§è¡Œå®Œæ‰€æœ‰Aspectçš„afterThrowingæ–¹æ³•
        invokeAfterThrowingAdvices(method,args,throwable);
    }
    return returnValue;
}

    /**
     * å¯¹ä»£ç†ç±»è¿›è¡Œç²¾ç­›
     * @param method
     */
    private void collectAccurateMatchedAspectList(Method method) {
        if (!ValidationUtil.isEmpty(sortedAspectInfos)){
            Iterator&lt;AspectInfo&gt; iterator = sortedAspectInfos.iterator();
            while (iterator.hasNext()){
                AspectInfo aspectInfo = iterator.next();
                if (!aspectInfo.getPointcutLocator().accurateMatches(method)){
                    iterator.remove();
                }
            }
        }
    }
</code></pre>

<span id="footnote"></span>
<div id = "warn"></div>
</div>
<div class="toc-container"><ul class="markdownIt-TOC">
<li>
<ul>
<li><a href="#%E4%B8%80-%E7%AE%80%E4%BB%8B">ä¸€ã€ç®€ä»‹</a>
<ul>
<li><a href="#1-aop%E7%9A%84%E5%BC%95%E5%87%BA">1. AOPçš„å¼•å‡º</a></li>
<li><a href="#2-%E8%87%AA%E7%A0%94aop%E6%8F%90%E4%BE%9B%E7%9A%84%E5%8A%9F%E8%83%BD">2. è‡ªç ”AOPæä¾›çš„åŠŸèƒ½</a></li>
<li><a href="#3-aop%E7%9A%84%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5">3. AOPçš„æ ¸å¿ƒæ¦‚å¿µï¼š</a></li>
<li><a href="#4-advice%E7%9A%84%E7%A7%8D%E7%B1%BB">4. Adviceçš„ç§ç±»ï¼š</a></li>
<li><a href="#5-%E5%88%87%E9%9D%A2%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F">5. åˆ‡é¢æ‰§è¡Œé¡ºåº</a></li>
<li><a href="#6-introduction-%E5%BC%95%E5%85%A5%E5%9E%8Badvice">6. Introduction--å¼•å…¥å‹Advice</a></li>
<li><a href="#7-jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">7. JDKåŠ¨æ€ä»£ç†</a></li>
<li><a href="#8-cglib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">8. CGLIbåŠ¨æ€ä»£ç†</a></li>
<li><a href="#9-springaop%E7%9A%84%E5%BA%95%E5%B1%82%E6%9C%BA%E5%88%B6">9. SpringAOPçš„åº•å±‚æœºåˆ¶</a></li>
</ul>
</li>
<li><a href="#%E4%BA%8C-%E5%88%A9%E7%94%A8cglib%E5%AE%9E%E7%8E%B0aop%E9%80%BB%E8%BE%91">äºŒã€åˆ©ç”¨CGLibå®ç°AOPé€»è¾‘</a>
<ul>
<li><a href="#1-%E5%AE%8C%E6%88%90%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%88%9B%E5%BB%BA">1. å®Œæˆæ³¨è§£çš„åˆ›å»º</a></li>
<li><a href="#2-%E5%88%87%E9%9D%A2%E6%A8%A1%E6%9D%BF%E7%B1%BB">2. åˆ‡é¢æ¨¡æ¿ç±»</a></li>
<li><a href="#3-%E8%A2%AB%E4%BB%A3%E7%90%86%E7%B1%BB%E7%9A%84%E7%BB%87%E5%85%A5%E5%AE%9E%E7%8E%B0">3. è¢«ä»£ç†ç±»çš„ç»‡å…¥å®ç°</a></li>
<li><a href="#4-%E6%89%A7%E8%A1%8C%E5%AE%B9%E5%99%A8%E7%9A%84aop%E6%93%8D%E4%BD%9C">4. æ‰§è¡Œå®¹å™¨çš„AOPæ“ä½œ</a></li>
</ul>
</li>
<li><a href="#%E4%B8%89-%E5%BC%95%E5%85%A5aspectj%E6%A1%86%E6%9E%B6">ä¸‰ã€å¼•å…¥AspectJæ¡†æ¶</a>
<ul>
<li><a href="#1-aspectj%E6%A1%86%E6%9E%B6%E7%AE%80%E4%BB%8B">1. AspectJæ¡†æ¶ç®€ä»‹</a></li>
<li><a href="#2-%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE">2. ç¯å¢ƒé…ç½®</a></li>
<li><a href="#3-%E8%A7%A3%E6%9E%90aspect%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%B9%B6%E5%AE%9A%E4%BD%8D%E8%A2%AB%E7%BB%87%E5%85%A5%E7%9B%AE%E6%A0%87">3. è§£æAspectè¡¨è¾¾å¼å¹¶å®šä½è¢«ç»‡å…¥ç›®æ ‡</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="fullPage"><canvas id="canvas"></canvas></div>
</article>
<div id="eof"><span>EOF</span></div><div class="round-shape-one"></div>
<section>
<div class="doc_comments">

	  
		<div id="gitalk-container"></div>
		<!--è¯„è®ºæ˜¾ç¤ºåŒºï¼Œè¯·æ’å…¥åˆé€‚çš„ä½ç½®-->
<div id="comment"></div>
<!--Leancloud æ“ä½œåº“:-->
<script src="//cdn1.lncld.net/static/js/3.6.1/av-min.js"></script>
<!--Valine çš„æ ¸å¿ƒä»£ç åº“-->
<script src="//cdn.jsdelivr.net/npm/valine@1.4.4/dist/Valine.min.js"></script>
<script>
    new Valine({
        el:'#comment',
        appId: 'DysN4QrSvmmE6SpDXopbCLD6-gzGzoHsz',
        appKey: 'mjK643yLFa4WWXtobofr24Ap',
        placeholder: 'ãƒ¾ï¾‰â‰§âˆ€â‰¦)oå¿«æ¥è¯„è®ºä¸€ä¸‹å§!',
        avatar:''
    });
</script>
	  
		  
	  

</div></section>
</div></div></div>

<script>
    "use strict";
    ! function () {
        for (var n = document.getElementsByTagName("pre"), e = n.length, s = 0; s < e; s++) {
            n[s].innerHTML = '<span class="line-number"></span>' + n[s].innerHTML + '<span class="cl"></span>';
            for (var a = n[s].innerHTML.split(/\n/).length, r = 0; r < a - 1; r++) {
                n[s].getElementsByTagName("span")[0].innerHTML += "<span>" + (r + 1) + "</span>"
            }
        }
    }();
    let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");
    window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;
        mainNavLinks.forEach((link, index) => {
            let section = document.getElementById(decodeURI(link.hash).substring(1));
            let nextSection = null
            if (mainNavLinks[index + 1]) {
                nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(
                    1));
            }
            if (section.offsetTop <= fromTop) {
                if (nextSection) {
                    if (nextSection.offsetTop > fromTop) {
                        link.classList.add("currentToc");
                    } else {
                        link.classList.remove("currentToc");
                    }
                } else {
                    link.classList.add("currentToc");
                }
            } else {
                link.classList.remove("currentToc");
            }
        });
    });
    var list = document.querySelectorAll(".katex");
    for (var i = 0; i < list.length; i++) {
        list[i].style.display = "unset"
    };
    var h = document.documentElement,
        b = document.body,
        st = "scrollTop",
        sh = "scrollHeight",
        progress = document.querySelector(".progress"),
        scroll;
    document.addEventListener("scroll", function () {
        scroll = (h[st] || b[st]) / ((h[sh] || b[sh]) - h.clientHeight) * 100;
        progress.style.setProperty("--scroll", scroll + "%")
    });
    var wxScale = new WxScale({
        fullPage: document.querySelector("#fullPage"),
        canvas: document.querySelector("#canvas")
    });
    var imgBox = document.querySelectorAll("#md_block img");
    for (var i = 0; i < imgBox.length; i++) {
        imgBox[i].onclick = function (e) {
            wxScale.start(this)
        }
    };
    var content = "æœ¬æ–‡æœ€åæ›´æ–°äº2020-09-10";
    var date1 = "2020-09-10 20:07:20";
    date1 = date1.replace("-", "/");
    var date2 = new Date();
    var date3 = date2.getTime() - new Date(date1).getTime();
    var days = Math.floor(date3 / (24 * 3600 * 1000));
    if (days >= 365) {
        document.getElementById("warn").innerHTML = content
    };
</script>

<style>#magnifyImg{position:fixed;left:0;top:0;text-align:center;width:100%;display:none;z-index:9999}#magnifyImg img{object-fit:contain;background:#eaecef;padding:15px;border-radius:10px;height:auto;width:auto;vertical-align:middle}</style>
<a id="scrollUp" href="#top" style="position: fixed; z-index: 2147483647; display: block;"></a><div class="footer animated fadeInDown"><div class="site_footer"><div class="mysocials"><div class="my_socials"></div></div><div class="copyright"id="copyright">Copyright Â© 2018-2020 <a href="https://xzzz2020.github.io" style="margin:0;">xzzz2020</a>.</div>
<span style="display: inline;margin-right:15px;">ğŸ‘<strong><span id="busuanzi_value_site_pv"></span></strong></span><span id="busuanzi_container_page_pv" style="display: inline;"><span>ğŸ“š<strong>62</strong> posts</span></div></div>
<script>
console.log("\n %c \u26a1Theme: Bitcron-pro Author's Blog:https://blog.blinkstar.cn  Writen By Serence  \n\n", "color: #ffffff; background: rgba(49, 49, 49, 0.85); padding:5px 0;border-radius:5px;", );
</script>
<script src="https://cdn.jsdelivr.net/npm/instant.page@3.0.0/instantpage.min.js" type="module" defer></script>
<script type="text/javascript" async src="https://xzzz2020.github.io/media/js/prism.js"></script>
</body>
</html>